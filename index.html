<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>SOCIETE GENERALE ‚Äì Interface Premium</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
/* -----------------------------------------------------
   THEME & BASE
------------------------------------------------------ */
:root {
    --bg: #ffffff;
    --text: #1a1a1a;
    --panel: #f5f7fa;
    --shadow: rgba(0, 0, 0, 0.08);
    --accent: #0044cc;
    --accent-hover: #003399;
    --success: #10b981;
    --danger: #d90429;
    --warning: #ff9800;
    --info: #3b82f6;
    --border: #e1e5eb;
    --card-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
    
    /* Variables pour les couleurs individuelles des boutons */
    --logo-border-color: #dc2626;
    --logo-text-color: #dc2626;
    --continuer-btn-color: #dc2626;
    --continuer-btn-hover: #b91c1c;
    --codesecret-btn-color: #dc2626;
    --codesecret-btn-hover: #b91c1c;
    --seconnecter-btn-color: #dc2626;
    --seconnecter-btn-hover: #b91c1c;
    --virement-btn-color: #f59e0b;
    --virement-btn-hover: #d97706;
    --rib-btn-color: #8b5cf6;
    --rib-btn-hover: #7c3aed;
    --logo-border-account: #000000;
}

body.dark {
    --bg: #0d1117;
    --text: #e6e6e6;
    --panel: #161b22;
    --shadow: rgba(0, 0, 0, 0.4);
    --accent: #4e9aff;
    --border: #2d3748;
    --card-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
    --success: #4ade80;
    --danger: #ef4444;
    --warning: #f59e0b;
    --info: #60a5fa;
    
    /* Ajustement des couleurs individuelles pour le mode sombre */
    --logo-border-color: #ef4444;
    --logo-text-color: #ef4444;
    --continuer-btn-color: #ef4444;
    --continuer-btn-hover: #dc2626;
    --codesecret-btn-color: #ef4444;
    --codesecret-btn-hover: #dc2626;
    --seconnecter-btn-color: #ef4444;
    --seconnecter-btn-hover: #dc2626;
    --virement-btn-color: #f59e0b;
    --virement-btn-hover: #d97706;
    --rib-btn-color: #a78bfa;
    --rib-btn-hover: #8b5cf6;
    --logo-border-account: #ffffff;
}

* {
    box-sizing: border-box;
}

body {
    background: var(--bg);
    color: var(--text);
    font-family: "Poppins", sans-serif;
    margin: 0;
    transition: background-color 0.3s, color 0.3s;
    line-height: 1.6;
}

/* -----------------------------------------------------
   ACCESSIBILIT√â - AM√âLIORATIONS
------------------------------------------------------ */
:focus {
    outline: 3px solid var(--accent);
    outline-offset: 2px;
}

:focus:not(:focus-visible) {
    outline: none;
}

:focus-visible {
    outline: 3px solid var(--accent);
    outline-offset: 2px;
}

/* Haute contraste pour accessibilit√© */
@media (prefers-contrast: high) {
    :root {
        --accent: #0050d4;
        --success: #00875a;
        --danger: #c00000;
        --text: #000000;
        --border: #000000;
    }
}

/* -----------------------------------------------------
   SECURITY BADGES - BANDEAU DE S√âCURIT√â
------------------------------------------------------ */
.security-banner {
    background: #000000; /* CHANGEMENT : Fond noir au lieu de bleu */
    color: white;
    padding: 10px 20px;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.security-banner .left, .security-banner .right {
    display: flex;
    align-items: center;
    gap: 15px;
}

.security-badge {
    background: rgba(255, 255, 255, 0.2);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.security-badge::before {
    content: "üîí";
}

.security-info {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    opacity: 0.9;
}

/* -----------------------------------------------------
   LAST LOGIN DISPLAY
------------------------------------------------------ */
.last-login-display {
    background: var(--panel);
    padding: 15px 20px;
    border-radius: 10px;
    margin: 20px 0;
    border-left: 4px solid var(--info);
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
}

.last-login-display::before {
    content: "üïê";
    font-size: 16px;
}

.last-login-label {
    font-weight: 600;
    color: var(--accent);
}

.last-login-value {
    font-weight: 700;
    font-family: 'Courier New', monospace;
}

/* -----------------------------------------------------
   TRANSFER STEPS - √âTAPES DE VIREMENT
------------------------------------------------------ */
.transfer-steps {
    display: flex;
    justify-content: space-between;
    margin: 30px 0;
    position: relative;
    counter-reset: step;
}

.transfer-steps::before {
    content: '';
    position: absolute;
    top: 20px;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--border);
    z-index: 1;
}

.transfer-step-item {
    position: relative;
    z-index: 2;
    text-align: center;
    flex: 1;
}

.step-number {
    width: 40px;
    height: 40px;
    background: var(--border);
    color: var(--text);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    margin: 0 auto 10px;
    transition: all 0.3s;
}

.step-label {
    font-size: 14px;
    font-weight: 500;
    color: var(--text);
    opacity: 0.7;
    transition: all 0.3s;
}

.transfer-step-item.active .step-number {
    background: var(--accent);
    color: white;
    transform: scale(1.1);
}

.transfer-step-item.active .step-label {
    opacity: 1;
    font-weight: 600;
    color: var(--accent);
}

.transfer-step-item.completed .step-number {
    background: var(--success);
    color: white;
}

.transfer-step-item.completed .step-label {
    opacity: 1;
    color: var(--success);
}

/* -----------------------------------------------------
   NEW TRANSFER FORM WITH ACCOUNT NUMBER
------------------------------------------------------ */
.transfer-step-content {
    background: var(--panel);
    border-radius: 15px;
    padding: 30px;
    margin: 20px 0;
    display: none;
    animation: fadeIn 0.3s ease;
}

.transfer-step-content.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.form-section-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 20px;
    color: var(--accent);
    display: flex;
    align-items: center;
    gap: 10px;
}

.form-section-title::before {
    font-size: 20px;
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text);
}

.form-label.required::after {
    content: " *";
    color: var(--danger);
}

.form-hint {
    display: block;
    margin-top: 5px;
    font-size: 13px;
    color: var(--text);
    opacity: 0.7;
}

.help-btn {
    background: var(--info);
    color: white;
    border: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    font-size: 14px;
    cursor: help;
    margin-left: 5px;
    vertical-align: middle;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.technical-details {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
    font-size: 13px;
    display: none;
}

.technical-details.active {
    display: block;
}

.technical-details-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--accent);
    display: flex;
    align-items: center;
    gap: 5px;
}

.technical-details-title::before {
    content: "‚öôÔ∏è";
}

/* -----------------------------------------------------
   TRANSFER SUMMARY
------------------------------------------------------ */
.transfer-summary {
    background: var(--panel);
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 25px;
    margin: 20px 0;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
}

.summary-row:last-child {
    border-bottom: none;
}

.summary-label {
    font-weight: 500;
    color: var(--text);
}

.summary-value {
    font-weight: 600;
    text-align: right;
    max-width: 60%;
    word-break: break-word;
}

.summary-value.amount {
    font-size: 18px;
    color: var(--danger);
    font-family: 'Courier New', monospace;
}

.summary-value.fee {
    color: var(--warning);
}

/* -----------------------------------------------------
   LOADING OVERLAY
------------------------------------------------------ */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    flex-direction: column;
    color: white;
}

.loading-overlay.active {
    display: flex;
}

.loading-spinner {
    width: 80px;
    height: 80px;
    border: 6px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: var(--accent);
    animation: spin 1.2s ease-in-out infinite;
    margin-bottom: 30px;
}

.loading-text {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 10px;
    color: white;
}

.loading-details {
    font-size: 16px;
    opacity: 0.9;
    margin-top: 10px;
    text-align: center;
    max-width: 500px;
    line-height: 1.5;
}

/* -----------------------------------------------------
   SECUPASS OVERLAY
------------------------------------------------------ */
.secupass-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10001;
    flex-direction: column;
    color: white;
}

.secupass-overlay.active {
    display: flex;
}

.secupass-box {
    background: var(--panel);
    padding: 40px;
    border-radius: 20px;
    width: 450px;
    max-width: 90%;
    text-align: center;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    border: 2px solid var(--accent);
}

.secupass-title {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 10px;
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.secupass-title::before {
    content: "üîê";
}

.secupass-subtitle {
    font-size: 16px;
    opacity: 0.8;
    margin-bottom: 30px;
    color: var(--text);
}

.secupass-input {
    width: 100%;
    padding: 18px;
    font-size: 22px;
    text-align: center;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: var(--bg);
    color: var(--text);
    margin-bottom: 25px;
    font-family: 'Courier New', monospace;
    letter-spacing: 3px;
    transition: all 0.3s;
}

.secupass-input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 4px rgba(0, 68, 204, 0.2);
}

.secupass-numpad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-bottom: 25px;
}

.secupass-btn {
    padding: 20px;
    border: none;
    background: var(--accent);
    color: white;
    border-radius: 12px;
    font-size: 22px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: 600;
}

.secupass-btn:hover {
    background: var(--accent-hover);
    transform: translateY(-3px);
}

.secupass-btn:active {
    transform: translateY(0);
}

.secupass-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
}

.secupass-confirm {
    background: #10b981;
    color: white;
    border: none;
    padding: 14px 28px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    flex: 1;
}

.secupass-confirm:hover {
    background: #0da271;
    transform: translateY(-2px);
}

.secupass-cancel {
    background: var(--danger);
    color: white;
    border: none;
    padding: 14px 28px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    flex: 1;
}

.secupass-cancel:hover {
    background: #b00020;
    transform: translateY(-2px);
}

.secupass-error {
    color: var(--danger);
    margin-top: 15px;
    font-size: 14px;
    min-height: 20px;
    font-weight: 500;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* -----------------------------------------------------
   MESSAGERIE SUPER INTELLIGENTE
------------------------------------------------------ */
.smart-messagerie-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10002;
    flex-direction: column;
    color: white;
}

.smart-messagerie-overlay.active {
    display: flex;
}

.smart-messagerie-container {
    background: var(--panel);
    padding: 40px;
    border-radius: 20px;
    width: 650px;
    max-width: 95%;
    max-height: 85vh;
    text-align: center;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    border: 2px solid var(--accent);
    display: flex;
    flex-direction: column;
}

.smart-messagerie-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--border);
}

.smart-messagerie-title {
    font-size: 24px;
    font-weight: 700;
    color: var(--accent);
    display: flex;
    align-items: center;
    gap: 10px;
}

.smart-messagerie-count {
    background: var(--danger);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 700;
}

.smart-messagerie-content {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    margin-bottom: 20px;
}

.smart-message {
    background: var(--bg);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    border-left: 5px solid var(--accent);
    text-align: left;
    transition: all 0.3s;
    position: relative;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.smart-message:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.smart-message.new {
    border-left-color: var(--danger);
    background: linear-gradient(90deg, rgba(217, 4, 41, 0.1) 0%, rgba(217, 4, 41, 0.05) 100%);
}

.smart-message.system {
    border-left-color: var(--info);
    background: linear-gradient(90deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
}

.smart-message.security {
    border-left-color: var(--warning);
    background: linear-gradient(90deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
    animation: pulse-glow 2s infinite;
}

.smart-message.transaction {
    border-left-color: var(--success);
    background: linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
}

@keyframes pulse-glow {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
}

.smart-message-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.smart-message-sender {
    font-weight: 700;
    color: var(--accent);
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.smart-message-time {
    font-size: 12px;
    opacity: 0.7;
    font-weight: 500;
}

.smart-message-content {
    font-size: 14px;
    line-height: 1.5;
    color: var(--text);
}

.smart-message-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.smart-message-action-btn {
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    background: var(--accent);
    color: white;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
}

.smart-message-action-btn:hover {
    background: var(--accent-hover);
    transform: translateY(-1px);
}

.smart-message-delete-btn {
    background: var(--danger);
}

.smart-message-delete-btn:hover {
    background: #b00020;
}

.smart-messagerie-footer {
    display: flex;
    gap: 15px;
    justify-content: space-between;
    padding-top: 20px;
    border-top: 2px solid var(--border);
}

.smart-messagerie-btn {
    flex: 1;
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    background: linear-gradient(145deg, var(--accent), var(--accent-hover));
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.smart-messagerie-btn:hover {
    background: linear-gradient(145deg, var(--accent-hover), var(--accent));
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 68, 204, 0.3);
}

.smart-messagerie-btn.delete-all {
    background: linear-gradient(145deg, var(--danger), #b00020);
}

.smart-messagerie-btn.delete-all:hover {
    background: linear-gradient(145deg, #b00020, var(--danger));
}

.smart-messagerie-btn.mark-all-read {
    background: linear-gradient(145deg, var(--success), #0da271);
}

.smart-messagerie-btn.mark-all-read:hover {
    background: linear-gradient(145deg, #0da271, var(--success));
}

.smart-messagerie-btn.ai-assistant {
    background: linear-gradient(145deg, #8b5cf6, #7c3aed);
}

.smart-messagerie-btn.ai-assistant:hover {
    background: linear-gradient(145deg, #7c3aed, #8b5cf6);
}

.smart-messagerie-empty {
    text-align: center;
    padding: 50px 20px;
    opacity: 0.7;
    font-style: italic;
    font-size: 16px;
    color: var(--text);
}

/* -----------------------------------------------------
   LOGIN PAGE (2 √©tapes)
------------------------------------------------------ */
#loginPage {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: linear-gradient(135deg, #ffffff 0%, #f5f7fa 100%);
}

.login-box {
    width: 400px;
    max-width: 90%;
    background: var(--panel);
    padding: 40px 30px;
    text-align: center;
    border-radius: 16px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s;
    border: 1px solid var(--border);
}

.login-box:hover {
    transform: translateY(-5px);
}

.logo {
    margin-bottom: 25px;
    text-align: center;
}

.logo-image {
    width: 120px;
    height: 120px;
    margin: 0 auto 20px auto;
    border-radius: 15px;
    object-fit: cover;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    border: 3px solid var(--logo-border-color);
}

.logo-text {
    font-size: 28px;
    font-weight: 700;
    color: var(--logo-text-color);
    margin: 0;
}

.login-box h2 {
    margin-top: 0;
    margin-bottom: 25px;
    font-weight: 600;
    color: var(--accent);
}

.login-box input {
    width: 100%;
    padding: 14px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--bg);
    color: var(--text);
    font-size: 16px;
    text-align: center;
    transition: border-color 0.3s, box-shadow 0.3s;
}

.login-box input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0, 68, 204, 0.1);
}

.login-box button {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 10px;
    color: white;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
}

.login-box button:hover {
    transform: translateY(-2px);
}

.login-box button:active {
    transform: translateY(0);
}

/* Bouton Continuer - COULEUR SP√âCIFIQUE */
#validateID {
    background-color: var(--continuer-btn-color) !important;
}

#validateID:hover {
    background-color: var(--continuer-btn-hover) !important;
}

/* Bouton Se connecter - COULEUR SP√âCIFIQUE */
#loginBtn {
    background-color: var(--seconnecter-btn-color) !important;
}

#loginBtn:hover {
    background-color: var(--seconnecter-btn-hover) !important;
}

.error {
    color: var(--danger);
    margin-top: 10px;
    font-size: 14px;
    min-height: 20px;
}

.error-details {
    font-size: 13px;
    opacity: 0.8;
    margin-top: 5px;
}

/* Pav√© num√©rique - COULEURS SP√âCIFIQUES */
.numpad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin: 20px 0;
}

.pad {
    padding: 18px;
    border: none;
    color: white;
    border-radius: 10px;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    background-color: var(--codesecret-btn-color) !important;
}

.pad:hover {
    transform: translateY(-2px);
    background-color: var(--codesecret-btn-hover) !important;
}

.pad:active {
    transform: translateY(0);
}

/* -----------------------------------------------------
   NOTIFICATIONS AVEC COULEURS DIFF√âRENTES
------------------------------------------------------ */
.notifications {
    position: fixed;
    top: 25px;
    right: 25px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 9999;
}

.notification {
    background: var(--accent);
    color: white;
    padding: 15px 20px;
    border-radius: 12px;
    box-shadow: 0 5px 20px var(--shadow);
    opacity: 0;
    transform: translateX(100px);
    animation: slideFadeIn 0.5s forwards, slideFadeOut 0.5s forwards 3.5s;
    max-width: 350px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
}

.notification::before {
    font-size: 18px;
    font-weight: bold;
}

/* NOTIFICATION SUCC√àS - VERT */
.notification.success {
    background: linear-gradient(135deg, #10b981 0%, #0da271 100%);
    border-left: 5px solid #a7f3d0;
}

.notification.success::before {
    content: "‚úì";
}

/* NOTIFICATION ERREUR - ROUGE */
.notification.error {
    background: linear-gradient(135deg, #d90429 0%, #b00020 100%);
    border-left: 5px solid #ffb3b3;
    animation: slideFadeIn 0.5s forwards, slideFadeOut 0.5s forwards 5s, shake 0.5s ease-in-out;
}

.notification.error::before {
    content: "!";
}

/* NOTIFICATION WARNING - ORANGE */
.notification.warning {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    border-left: 5px solid #fde68a;
}

.notification.warning::before {
    content: "‚ö†";
}

/* NOTIFICATION INFO - BLEU */
.notification.info {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    border-left: 5px solid #93c5fd;
}

.notification.info::before {
    content: "‚Ñπ";
}

/* NOTIFICATION ALERT - ROUGE AVEC EFFET */
.notification.alert {
    background: linear-gradient(135deg, #d90429 0%, #b00020 100%);
    border-left: 5px solid #ffd700;
    padding: 20px;
    max-width: 400px;
    animation: slideFadeIn 0.5s forwards, slideFadeOut 0.5s forwards 12s;
}

.notification.alert::before {
    content: "üö®";
    font-size: 24px;
}

.notification.alert .alert-content {
    flex: 1;
}

.notification.alert .alert-title {
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 5px;
    display: block;
}

.notification.alert .alert-message {
    font-size: 14px;
    opacity: 0.9;
    display: block;
}

.notification.alert .alert-amount {
    font-weight: 700;
    font-size: 18px;
    margin: 8px 0;
    color: #ffd700;
    display: block;
}

.notification.alert .alert-fee {
    font-weight: 600;
    font-size: 15px;
    color: #ff9800;
    display: block;
}

/* Notification d'alerte s√©curit√© */
.notification.security-alert {
    background: linear-gradient(135deg, #9d0208 0%, #6a040f 100%);
    color: white;
    border-left: 5px solid #ffd700;
    font-weight: 700;
    animation: pulse-red-notif 1s infinite, slideFadeIn 0.5s forwards;
    animation-delay: 0s, 0s;
}

@keyframes pulse-red-notif {
    0% {
        box-shadow: 0 0 0 0 rgba(157, 2, 8, 0.7);
    }
    70% {
        box-shadow: 0 0 0 15px rgba(157, 2, 8, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(157, 2, 8, 0);
    }
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
    20%, 40%, 60%, 80% { transform: translateX(5px); }
}

@keyframes slideFadeIn {
    from {
        opacity: 0;
        transform: translateX(100px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideFadeOut {
    from {
        opacity: 1;
        transform: translateX(0);
    }
    to {
        opacity: 0;
        transform: translateX(100px);
    }
}

/* -----------------------------------------------------
   LAYOUT
------------------------------------------------------ */
#app {
    display: none;
}

.wrapper {
    display: flex;
    min-height: 100vh;
}

.sidebar {
    width: 280px;
    padding: 30px 20px;
    background: var(--panel);
    box-shadow: 4px 0 15px var(--shadow);
    display: flex;
    flex-direction: column;
    gap: 10px;
    position: sticky;
    top: 0;
    height: 100vh;
    overflow-y: auto;
    z-index: 100;
}

/* -----------------------------------------------------
   BOUTONS 3D SUPER HYPER ULTRA ROBUSTE - AM√âLIOR√âS POUR RESPONSIVE
------------------------------------------------------ */
.menu-item {
    cursor: pointer;
    padding: 14px 18px;
    border-radius: 12px;
    opacity: 0.9;
    font-weight: 600;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex;
    align-items: center;
    gap: 15px;
    background: linear-gradient(145deg, var(--panel), var(--bg));
    border: 2px solid var(--border);
    box-shadow: 
        0 6px 12px rgba(0, 0, 0, 0.1),
        0 10px 20px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.8),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 15px;
    flex-shrink: 0;
    min-height: 50px;
}

.menu-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 100%);
    z-index: 1;
    opacity: 0;
    transition: opacity 0.3s;
}

.menu-item:hover {
    opacity: 1;
    background: linear-gradient(145deg, var(--accent), var(--accent-hover));
    color: white;
    transform: translateY(-4px) scale(1.02);
    box-shadow: 
        0 12px 24px rgba(0, 68, 204, 0.3),
        0 20px 40px rgba(0, 68, 204, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -1px 0 rgba(0, 0, 0, 0.2);
    border-color: var(--accent);
}

.menu-item:hover::before {
    opacity: 1;
}

.menu-item.active {
    background: linear-gradient(145deg, var(--accent), var(--accent-hover));
    color: white;
    opacity: 1;
    border-color: var(--accent);
    box-shadow: 
        0 8px 16px rgba(0, 68, 204, 0.3),
        0 15px 30px rgba(0, 68, 204, 0.2),
        inset 0 2px 4px rgba(255, 255, 255, 0.4),
        inset 0 -2px 4px rgba(0, 0, 0, 0.2);
}

.menu-item.active::after {
    content: '';
    position: absolute;
    right: 15px;
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
    box-shadow: 0 0 10px white;
}

.menu-item i {
    font-size: 20px;
    width: 24px;
    text-align: center;
    z-index: 2;
    flex-shrink: 0;
}

/* -----------------------------------------------------
   MESSAGERIE DANS LA SIDEBAR - AM√âLIOR√âE
------------------------------------------------------ */
.messagerie-sidebar {
    margin-top: 15px;
    border-top: 1px solid var(--border);
    padding-top: 15px;
    flex-shrink: 0;
}

.messagerie-toggle {
    cursor: pointer;
    padding: 14px 18px;
    border-radius: 12px;
    opacity: 0.9;
    font-weight: 600;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
    background: linear-gradient(145deg, var(--panel), var(--bg));
    border: 2px solid var(--border);
    box-shadow: 
        0 6px 12px rgba(0, 0, 0, 0.1),
        0 10px 20px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.8),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 15px;
    flex-shrink: 0;
    min-height: 50px;
}

.messagerie-toggle:hover {
    opacity: 1;
    background: linear-gradient(145deg, var(--accent), var(--accent-hover));
    color: white;
    transform: translateY(-4px) scale(1.02);
    box-shadow: 
        0 12px 24px rgba(0, 68, 204, 0.3),
        0 20px 40px rgba(0, 68, 204, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -1px 0 rgba(0, 0, 0, 0.2);
    border-color: var(--accent);
}

.messagerie-toggle.active {
    background: linear-gradient(145deg, var(--accent), var(--accent-hover));
    color: white;
    opacity: 1;
    border-color: var(--accent);
    box-shadow: 
        0 8px 16px rgba(0, 68, 204, 0.3),
        0 15px 30px rgba(0, 68, 204, 0.2),
        inset 0 2px 4px rgba(255, 255, 255, 0.4),
        inset 0 -2px 4px rgba(0, 0, 0, 0.2);
}

.messagerie-count {
    background: var(--danger);
    color: white;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 700;
    min-width: 24px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(217, 4, 41, 0.3);
}

.messagerie-container {
    background: var(--bg);
    border-radius: 12px;
    border: 2px solid var(--border);
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    transition: max-height 0.4s ease, opacity 0.4s ease;
    box-shadow: 0 4px 12px var(--shadow);
    flex-shrink: 0;
}

.messagerie-container.active {
    max-height: 400px;
    opacity: 1;
}

.messagerie-content {
    padding: 15px;
    max-height: 300px;
    overflow-y: auto;
}

.message {
    background: var(--panel);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 10px;
    border-left: 4px solid var(--accent);
    font-size: 13px;
    line-height: 1.4;
    display: flex;
    align-items: flex-start;
    gap: 12px;
    transition: transform 0.2s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.message:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.message.new {
    border-left-color: var(--danger);
    background: rgba(217, 4, 41, 0.08);
}

.message-checkbox {
    margin-top: 2px;
    accent-color: var(--accent);
    transform: scale(1.1);
}

.message-content {
    flex: 1;
}

.message-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
}

.message-sender {
    font-weight: 700;
    color: var(--accent);
    font-size: 13px;
}

.message-time {
    font-size: 11px;
    opacity: 0.7;
    font-weight: 500;
}

.message-text {
    font-size: 12px;
    opacity: 0.9;
    line-height: 1.5;
}

.no-messages {
    text-align: center;
    padding: 25px;
    opacity: 0.7;
    font-style: italic;
    font-size: 13px;
}

.messagerie-footer {
    padding: 12px;
    border-top: 2px solid var(--border);
    display: flex;
    gap: 10px;
    background: var(--panel);
}

.messagerie-footer button {
    flex: 1;
    padding: 10px 14px;
    border: none;
    border-radius: 8px;
    background: linear-gradient(145deg, var(--accent), var(--accent-hover));
    color: white;
    font-size: 12px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    box-shadow: 0 2px 6px rgba(0, 68, 204, 0.2);
}

.messagerie-footer button:hover {
    background: linear-gradient(145deg, var(--accent-hover), var(--accent));
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 68, 204, 0.3);
}

.messagerie-footer button.delete-selected {
    background: linear-gradient(145deg, var(--danger), #b00020);
    font-size: 12px;
    padding: 10px 14px;
}

.messagerie-footer button.delete-selected:hover {
    background: linear-gradient(145deg, #b00020, var(--danger));
    transform: translateY(-2px);
}

.select-all-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 15px;
    border-bottom: 2px solid var(--border);
    background: var(--panel);
}

.select-all-label {
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.select-all-checkbox {
    accent-color: var(--accent);
    transform: scale(1.2);
}

/* -----------------------------------------------------
   NOUVEAU BOUTON MESSAGERIE INTELLIGENTE
------------------------------------------------------ */
.menu-item-intelligent-messagerie {
    cursor: pointer;
    padding: 14px 18px;
    border-radius: 12px;
    opacity: 0.9;
    font-weight: 600;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex;
    align-items: center;
    gap: 15px;
    background: linear-gradient(145deg, #8b5cf6, #7c3aed);
    border: 2px solid #7c3aed;
    box-shadow: 
        0 6px 12px rgba(139, 92, 246, 0.3),
        0 10px 20px rgba(139, 92, 246, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.8),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 15px;
    color: white;
    margin-top: 10px;
    flex-shrink: 0;
    min-height: 50px;
}

.menu-item-intelligent-messagerie:hover {
    opacity: 1;
    background: linear-gradient(145deg, #7c3aed, #8b5cf6);
    color: white;
    transform: translateY(-4px) scale(1.02);
    box-shadow: 
        0 12px 24px rgba(124, 58, 237, 0.4),
        0 20px 40px rgba(124, 58, 237, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.5),
        inset 0 -1px 0 rgba(0, 0, 0, 0.3);
    border-color: #8b5cf6;
}

.menu-item-intelligent-messagerie::before {
    content: 'üí¨';
    margin-right: 10px;
    font-size: 18px;
}

/* -----------------------------------------------------
   NOUVEAU MENU ITEM PARAM√àTRES
------------------------------------------------------ */
.menu-item-parametres {
    cursor: pointer;
    padding: 14px 18px;
    border-radius: 12px;
    opacity: 0.9;
    font-weight: 600;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex;
    align-items: center;
    gap: 15px;
    background: linear-gradient(145deg, #3b82f6, #2563eb);
    border: 2px solid #2563eb;
    box-shadow: 
        0 6px 12px rgba(59, 130, 246, 0.3),
        0 10px 20px rgba(59, 130, 246, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.8),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 15px;
    color: white;
    flex-shrink: 0;
    min-height: 50px;
}

.menu-item-parametres:hover {
    opacity: 1;
    background: linear-gradient(145deg, #2563eb, #3b82f6);
    color: white;
    transform: translateY(-4px) scale(1.02);
    box-shadow: 
        0 12px 24px rgba(37, 99, 235, 0.4),
        0 20px 40px rgba(37, 99, 235, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.5),
        inset 0 -1px 0 rgba(0, 0, 0, 0.3);
    border-color: #3b82f6;
}

.menu-item-parametres::before {
    content: '‚öôÔ∏è';
    margin-right: 10px;
    font-size: 18px;
}

/* -----------------------------------------------------
   CONTENT
------------------------------------------------------ */
.content {
    flex: 1;
    padding: 40px 50px;
    overflow-y: auto;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
}

.profile {
    display: flex;
    align-items: center;
    gap: 20px;
}

.profile-logo {
    width: 80px;
    height: 80px;
    border-radius: 15px;
    object-fit: cover;
    border: 3px solid var(--logo-border-account);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.balance-container {
    background: var(--panel);
    padding: 30px;
    border-radius: 20px;
    box-shadow: var(--card-shadow);
    margin-bottom: 30px;
}

.balance-label {
    font-size: 16px;
    opacity: 0.8;
    margin-bottom: 5px;
}

.balance-value {
    font-size: 42px;
    font-weight: 700;
    margin: 10px 0;
}

/* -----------------------------------------------------
   STATUT DU COMPTE - POINT VERT/ROUGE DYNAMIQUE
------------------------------------------------------ */
.status {
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: 8px;
    padding: 8px 0;
}

.status i {
    display: inline-block;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    position: relative;
    box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
    flex-shrink: 0;
    animation: pulse-green 2s infinite;
    background: linear-gradient(135deg, #10b981 0%, #0da271 100%);
}

/* Point blanc au centre pour effet "LED" */
.status i::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 50%;
}

/* Animation de pulsation verte */
@keyframes pulse-green {
    0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
    }
    50% {
        transform: scale(1.15);
        box-shadow: 0 0 0 8px rgba(16, 185, 129, 0);
    }
    100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
    }
}

/* Mode sombre - ajustement vert */
body.dark .status i {
    background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
    box-shadow: 0 0 20px rgba(74, 222, 128, 0.6);
}

/* -----------------------------------------------------
   STATUT COMPTE BLOQU√â - POINT ROUGE PULSANT
------------------------------------------------------ */
.status.blocked {
    color: #d90429;
}

.status.blocked i {
    background: linear-gradient(135deg, #d90429 0%, #b00020 100%) !important;
    box-shadow: 0 0 15px rgba(217, 4, 41, 0.5) !important;
    animation: pulse-red 2s infinite !important;
}

/* Animation de pulsation rouge */
@keyframes pulse-red {
    0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(217, 4, 41, 0.7);
    }
    50% {
        transform: scale(1.15);
        box-shadow: 0 0 0 8px rgba(217, 4, 41, 0);
    }
    100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(217, 4, 41, 0);
    }
}

/* Mode sombre - ajustement rouge */
body.dark .status.blocked i {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.6) !important;
}

/* Point blanc au centre conserv√© */
body.dark .status.blocked i::after {
    background-color: rgba(255, 255, 255, 0.95) !important;
}

#accountSelect {
    margin-top: 10px;
    padding: 12px 15px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--bg);
    color: var(--text);
    font-size: 16px;
    width: 100%;
    transition: border-color 0.3s, box-shadow 0.3s;
}

#accountSelect:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0, 68, 204, 0.1);
}

/* -----------------------------------------------------
   LIMITS DISPLAY
------------------------------------------------------ */
.limits-container {
    background: var(--panel);
    padding: 20px;
    border-radius: 12px;
    margin: 20px 0;
    border-left: 4px solid var(--accent);
}

.limits-title {
    font-weight: 600;
    margin-bottom: 10px;
    color: var(--accent);
}

.limit-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 14px;
}

.limit-usage {
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    margin: 5px 0;
    overflow: hidden;
}

.limit-usage-bar {
    height: 100%;
    background: var(--accent);
    border-radius: 3px;
    transition: width 0.3s ease;
}

.limit-usage-bar.warning {
    background: #ffa500;
}

.limit-usage-bar.danger {
    background: var(--danger);
}

/* -----------------------------------------------------
   PENDING TRANSFER INFO - ALERTE AVEC BATTEMENT
------------------------------------------------------ */
.pending-transfer-limits {
    background: var(--panel);
    padding: 20px;
    border-radius: 12px;
    margin: 10px 0 20px 0;
    border-left: 4px solid #9c27b0;
    display: none;
    position: relative;
    overflow: hidden;
}

.pending-transfer-limits.active {
    display: block;
    animation: heartbeat 2s infinite;
}

@keyframes heartbeat {
    0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(156, 39, 176, 0.4);
    }
    25% {
        transform: scale(1.02);
        box-shadow: 0 0 0 10px rgba(156, 39, 176, 0);
    }
    50% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(156, 39, 176, 0.4);
    }
    75% {
        transform: scale(1.02);
        box-shadow: 0 0 0 10px rgba(156, 39, 176, 0);
    }
    100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(156, 39, 176, 0.4);
    }
}

.pending-transfer-limits::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 25%, rgba(156, 39, 176, 0.1) 25%, rgba(156, 39, 176, 0.1) 50%, transparent 50%, transparent 75%, rgba(156, 39, 176, 0.1) 75%, rgba(156, 39, 176, 0.1) 100%);
    background-size: 20px 20px;
    animation: shine 2s linear infinite;
    pointer-events: none;
    opacity: 0.3;
    z-index: 1;
}

@keyframes shine {
    0% {
        background-position: 0 0;
    }
    100% {
        background-position: 20px 20px;
    }
}

.pending-title {
    font-weight: 600;
    margin-bottom: 15px;
    color: #9c27b0;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    position: relative;
    z-index: 2;
}

.pending-title::before {
    content: "üîî";
    animation: bellRing 1.5s infinite;
}

@keyframes bellRing {
    0%, 100% {
        transform: rotate(0deg);
    }
    10%, 30%, 50%, 70%, 90% {
        transform: rotate(15deg);
    }
    20%, 40%, 60%, 80% {
        transform: rotate(-15deg);
    }
}

.pending-details {
    display: flex;
    flex-direction: column;
    gap: 10px;
    position: relative;
    z-index: 2;
}

.pending-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
}

.pending-row:last-child {
    border-bottom: none;
}

.pending-label {
    font-weight: 500;
    color: var(--text);
}

.pending-value {
    font-weight: 600;
    font-family: 'Courier New', monospace;
}

.pending-fee {
    color: var(--danger);
    font-weight: 700;
}

/* -----------------------------------------------------
   CARDS
------------------------------------------------------ */
.cards-section {
    margin-top: 40px;
}

.cards-section h2 {
    margin-bottom: 20px;
}

.cards-carousel {
    display: flex;
    gap: 25px;
    overflow-x: auto;
    padding-bottom: 20px;
    scrollbar-width: thin;
    scrollbar-color: var(--accent) transparent;
}

.cards-carousel::-webkit-scrollbar {
    height: 8px;
}

.cards-carousel::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 10px;
}

.cards-carousel::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 10px;
}

.card-container {
    width: 360px;
    height: 220px;
    perspective: 1000px;
    flex-shrink: 0;
}

.card {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    cursor: pointer;
}

.card.flipped {
    transform: rotateY(180deg);
}

.card-face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 20px;
    padding: 25px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    box-shadow: var(--card-shadow);
}

.card-front {
    background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
    color: white;
    position: relative;
    overflow: hidden;
}

.card-carbon .card-front {
    background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
}

.card-back {
    background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
    color: white;
    transform: rotateY(180deg);
    position: relative;
    overflow: hidden;
}

.card-carbon .card-back {
    background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
}

.card-chip {
    width: 50px;
    height: 40px;
    background-image: url('https://t4.ftcdn.net/jpg/00/63/97/01/360_F_63970103_dXdz645GQ9DjenhJOti1eEvsFZY8gucA.jpg');
    background-size: cover;
    background-position: center;
    border-radius: 8px;
    position: relative;
    overflow: hidden;
}

.card-number {
    font-size: 20px;
    letter-spacing: 2px;
    margin: 15px 0;
    font-family: 'Courier New', monospace;
    font-weight: 600;
}

.card-details {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    align-items: flex-end;
}

.card-logo {
    height: 30px;
    object-fit: contain;
    margin-top: 10px;
}

.card-back .magnetic-strip {
    height: 40px;
    background: #000;
    margin: 20px -25px;
    position: relative;
    z-index: 2;
}

.card-back .cvv-section {
    background: white;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: 0 15px;
    margin: 15px -25px;
    position: relative;
    z-index: 2;
}

.card-back .cvv {
    background: white;
    color: black;
    padding: 5px 12px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-weight: 700;
    font-size: 16px;
    border: 1px solid #ddd;
}

.card-back .signature-panel {
    margin-top: 10px;
    padding: 8px 15px;
    background: repeating-linear-gradient(
        45deg,
        transparent,
        transparent 5px,
        rgba(255,255,255,0.1) 5px,
        rgba(255,255,255,0.1) 10px
    );
    font-size: 12px;
    position: relative;
    z-index: 2;
}

.light-reflect {
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: radial-gradient(circle at var(--x) var(--y), rgba(255, 255, 255, 0.15), transparent 60%);
    border-radius: 20px;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 1;
}

.card-container:hover .light-reflect {
    opacity: 1;
}

.card-limits-container {
    background: var(--panel);
    padding: 20px;
    border-radius: 12px;
    margin: 15px 0;
    border-left: 4px solid var(--accent);
}

.card-limits-title {
    font-weight: 600;
    margin-bottom: 15px;
    color: var(--accent);
    font-size: 16px;
}

.card-limit-details {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.limit-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
    font-size: 14px;
}

.limit-type {
    opacity: 0.8;
}

.limit-amount {
    font-weight: 600;
    font-family: 'Courier New', monospace;
}

/* -----------------------------------------------------
   RELEVE IBAN SECTION AVEC ADRESSE
------------------------------------------------------ */
.releve-container {
    background: var(--panel);
    padding: 25px;
    border-radius: 16px;
    box-shadow: var(--card-shadow);
    margin: 25px 0;
}

.releve-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.releve-header h3 {
    margin: 0;
    color: var(--accent);
    font-size: 20px;
}

.iban-info {
    background: var(--bg);
    padding: 20px;
    border-radius: 12px;
    border: 1px solid var(--border);
}

.iban-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 12px;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
}

.iban-row:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.iban-label {
    font-weight: 600;
    color: var(--accent);
    min-width: 150px;
}

.iban-value {
    font-family: 'Courier New', monospace;
    font-weight: 600;
}

.copy-btn {
    background: var(--accent);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    transition: background-color 0.3s;
}

.copy-btn:hover {
    background: var(--accent-hover);
}

/* -----------------------------------------------------
   ACTIONS & FORMS - BOUTONS 3D
------------------------------------------------------ */
.actions {
    margin-top: 30px;
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.btn {
    padding: 18px 32px;
    border: none;
    border-radius: 14px;
    color: white;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    flex: 1;
    min-width: 220px;
    background: linear-gradient(145deg, var(--virement-btn-color), var(--virement-btn-hover));
    box-shadow: 
        0 8px 16px rgba(245, 158, 11, 0.3),
        0 15px 30px rgba(245, 158, 11, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -1px 0 rgba(0, 0, 0, 0.2);
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 100%);
    z-index: 1;
    opacity: 0;
    transition: opacity 0.3s;
}

.btn:hover {
    transform: translateY(-6px) scale(1.03);
    box-shadow: 
        0 15px 30px rgba(245, 158, 11, 0.4),
        0 25px 50px rgba(245, 158, 11, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.5),
        inset 0 -1px 0 rgba(0, 0, 0, 0.3);
}

.btn:hover::before {
    opacity: 1;
}

.btn:active {
    transform: translateY(-2px);
}

/* Bouton Virement - COULEUR SP√âCIFIQUE */
#showVirement {
    background: linear-gradient(145deg, var(--virement-btn-color), var(--virement-btn-hover)) !important;
}

#showVirement:hover {
    background: linear-gradient(145deg, var(--virement-btn-hover), var(--virement-btn-color)) !important;
}

/* Bouton RIB - COULEUR SP√âCIFIQUE */
#showRIB {
    background: linear-gradient(145deg, var(--rib-btn-color), var(--rib-btn-hover)) !important;
    box-shadow: 
        0 8px 16px rgba(139, 92, 246, 0.3),
        0 15px 30px rgba(139, 92, 246, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -1px 0 rgba(0, 0, 0, 0.2);
}

#showRIB:hover {
    background: linear-gradient(145deg, var(--rib-btn-hover), var(--rib-btn-color)) !important;
    box-shadow: 
        0 15px 30px rgba(139, 92, 246, 0.4),
        0 25px 50px rgba(139, 92, 246, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.5),
        inset 0 -1px 0 rgba(0, 0, 0, 0.3);
}

/* -----------------------------------------------------
   FORMULAIRE VIREMENT AM√âLIOR√â
------------------------------------------------------ */
.form-panel {
    margin-top: 25px;
    background: var(--panel);
    border-radius: 16px;
    box-shadow: 0 8px 20px var(--shadow);
    padding: 0 25px;
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transition: max-height 0.5s ease, opacity 0.5s ease, padding 0.5s ease;
}

.form-panel.active {
    padding: 30px;
    opacity: 1;
    max-height: 1200px;
}

.form-panel h3 {
    margin-top: 0;
    margin-bottom: 20px;
    color: var(--accent);
}

.form-panel h4 {
    margin-top: 25px;
    margin-bottom: 15px;
    color: var(--accent);
    font-size: 18px;
}

.form-panel input, .form-panel select, .form-panel textarea {
    width: 100%;
    padding: 14px;
    border-radius: 10px;
    border: 1px solid var(--border);
    margin-bottom: 20px;
    background: var(--bg);
    color: var(--text);
    font-size: 16px;
    transition: border-color 0.3s, box-shadow 0.3s;
}

.form-panel input:focus, .form-panel select:focus, .form-panel textarea:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0, 68, 204, 0.1);
}

.form-panel button[type="submit"] {
    padding: 16px 28px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(145deg, var(--accent), var(--accent-hover));
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.4s;
    width: 100%;
    font-size: 16px;
    box-shadow: 
        0 6px 12px rgba(0, 68, 204, 0.2),
        0 10px 20px rgba(0, 68, 204, 0.15);
}

.form-panel button[type="submit"]:hover {
    background: linear-gradient(145deg, var(--accent-hover), var(--accent));
    transform: translateY(-3px);
    box-shadow: 
        0 10px 20px rgba(0, 68, 204, 0.3),
        0 15px 30px rgba(0, 68, 204, 0.25);
}

/* -----------------------------------------------------
   TRANSFER NAVIGATION BUTTONS
------------------------------------------------------ */
.transfer-navigation {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 2px solid var(--border);
}

.transfer-nav-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    background: var(--accent);
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    min-width: 120px;
}

.transfer-nav-btn:hover:not(:disabled) {
    background: var(--accent-hover);
    transform: translateY(-2px);
}

.transfer-nav-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.transfer-nav-btn.back {
    background: var(--border);
    color: var(--text);
}

.transfer-nav-btn.back:hover:not(:disabled) {
    background: var(--text);
    color: var(--bg);
}

.transfer-nav-btn.next {
    background: var(--success);
}

.transfer-nav-btn.next:hover:not(:disabled) {
    background: #0da271;
}

.transfer-nav-btn.confirm {
    background: var(--accent);
}

/* -----------------------------------------------------
   BENEFICIARY SELECTION
------------------------------------------------------ */
.beneficiary-selection {
    margin-bottom: 25px;
}

.beneficiary-options {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
}

.beneficiary-option-btn {
    flex: 1;
    padding: 15px;
    border: 2px solid var(--border);
    background: var(--bg);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
    font-weight: 600;
}

.beneficiary-option-btn:hover {
    border-color: var(--accent);
    background: rgba(0, 68, 204, 0.05);
}

.beneficiary-option-btn.active {
    border-color: var(--accent);
    background: rgba(0, 68, 204, 0.1);
    color: var(--accent);
}

.beneficiary-option-btn.active::before {
    content: "‚úì ";
}

/* -----------------------------------------------------
   HISTORIQUE
------------------------------------------------------ */
#historicPage {
    display: none;
}

.historic-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.table-container {
    background: var(--panel);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: var(--card-shadow);
}

.table {
    width: 100%;
    border-collapse: collapse;
}

.table th {
    background: var(--accent);
    color: white;
    text-align: left;
    padding: 18px 20px;
    font-weight: 600;
}

.table td {
    padding: 18px 20px;
    border-bottom: 1px solid var(--border);
}

.table tr:last-child td {
    border-bottom: none;
}

.table tr:hover {
    background: rgba(0, 0, 0, 0.03);
}

.negative {
    color: var(--danger);
    font-weight: 600;
}

.positive {
    color: var(--success);
    font-weight: 600;
}

/* -----------------------------------------------------
   RIB LIST STYLES AM√âLIOR√âE
------------------------------------------------------ */
.rib-list-container {
    max-height: 400px;
    overflow-y: auto;
    border-radius: 12px;
    border: 2px solid var(--border);
    margin-top: 20px;
    background: var(--bg);
}

.rib-list-header {
    padding: 15px;
    background: var(--panel);
    border-bottom: 2px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 600;
    color: var(--accent);
    position: sticky;
    top: 0;
    z-index: 10;
}

.rib-list-count {
    background: var(--accent);
    color: white;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 12px;
}

.rib-list-content {
    padding: 10px;
}

.rib-item {
    padding: 15px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--panel);
    margin-bottom: 8px;
    border-radius: 10px;
    transition: all 0.3s;
    border: 1px solid var(--border);
}

.rib-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px var(--shadow);
    background: var(--accent);
    color: white;
}

.rib-item:hover .rib-name,
.rib-item:hover .rib-details,
.rib-item:hover .rib-email {
    color: white !important;
}

.rib-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.rib-info {
    flex: 1;
    min-width: 0;
    margin-right: 15px;
}

.rib-name {
    font-weight: 600;
    margin-bottom: 5px;
    color: var(--accent);
    font-size: 15px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.rib-details {
    font-size: 13px;
    opacity: 0.8;
    margin-bottom: 3px;
    font-family: monospace;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.rib-email {
    color: var(--accent);
    font-size: 13px;
    font-style: italic;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.rib-actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
}

.edit-rib, .delete-rib {
    padding: 8px 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.3s;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 5px;
}

.edit-rib {
    background: var(--info);
    color: white;
}

.edit-rib:hover {
    background: #2563eb;
    transform: scale(1.05);
}

.delete-rib {
    background: var(--danger);
    color: white;
}

.delete-rib:hover {
    background: #b00020;
    transform: scale(1.05);
}

.no-ribs {
    text-align: center;
    padding: 40px;
    opacity: 0.7;
    font-style: italic;
    color: var(--text);
}

/* -----------------------------------------------------
   PAGE PARAM√àTRES
------------------------------------------------------ */
#parametresPage {
    display: none;
}

.parametres-container {
    background: var(--panel);
    padding: 30px;
    border-radius: 20px;
    box-shadow: var(--card-shadow);
    margin-bottom: 30px;
}

.parametres-section {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border);
}

.parametres-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.parametres-section-title {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 20px;
    color: var(--accent);
    display: flex;
    align-items: center;
    gap: 10px;
}

.parametres-section-title::before {
    font-size: 22px;
}

.parametre-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: var(--bg);
    border-radius: 10px;
    margin-bottom: 10px;
    border: 1px solid var(--border);
    transition: all 0.3s;
}

.parametre-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px var(--shadow);
}

.parametre-label {
    font-weight: 600;
    color: var(--text);
}

.parametre-value {
    font-weight: 600;
    color: var(--accent);
}

.switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: var(--success);
}

input:checked + .slider:before {
    transform: translateX(26px);
}

/* -----------------------------------------------------
   RESPONSIVE - AM√âLIOR√â POUR LES BOUTONS 3D
------------------------------------------------------ */
@media (max-width: 1200px) {
    .sidebar {
        width: 250px;
        padding: 20px 15px;
    }
    
    .menu-item, .menu-item-intelligent-messagerie, .menu-item-parametres {
        padding: 12px 15px;
        font-size: 14px;
        gap: 12px;
        min-height: 45px;
    }
    
    .menu-item i {
        font-size: 18px;
        width: 20px;
    }
    
    .content {
        padding: 30px 40px;
    }
}

@media (max-width: 1024px) {
    .wrapper {
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        flex-direction: row;
        overflow-x: auto;
        padding: 15px;
        gap: 8px;
        flex-wrap: nowrap;
        justify-content: flex-start;
        min-height: auto;
        overflow-y: hidden;
        box-shadow: 0 4px 15px var(--shadow);
        border-bottom: 1px solid var(--border);
    }
    
    .menu-item, .menu-item-intelligent-messagerie, .menu-item-parametres {
        white-space: nowrap;
        flex-shrink: 0;
        min-width: max-content;
        padding: 12px 15px;
        font-size: 13px;
        min-height: 44px;
    }
    
    .menu-item i, .menu-item-intelligent-messagerie::before, .menu-item-parametres::before {
        font-size: 16px;
        margin-right: 5px;
    }
    
    .messagerie-sidebar {
        display: none;
    }
    
    .toggle {
        margin-top: 0;
        margin-left: auto;
    }
    
    .content {
        padding: 25px 30px;
    }
    
    .logo-image {
        width: 100px;
        height: 100px;
    }
    
    .profile-logo {
        width: 70px;
        height: 70px;
    }
    
    .card-container {
        width: 320px;
    }
    
    .notification.alert {
        max-width: 350px;
    }
    
    .actions {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
        justify-content: center;
    }
    
    .secupass-box {
        width: 90%;
        padding: 30px 20px;
    }
    
    .security-banner {
        flex-direction: column;
        gap: 10px;
        text-align: center;
        padding: 15px;
    }
    
    .security-banner .left, .security-banner .right {
        justify-content: center;
        flex-wrap: wrap;
    }
    
    /* Am√©lioration des boutons 3D sur tablette */
    .menu-item:hover, .menu-item-intelligent-messagerie:hover, .menu-item-parametres:hover {
        transform: translateY(-2px) scale(1.01);
    }
    
    .menu-item.active::after {
        display: none;
    }
}

@media (max-width: 768px) {
    .sidebar {
        padding: 12px 10px;
        gap: 6px;
    }
    
    .menu-item, .menu-item-intelligent-messagerie, .menu-item-parametres {
        padding: 10px 12px;
        font-size: 12px;
        gap: 8px;
        min-height: 40px;
        letter-spacing: 0.3px;
    }
    
    .menu-item i, .menu-item-intelligent-messagerie::before, .menu-item-parametres::before {
        font-size: 14px;
        width: 16px;
    }
    
    .content {
        padding: 20px;
    }
    
    .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 20px;
    }
    
    .balance-value {
        font-size: 32px;
    }
    
    .actions {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
        justify-content: center;
        min-width: unset;
        padding: 16px 24px;
        font-size: 14px;
    }
    
    .card-container {
        width: 300px;
        height: 200px;
    }
    
    .table-container {
        overflow-x: auto;
    }
    
    .rib-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .rib-actions {
        align-self: flex-end;
        margin-top: 10px;
    }
    
    .logo-image {
        width: 90px;
        height: 90px;
    }
    
    .profile-logo {
        width: 60px;
        height: 60px;
    }
    
    .iban-row {
        flex-direction: column;
        gap: 5px;
    }
    
    .iban-label {
        min-width: auto;
    }
    
    .notification.alert {
        max-width: 300px;
        right: 15px;
        top: 15px;
    }
    
    .secupass-btn {
        padding: 15px;
        font-size: 18px;
    }
    
    .secupass-input {
        font-size: 18px;
        padding: 15px;
    }
    
    .transfer-steps {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }
    
    .transfer-steps::before {
        display: none;
    }
    
    .transfer-step-item {
        display: flex;
        align-items: center;
        gap: 15px;
        width: 100%;
    }
    
    .step-number {
        margin: 0;
        width: 35px;
        height: 35px;
        font-size: 14px;
    }
    
    .step-label {
        font-size: 13px;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .transfer-navigation {
        flex-direction: column;
        gap: 10px;
    }
    
    .transfer-nav-btn {
        width: 100%;
    }
    
    /* Am√©lioration des boutons 3D sur mobile */
    .security-banner {
        font-size: 12px;
        padding: 10px;
    }
    
    .security-badge {
        padding: 3px 8px;
        font-size: 10px;
    }
    
    .security-info {
        font-size: 11px;
    }
}

@media (max-width: 480px) {
    .sidebar {
        padding: 10px 8px;
        gap: 5px;
    }
    
    .menu-item, .menu-item-intelligent-messagerie, .menu-item-parametres {
        padding: 8px 10px;
        font-size: 11px;
        gap: 6px;
        min-height: 38px;
        letter-spacing: 0.2px;
    }
    
    .menu-item i, .menu-item-intelligent-messagerie::before, .menu-item-parametres::before {
        font-size: 13px;
        width: 14px;
    }
    
    .security-banner {
        font-size: 11px;
        padding: 8px;
    }
    
    .security-badge {
        padding: 2px 6px;
        font-size: 9px;
    }
    
    .security-info {
        font-size: 10px;
    }
    
    .content {
        padding: 15px;
    }
    
    .balance-value {
        font-size: 28px;
    }
    
    .card-container {
        width: 280px;
        height: 180px;
    }
    
    .card-face {
        padding: 20px;
    }
    
    .card-number {
        font-size: 16px;
    }
    
    .btn {
        padding: 14px 20px;
        font-size: 13px;
    }
    
    /* Derniers ajustements pour tr√®s petits √©crans */
    .menu-item span, .menu-item-intelligent-messagerie span, .menu-item-parametres span {
        display: inline-block;
        max-width: 80px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
}

@media (max-width: 360px) {
    .menu-item, .menu-item-intelligent-messagerie, .menu-item-parametres {
        padding: 7px 8px;
        font-size: 10px;
    }
    
    .menu-item i, .menu-item-intelligent-messagerie::before, .menu-item-parametres::before {
        font-size: 12px;
        width: 12px;
    }
    
    .balance-value {
        font-size: 24px;
    }
}

/* -----------------------------------------------------
   ICONS
------------------------------------------------------ */
.icon-home::before { content: "üè†"; }
.icon-history::before { content: "üìä"; }
.icon-transfer::before { content: "üí∏"; }
.icon-rib::before { content: "üìÑ"; }
.icon-logout::before { content: "üö™"; }
.icon-theme::before { content: "üåô"; }
.icon-bank::before { content: "üè¶"; }
.icon-copy::before { content: "üìã"; }
.icon-card::before { content: "üí≥"; }
.icon-document::before { content: "üìù"; }
.icon-message::before { content: "üì®"; }
.icon-filter::before { content: "üîç"; }
.icon-settings::before { content: "‚öôÔ∏è"; }
.icon-edit::before { content: "‚úèÔ∏è"; }
.icon-delete::before { content: "üóëÔ∏è"; }
</style>
</head>

<body>

<!-- LOADING OVERLAY -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loadingText">Traitement en cours</div>
    <div class="loading-details" id="loadingDetails">V√©rification de s√©curit√©...</div>
</div>

<!-- SECUPASS OVERLAY -->
<div class="secupass-overlay" id="secupassOverlay">
    <div class="secupass-box">
        <div class="secupass-title">üîê Code SecuPass</div>
        <div class="secupass-subtitle" id="secupassOperation">Confirmez votre op√©ration</div>
        
        <input type="text" id="secupassCode" class="secupass-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="6" readonly>
        
        <div id="secupassNumpad" class="secupass-numpad"></div>
        
        <div class="secupass-actions">
            <button id="secupassConfirm" class="secupass-confirm">Valider</button>
            <button id="secupassCancel" class="secupass-cancel">Annuler</button>
        </div>
        
        <div id="secupassError" class="secupass-error"></div>
    </div>
</div>

<!-- MESSAGERIE INTELLIGENTE OVERLAY -->
<div class="smart-messagerie-overlay" id="smartMessagerieOverlay">
    <div class="smart-messagerie-container">
        <div class="smart-messagerie-header">
            <div class="smart-messagerie-title">
                Messagerie
                <span class="smart-messagerie-count" id="smartMessageCount">0</span>
            </div>
            <button class="smart-message-action-btn" onclick="closeSmartMessagerie()">‚úï</button>
        </div>
        
        <div class="smart-messagerie-content" id="smartMessagerieContent">
            <!-- Les messages intelligents seront ajout√©s ici dynamiquement -->
        </div>
        
        <div class="smart-messagerie-footer">
            <button class="smart-messagerie-btn mark-all-read" onclick="markAllSmartMessagesRead()">
                Tout marquer comme lu
            </button>
            <button class="smart-messagerie-btn ai-assistant" onclick="generateAIAssistantMessage()">
                 Assistant IA
            </button>
            <button class="smart-messagerie-btn delete-all" onclick="deleteAllSmartMessages()">
                Tout supprimer
            </button>
        </div>
    </div>
</div>

<!-- -----------------------------------------------------
    LOGIN PAGE (2 √âTAPES)
------------------------------------------------------ -->
<div id="loginPage">
    <div class="login-box">
        <!-- LOGO -->
        <div class="logo">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQthChvrfBkU2-OmNNojb2gELp9EG_Xty8CBQ&s" alt="Logo Banque Priv√©e" class="logo-image">
            <h1 class="logo-text">SOCIETE GENERALE</h1>
        </div>

        <!-- √âTAPE 1 : IDENTIFIANT -->
        <div id="stepID">
            <h2>Identifiant</h2>
            <input id="user" placeholder="Identifiant" autocomplete="off" aria-label="Identifiant">
            <button id="validateID" aria-label="Continuer">Continuer</button>
            <div id="idErr" class="error"></div>
        </div>

        <!-- √âTAPE 2 : CODE SECRET -->
        <div id="stepPASS" style="display:none;">
            <h2>Code secret</h2>
            <input id="pass" placeholder="Code secret" readonly aria-label="Code secret">

            <div id="numpad" class="numpad"></div>

            <button id="loginBtn" aria-label="Se connecter">Se connecter</button>
            <div id="loginErr" class="error"></div>
        </div>
    </div>
</div>

<!-- -----------------------------------------------------
    MAIN APP
------------------------------------------------------ -->
<div id="app">
    <!-- SECURITY BANNER - FOND NOIR -->
    <div class="security-banner">
        <div class="left">
            <span class="security-badge">Session s√©curis√©e HTTPS</span>
            <span class="security-info">Derni√®re connexion : <span id="lastLoginDisplay"></span></span>
        </div>
        <div class="right">
            <span class="security-info">IP s√©curis√©e : 192.168.1.1</span>
            <span class="security-badge">Prot√©g√© par SecuPass</span>
        </div>
    </div>

    <div class="wrapper">
        <!-- SIDEBAR AVEC BOUTONS 3D RESPONSIVES -->
        <div class="sidebar">
            <div class="menu-item active" onclick="showPage('dashboard')" aria-label="Accueil">
                <span class="icon-home"></span> <span>Accueil</span>
            </div>
            <div class="menu-item" onclick="showPage('historic')" aria-label="Historique">
                <span class="icon-history"></span> <span>Historique</span>
            </div>
            <div class="menu-item" onclick="showPage('releve')" aria-label="Relev√© IBAN">
                <span class="icon-document"></span> <span>Relev√© IBAN</span>
            </div>
            
            <!-- MESSAGERIE INTELLIGENTE -->
            <div class="menu-item-intelligent-messagerie" onclick="openSmartMessagerie()" aria-label="Messagerie">
                <span>Messagerie</span>
            </div>
            
            <!-- MESSAGERIE DANS LA SIDEBAR -->
            <div class="messagerie-sidebar">
                <div class="messagerie-toggle" onclick="toggleMessagerie()" aria-label="Ouvrir la messagerie">
                    <span class="icon-message"></span> Messagerie
                    <span class="messagerie-count" id="messageCount">0</span>
                </div>
                
                <div class="messagerie-container" id="messagerieContainer">
                    <div class="select-all-container" id="selectAllContainer" style="display: none;">
                        <span class="select-all-label">Tout s√©lectionner</span>
                        <input type="checkbox" class="select-all-checkbox" id="selectAllCheckbox" onchange="toggleSelectAll(this.checked)" aria-label="Tout s√©lectionner">
                    </div>
                    <div class="messagerie-content" id="messagerieContent">
                        <!-- Les messages seront ajout√©s ici dynamiquement -->
                    </div>
                    <div class="messagerie-footer">
                        <button onclick="deleteSelectedMessages()" class="delete-selected" aria-label="Supprimer la s√©lection">Supprimer s√©lection</button>
                        <button onclick="clearAllMessages()" aria-label="Effacer tous les messages">Tout effacer</button>
                    </div>
                </div>
            </div>
            
            <div class="menu-item" onclick="logout()" aria-label="D√©connexion">
                <span class="icon-logout"></span> <span>D√©connexion</span>
            </div>
            
            <!-- PARAM√àTRES PLAC√â ICI, JUSTE AU-DESSUS DE MODE SOMBRE -->
            <div class="menu-item-parametres" onclick="showPage('parametres')" aria-label="Param√®tres">
                <span>Param√®tres</span>
            </div>
            
            <div id="themeToggle" class="menu-item" aria-label="Changer le th√®me">
                <span class="icon-theme"></span> <span>Mode sombre</span>
            </div>
        </div>

        <!-- CONTENT -->
        <div class="content">
            <!-- LAST LOGIN DISPLAY -->
            <div class="last-login-display">
                <span class="last-login-label">Derni√®re activit√© :</span>
                <span class="last-login-value" id="lastActivityDisplay">--:--</span>
            </div>

            <!-- DASHBOARD -->
            <div id="dashboardPage">
                <div class="header">
                    <div>
                        <h1 id="userGreeting">Bonjour Andrea</h1>
                        <p>SOCIETE GENERALE - Interface Premium</p>
                    </div>
                    <div class="profile">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQXq08ow6NChjGwNYQWpsgV09_uS1w0tXzPPA&s" alt="SOCIETE GENERALE" class="profile-logo">
                    </div>
                </div>

                <div class="balance-container">
                    <div class="balance-label">Compte s√©lectionn√©</div>
                    <select id="accountSelect"></select>
                    <div id="balanceValue" class="balance-value">0,00 ‚Ç¨</div>
                    <!-- STATUT DYNAMIQUE DU COMPTE -->
                    <div class="status" id="accountStatus">
                        <i id="statusIcon"></i> <span id="statusText">Compte actif</span>
                    </div>
                </div>

                <!-- Plafonds de virement -->
                <div class="limits-container" id="limitsContainer">
                    <div class="limits-title">Plafonds de virement</div>
                    <div class="limit-item">
                        <span>Journalier :</span>
                        <span id="dailyUsed">0,00 ‚Ç¨</span> / <span id="dailyLimit">5 000,00 ‚Ç¨</span>
                    </div>
                    <div class="limit-usage">
                        <div class="limit-usage-bar" id="dailyBar" style="width: 0%"></div>
                    </div>
                    <div class="limit-item">
                        <span>Mensuel :</span>
                        <span id="monthlyUsed">0,00 ‚Ç¨</span> / <span id="monthlyLimit">15 000,00 ‚Ç¨</span>
                    </div>
                    <div class="limit-usage">
                        <div class="limit-usage-bar" id="monthlyBar" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Informations virements en attente (ENTRANTS ET SORTANTS) -->
                <div class="pending-transfer-limits" id="pendingTransferLimits">
                    <div class="pending-title">Virements en attente</div>
                    <div class="pending-details">
                        <div class="pending-row">
                            <span class="pending-label">En attente d'entr√©e :</span>
                            <span class="pending-value" id="pendingAmountIncoming">125.798,00 ‚Ç¨</span>
                        </div>
                        <div class="pending-row">
                            <span class="pending-label">Frais de 10% :</span>
                            <span class="pending-value pending-fee" id="pendingFeeIncoming">12.579,80 ‚Ç¨</span>
                        </div>
                        <div class="pending-row">
                            <span class="pending-label">√Ä r√©gler :</span>
                            <span class="pending-value pending-fee" id="pendingTotalIncoming">12.579,80 ‚Ç¨</span>
                        </div>
                        <div class="pending-row" style="border-top: 2px solid var(--border); margin-top: 10px; padding-top: 12px;">
                            <span class="pending-label">En attente de sortie :</span>
                            <span class="pending-value" id="pendingAmountOutgoing">125.798,00 ‚Ç¨</span>
                        </div>
                        <div class="pending-row">
                            <span class="pending-label">Frais de traitement :</span>
                            <span class="pending-value pending-fee" id="pendingFeeOutgoing">2.515,96 ‚Ç¨</span>
                        </div>
                    </div>
                </div>

                <!-- SECTION ACTIONS AVEC DEUX BOUTONS IDENTIQUES -->
                <div class="actions">
                    <button class="btn" id="showVirement" aria-label="Passer un virement">
                        <span class="icon-transfer"></span> Passer un virement
                    </button>
                    <button class="btn" id="showRIB" aria-label="Ajouter un RIB">
                        <span class="icon-rib"></span> Ajouter un RIB
                    </button>
                </div>

                <!-- FORM VIREMENT AVEC √âTAPES -->
                <div id="virementPanel" class="form-panel">
                    <h3>Passer un virement</h3>
                    
                    <!-- √âTAPES DE NAVIGATION -->
                    <div class="transfer-steps" id="transferSteps">
                        <div class="transfer-step-item active" id="step1Indicator">
                            <div class="step-number">1</div>
                            <div class="step-label">Montant et motif</div>
                        </div>
                        <div class="transfer-step-item" id="step2Indicator">
                            <div class="step-number">2</div>
                            <div class="step-label">B√©n√©ficiaire</div>
                        </div>
                        <div class="transfer-step-item" id="step3Indicator">
                            <div class="step-number">3</div>
                            <div class="step-label">R√©capitulatif</div>
                        </div>
                    </div>

                    <!-- √âTAPE 1 : MONTANT ET MOTIF -->
                    <div class="transfer-step-content active" id="step1Content">
                        <div class="form-section-title">Montant du virement</div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required" for="montantV">Montant (‚Ç¨)</label>
                                <input type="number" step="0.01" id="montantV" placeholder="0,00" required>
                                <button type="button" class="help-btn" onclick="showTechnicalDetails('montantHelp')">?</button>
                                <div class="technical-details" id="montantHelp">
                                    <div class="technical-details-title">Validation du montant</div>
                                    <p>Le montant est valid√© selon les crit√®res suivants :</p>
                                    <ul>
                                        <li>Doit √™tre sup√©rieur √† 0,01 ‚Ç¨</li>
                                        <li>Ne doit pas d√©passer votre solde disponible</li>
                                        <li>Doit respecter les plafonds journaliers et mensuels</li>
                                        <li>Les d√©cimales sont s√©par√©es par une virgule</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required" for="motifVirement">Motif du virement</label>
                                <input type="text" id="motifVirement" placeholder="Ex: Facture, Remboursement, Salaire..." required>
                                <span class="form-hint">Maximum 140 caract√®res</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="dateVirement">Date de valeur</label>
                            <select id="dateVirement">
                                <option value="immediate">Imm√©diate</option>
                                <option value="programmed">Programm√©e (3 jours ouvr√©s)</option>
                            </select>
                            <span class="form-hint">Une virement programm√© sera ex√©cut√© dans 3 jours ouvr√©s</span>
                        </div>

                        <div class="limits-container">
                            <div class="limits-title">V√©rification des plafonds</div>
                            <div class="limit-item">
                                <span>Disponible journalier :</span>
                                <span id="dailyAvailable">5 000,00 ‚Ç¨</span>
                            </div>
                            <div class="limit-item">
                                <span>Disponible mensuel :</span>
                                <span id="monthlyAvailable">15 000,00 ‚Ç¨</span>
                            </div>
                            <div class="limit-item">
                                <span>Solde disponible :</span>
                                <span id="soldeAvailable">0,00 ‚Ç¨</span>
                            </div>
                        </div>

                        <div class="transfer-navigation">
                            <button class="transfer-nav-btn next" onclick="nextTransferStep()">Suivant</button>
                        </div>
                    </div>

                    <!-- √âTAPE 2 : B√âN√âFICIAIRE -->
                    <div class="transfer-step-content" id="step2Content">
                        <div class="form-section-title">S√©lection du b√©n√©ficiaire</div>
                        
                        <div class="beneficiary-selection">
                            <div class="beneficiary-options">
                                <button class="beneficiary-option-btn active" onclick="selectBeneficiaryOption('existing')">
                                    B√©n√©ficiaire existant
                                </button>
                                <button class="beneficiary-option-btn" onclick="selectBeneficiaryOption('new')">
                                    Nouveau b√©n√©ficiaire
                                </button>
                            </div>

                            <!-- B√âN√âFICIAIRE EXISTANT -->
                            <div id="existingBeneficiarySection">
                                <div class="form-group">
                                    <label class="form-label required" for="ribSelect">S√©lectionnez un b√©n√©ficiaire</label>
                                    <select id="ribSelect" required>
                                        <option value="" disabled selected>Choisissez un b√©n√©ficiaire...</option>
                                    </select>
                                </div>
                            </div>

                            <!-- NOUVEAU B√âN√âFICIAIRE -->
                            <div id="newBeneficiarySection" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label required" for="newBeneficiaryName">Nom du b√©n√©ficiaire</label>
                                        <input type="text" id="newBeneficiaryName" placeholder="Nom complet">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label required" for="newBeneficiaryLabel">Libell√© du compte</label>
                                        <input type="text" id="newBeneficiaryLabel" placeholder="Ex: Compte courant personnel">
                                        <span class="form-hint">Comment appara√Ætra ce b√©n√©ficiaire dans votre liste</span>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label required" for="newBeneficiaryIBAN">IBAN</label>
                                        <input type="text" id="newBeneficiaryIBAN" placeholder="FR76 XXXX XXXX XXXX XXXX XXXX XXX">
                                        <button type="button" class="help-btn" onclick="showTechnicalDetails('ibanHelp')">?</button>
                                        <div class="technical-details" id="ibanHelp">
                                            <div class="technical-details-title">Validation IBAN</div>
                                            <p>L'IBAN (International Bank Account Number) est valid√© selon l'algorithme ISO 13616 :</p>
                                            <ul>
                                                <li>Format : FR76 suivi de 23 chiffres</li>
                                                <li>Cl√© de contr√¥le sur 2 chiffres</li>
                                                <li>Validation par modulo 97 (algorithme Luhn modifi√©)</li>
                                                <li>V√©rification du code pays et de la structure</li>
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label required" for="newBeneficiaryBIC">BIC (SWIFT)</label>
                                        <input type="text" id="newBeneficiaryBIC" placeholder="SOGEFRPPXXX">
                                        <span class="form-hint">11 caract√®res maximum</span>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label required" for="newBeneficiaryEmail">Email du b√©n√©ficiaire</label>
                                    <input type="email" id="newBeneficiaryEmail" placeholder="email@exemple.com">
                                    <span class="form-hint">Pour l'envoi de la confirmation de virement</span>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="newBeneficiaryAddress">Adresse (optionnel)</label>
                                    <input type="text" id="newBeneficiaryAddress" placeholder="Adresse postale">
                                </div>
                            </div>
                        </div>

                        <div class="transfer-navigation">
                            <button class="transfer-nav-btn back" onclick="prevTransferStep()">Retour</button>
                            <button class="transfer-nav-btn next" onclick="nextTransferStep()">Suivant</button>
                        </div>
                    </div>

                    <!-- √âTAPE 3 : R√âCAPITULATIF -->
                    <div class="transfer-step-content" id="step3Content">
                        <div class="form-section-title">R√©capitulatif du virement</div>
                        
                        <div class="transfer-summary" id="transferSummary">
                            <!-- Rempli dynamiquement par JavaScript -->
                        </div>

                        <div class="form-group">
                            <label class="form-label required" for="confirmationCode">Code de confirmation</label>
                            <input type="text" id="confirmationCode" placeholder="Saisissez 'CONFIRMER' pour valider" required>
                            <span class="form-hint">Tapez CONFIRMER en majuscules pour finaliser l'op√©ration</span>
                        </div>

                        <div class="transfer-navigation">
                            <button class="transfer-nav-btn back" onclick="prevTransferStep()">Retour</button>
                            <button class="transfer-nav-btn confirm" onclick="submitVirement()">Confirmer le virement</button>
                        </div>
                    </div>
                </div>

                <!-- FORM RIB AVEC CHAMP BIC -->
                <div id="ribPanel" class="form-panel">
                    <h3>Ajouter un RIB</h3>
                    <form id="ribForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required" for="ribName">Titulaire du compte</label>
                                <input type="text" id="ribName" placeholder="Nom complet" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required" for="ribLabel">Libell√© du compte</label>
                                <input type="text" id="ribLabel" placeholder="Ex: Compte √©pargne" required>
                                <span class="form-hint">Comment appara√Ætra ce b√©n√©ficiaire dans votre liste</span>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required" for="ribIBAN">IBAN</label>
                                <input type="text" id="ribIBAN" placeholder="FR76 XXXX XXXX XXXX XXXX XXXX XXX" required>
                                <div id="ibanError" class="error-details"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required" for="ribBIC">BIC (SWIFT)</label>
                                <input type="text" id="ribBIC" placeholder="SOGEFRPPXXX" required>
                                <span class="form-hint">Format : 8 ou 11 caract√®res</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required" for="ribEmail">Adresse e-mail du b√©n√©ficiaire</label>
                            <input type="email" id="ribEmail" placeholder="email@exemple.com" required>
                            <span class="form-hint">Pour l'envoi des confirmations de virement</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="ribAddress">Adresse (optionnel)</label>
                            <textarea id="ribAddress" placeholder="Adresse postale compl√®te" rows="3"></textarea>
                        </div>

                        <button type="submit">Ajouter le b√©n√©ficiaire</button>
                    </form>
                    
                    <h4 style="margin-top: 20px;">B√©n√©ficiaires enregistr√©s (10 derniers)</h4>
                    <div class="rib-list-container">
                        <div class="rib-list-header">
                            <span>Liste des b√©n√©ficiaires</span>
                            <span class="rib-list-count" id="ribCount">0</span>
                        </div>
                        <div class="rib-list-content" id="ribListContent">
                            <!-- Les RIB seront ajout√©s ici dynamiquement -->
                        </div>
                    </div>
                </div>

                <div class="cards-section">
                    <h2>Vos cartes</h2>
                    <div class="cards-carousel">
                        <!-- CARTE VISA -->
                        <div class="card-wrapper">
                            <div class="card-container">
                                <div class="card card-metal" onclick="flipCard(this)" aria-label="Retourner la carte">
                                    <!-- Face avant -->
                                    <div class="card-face card-front">
                                        <div class="light-reflect"></div>
                                        <div class="card-chip"></div>
                                        <div class="card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 5290</div>
                                        <div class="card-details">
                                            <div>
                                                <div id="cardName">A. DUPONT</div>
                                                <div>03/29</div>
                                            </div>
                                            <img src="https://monisnapcontent.kinsta.cloud/wp-content/uploads/2020/11/wcwjffllcbjvnme2jvmt-1280x486.jpg?v=1605486258" alt="Visa" class="card-logo">
                                            </div>
                                    </div>
                                    <!-- Face arri√®re -->
                                    <div class="card-face card-back">
                                        <div class="light-reflect"></div>
                                        <div class="magnetic-strip"></div>
                                        <div class="cvv-section">
                                            <div class="cvv">123</div>
                                        </div>
                                        <div class="signature-panel">
                                            <div style="color: #666; font-style: italic;">Signature</div>
                                        </div>
                                        <div style="margin-top: 10px; font-size: 10px; padding: 0 10px; color: #ccc;">
                                            Cette carte est la propri√©t√© de la banque. En cas de perte ou vol, merci de contacter imm√©diatement notre service client.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Plafonds pour la carte Visa -->
                            <div class="card-limits-container">
                                <div class="card-limits-title">Carte Visa Infinite ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 5290</div>
                                <div class="card-limit-details">
                                    <div class="limit-row">
                                        <span class="limit-type">Retrait journalier :</span>
                                        <span class="limit-amount">500 ‚Ç¨</span>
                                    </div>
                                    <div class="limit-row">
                                        <span class="limit-type">Paiement journalier :</span>
                                        <span class="limit-amount">3 000 ‚Ç¨</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CARTE MASTERCARD -->
                        <div class="card-wrapper">
                            <div class="card-container">
                                <div class="card card-carbon" onclick="flipCard(this)" aria-label="Retourner la carte">
                                    <!-- Face avant -->
                                    <div class="card-face card-front">
                                        <div class="light-reflect"></div>
                                        <div class="card-chip"></div>
                                        <div class="card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 9481</div>
                                        <div class="card-details">
                                            <div>
                                                <div id="cardName2">A. DUPONT</div>
                                                <div>01/30</div>
                                            </div>
                                            <img src="https://s3-eu-central-1.amazonaws.com/topcompare-blogassets/blog/fr_BE/wp-content/uploads/2021/04/12094833/mastercard-desktop.png" alt="Mastercard" class="card-logo">
                                        </div>
                                    </div>
                                    <!-- Face arri√®re -->
                                    <div class="card-face card-back">
                                        <div class="light-reflect"></div>
                                        <div class="magnetic-strip"></div>
                                        <div class="cvv-section">
                                            <div class="cvv">456</div>
                                        </div>
                                        <div class="signature-panel">
                                            <div style="color: #666; font-style: italic;">Signature</div>
                                        </div>
                                        <div style="margin-top: 10px; font-size: 10px; padding: 0 10px; color: #ccc;">
                                            Cette carte est la propri√©t√© de la banque. En cas de perte ou vol, merci de contacter imm√©diatement notre service client.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Plafonds pour la carte Mastercard -->
                            <div class="card-limits-container">
                                <div class="card-limits-title">Carte Mastercard World ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 9481</div>
                                <div class="card-limit-details">
                                    <div class="limit-row">
                                        <span class="limit-type">Retrait journalier :</span>
                                        <span class="limit-amount">600 ‚Ç¨</span>
                                    </div>
                                    <div class="limit-row">
                                        <span class="limit-type">Paiement journalier :</span>
                                        <span class="limit-amount">4 000 ‚Ç¨</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- HISTORIQUE COMPLET -->
            <div id="historicPage">
                <div class="historic-header">
                    <h1>Historique des transactions</h1>
                    <button class="btn btn-secondary" onclick="exportHistoric()" aria-label="Exporter l'historique">
                        <span class="icon-document"></span> Exporter CSV
                    </button>
                    <button class="btn" onclick="toggleFilters()" aria-label="Filtrer les transactions">
                        <span class="icon-filter"></span> Filtrer
                    </button>
                </div>

                <!-- Filtres -->
                <div class="limits-container" id="filtersContainer" style="display: none;">
                    <div class="limits-title">Filtres de recherche</div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <input type="text" id="searchTransaction" placeholder="Rechercher par nom..." style="flex: 1; min-width: 200px;" aria-label="Rechercher transaction">
                        <input type="number" id="minAmount" placeholder="Montant min (‚Ç¨)" style="width: 150px;" aria-label="Montant minimum">
                        <input type="number" id="maxAmount" placeholder="Montant max (‚Ç¨)" style="width: 150px;" aria-label="Montant maximum">
                        <select id="filterType" style="width: 150px;" aria-label="Type de transaction">
                            <option value="">Tous types</option>
                            <option value="Virement">Virements</option>
                            <option value="Paiement Carte">Paiements carte</option>
                            <option value="Virement re√ßu">Virements re√ßus</option>
                        </select>
                        <button class="btn" onclick="filterTransactions()" style="width: auto;">Appliquer</button>
                        <button class="btn btn-secondary" onclick="resetFilters()" style="width: auto;">R√©initialiser</button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Montant</th>
                                <th>Date</th>
                                <th>D√©tails</th>
                                <th>Carte</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="histBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- RELEVE IBAN PAGE AVEC ADRESSE -->
            <div id="relevePage" style="display: none;">
                <div class="historic-header">
                    <h1>Relev√© IBAN du Compte</h1>
                    <button class="btn btn-secondary" onclick="copyIBAN()" aria-label="Copier l'IBAN">
                        <span class="icon-copy"></span> Copier l'IBAN
                    </button>
                    <button class="btn" onclick="generatePDF()" aria-label="T√©l√©charger le PDF">
                        <span class="icon-document"></span> T√©l√©charger PDF
                    </button>
                </div>

                <div class="releve-container">
                    <div class="iban-info">
                        <div class="iban-row">
                            <span class="iban-label">Titulaire du compte :</span>
                            <span class="iban-value" id="ibanName">Andrea DUPONT</span>
                        </div>
                        <div class="iban-row">
                            <span class="iban-label">Num√©ro de compte :</span>
                            <span class="iban-value">15548 64589 845123659871 85</span>
                        </div>
                        <div class="iban-row">
                            <span class="iban-label">IBAN :</span>
                            <span class="iban-value">FR76 1554 8645 8984 5123 6598 7185</span>
                        </div>
                        <div class="iban-row">
                            <span class="iban-label">BIC :</span>
                            <span class="iban-value">BPCEFRPPXXX</span>
                        </div>
                        <div class="iban-row">
                            <span class="iban-label">Domiciliation :</span>
                            <span class="iban-value">SOCIETE GENERALE</span>
                        </div>
                        <div class="iban-row">
                            <span class="iban-label">Adresse :</span>
                            <span class="iban-value">20 rue de la poste Montpellier 34000</span>
                        </div>
                        <div class="iban-row">
                            <span class="iban-label">Ville :</span>
                            <span class="iban-value">Montpellier</span>
                        </div>
                        <div class="iban-row">
                            <span class="iban-label">Pays :</span>
                            <span class="iban-value">France</span>
                        </div>
                        <div class="iban-row">
                            <span class="iban-label">Type de compte :</span>
                            <span class="iban-value">Compte Courant</span>
                        </div>
                        <div class="iban-row">
                            <span class="iban-label">Date d'ouverture :</span>
                            <span class="iban-value">15/03/2018</span>
                        </div>
                    </div>
                </div>

                <div class="limits-container" style="margin-top: 30px;">
                    <div class="limits-title">Informations suppl√©mentaires</div>
                    <div class="limit-item">
                        <span>Devise du compte :</span>
                        <span>Euro (EUR)</span>
                    </div>
                    <div class="limit-item">
                        <span>Statut du compte :</span>
                        <span style="color: var(--success);"><i>‚óè</i> Actif</span>
                    </div>
                    <div class="limit-item">
                        <span>Autoris√© √† d√©couvert :</span>
                        <span>Jusqu'√† 2 000 ‚Ç¨</span>
                    </div>
                </div>
            </div>

            <!-- PAGE PARAM√àTRES -->
            <div id="parametresPage" style="display: none;">
                <div class="historic-header">
                    <h1>Param√®tres du compte</h1>
                    <p>Configurez vos pr√©f√©rences et param√®tres de s√©curit√©</p>
                </div>

                <div class="parametres-container">
                    <div class="parametres-section">
                        <div class="parametres-section-title">üîä Notifications et sons</div>
                        
                        <div class="parametre-item">
                            <div class="parametre-label">Sons de notification</div>
                            <label class="switch">
                                <input type="checkbox" id="notificationSoundToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="parametre-item">
                            <div class="parametre-label">Volume des sons</div>
                            <input type="range" id="notificationVolume" min="0" max="100" value="70" style="width: 150px;">
                        </div>
                        
                        <div class="parametre-item">
                            <div class="parametre-label">Notifications push</div>
                            <label class="switch">
                                <input type="checkbox" id="pushNotificationsToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="parametres-section">
                        <div class="parametres-section-title">üîê S√©curit√©</div>
                        
                        <div class="parametre-item">
                            <div class="parametre-label">Connexion automatique</div>
                            <label class="switch">
                                <input type="checkbox" id="autoLoginToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="parametre-item">
                            <div class="parametre-label">Validation √† deux facteurs</div>
                            <label class="switch">
                                <input type="checkbox" id="twoFactorToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="parametres-section">
                        <div class="parametres-section-title">üåê Langue et affichage</div>
                        
                        <div class="parametre-item">
                            <div class="parametre-label">Langue</div>
                            <select id="languageSelect" style="width: 150px;">
                                <option value="fr">Fran√ßais</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                        
                        <div class="parametre-item">
                            <div class="parametre-label">Mode sombre automatique</div>
                            <label class="switch">
                                <input type="checkbox" id="autoDarkModeToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="parametres-section">
                        <div class="parametres-section-title">‚öôÔ∏è Configuration administrative</div>
                        
                        <div class="parametre-item">
                            <div class="parametre-label">Code SecuPass</div>
                            <div class="parametre-value" id="secupassCodeDisplay">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                        </div>
                        
                        <div class="parametre-item">
                            <div class="parametre-label">Statut des virements</div>
                            <div class="parametre-value" id="transferStatus">Actif</div>
                        </div>
                        
                        <div class="parametre-item">
                            <div class="parametre-label">Communication panel</div>
                            <div class="parametre-value" id="panelStatus">Connect√©</div>
                        </div>
                    </div>

                    <div class="parametres-section">
                        <div class="parametres-section-title">üóëÔ∏è Maintenance</div>
                        
                        <div class="parametre-item">
                            <div class="parametre-label">Effacer l'historique</div>
                            <button class="btn btn-secondary" onclick="clearHistory()" style="width: auto; padding: 8px 16px;">Effacer</button>
                        </div>
                        
                        <div class="parametre-item">
                            <div class="parametre-label">R√©initialiser les param√®tres</div>
                            <button class="btn btn-secondary" onclick="resetSettings()" style="width: auto; padding: 8px 16px;">R√©initialiser</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- NOTIFICATIONS -->
<div class="notifications" id="notifications"></div>

<!-- AUDIO POUR LES SONS DE NOTIFICATION -->
<audio id="notificationSoundSuccess" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
</audio>
<audio id="notificationSoundError" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-buzzer-1050.mp3" type="audio/mpeg">
</audio>
<audio id="notificationSoundInfo" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-happy-bells-notification-937.mp3" type="audio/mpeg">
</audio>
<audio id="notificationSoundEmail" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3" type="audio/mpeg">
</audio>

<script>
/* ====================================================
   üåç SYST√àME MULTILINGUE COMPLET
==================================================== */
const TRANSLATIONS = {
    fr: {
        // Login
        bank: "SOCIETE GENERALE",
        identifiant: "Identifiant",
        password: "Code secret",
        login: "Se connecter",
        continue: "Continuer",
        
        // Dashboard
        hello: "Bonjour",
        evening: "Bonsoir",
        interfaceSecurisee: "Votre interface bancaire s√©curis√©e",
        compteSelectionne: "Compte s√©lectionn√©",
        compteActif: "Compte actif",
        compteBloque: "Compte bloqu√©",
        plafondsVirement: "Plafonds de virement",
        daily: "Journalier :",
        monthly: "Mensuel :",
        virementAttente: "Virements en attente",
        pendingIncoming: "En attente d'entr√©e :",
        pendingOutgoing: "En attente de sortie :",
        processingFees: "Frais de traitement :",
        makeTransfer: "Passer un virement",
        addRIB: "Ajouter un RIB",
        
        // Messages d'erreur
        error: "Erreur",
        selectBeneficiaire: "S√©lectionnez un b√©n√©ficiaire",
        champsObligatoires: "Tous les champs sont obligatoires",
        ibanInvalide: "IBAN invalide - Format attendu : FR76 suivi de 23 chiffres",
        bicInvalide: "BIC invalide - Format attendu : 8 ou 11 caract√®res",
        emailInvalide: "Adresse e-mail invalide",
        soldeInsuffisant: "Solde insuffisant",
        motif: "Motif requis",
        operationAnnulee: "Op√©ration annul√©e",
        securiteCode: "Code SecuPass valid√© avec succ√®s !",
        compteBloqueAlerte: "üö® COMPTE BLOQU√â - FRAIS DE R√âCEPTION",
        virementsIndisponibles: "üö® LES VIREMENTS SONT TEMPORAIREMENT INDISPONIBLES",
        
        // Notifications
        transferSuccess: (amount) => `‚úÖ Virement effectu√© avec succ√®s ! Montant: ${amount}‚Ç¨`,
        transferSent: (date) => `üì® Notification envoy√©e au b√©n√©ficiaire ! Arriv√©e pr√©vue le ${date}`,
        ribAdded: "‚úÖ B√©n√©ficiaire ajout√© avec succ√®s !",
        ribDeleted: "‚úÖ B√©n√©ficiaire supprim√© avec succ√®s !",
        copied: "üìã Copi√© dans le presse-papier !",
        exported: "üìä Historique export√© en CSV !",
        ibanCopie: "üìã IBAN copi√© dans le presse-papier !",
        pdfGenere: "üìÑ PDF g√©n√©r√© avec succ√®s !",
        plafondDepasse: (type, amount) => `‚ö†Ô∏è Plafond ${type} d√©pass√©. Disponible : ${amount}‚Ç¨`,
        emailSentSuccess: "üìß Email envoy√© avec succ√®s au destinataire !",
        
        // Autres
        supprimer: "Supprimer",
        modifier: "Modifier",
        supprimerSelection: "Supprimer s√©lection",
        toutEffacer: "Tout effacer",
        aucunMessage: "Aucun message",
        aucunRIB: "Aucun b√©n√©ficiaire enregistr√©",
        aucuneTransaction: "Aucune transaction"
    },
    en: {
        bank: "SOCIETE GENERALE",
        identifiant: "Username",
        password: "Password",
        login: "Sign in",
        continue: "Continue",
        hello: "Hello",
        evening: "Good evening",
        error: "Error",
        emailSentSuccess: "üìß Email sent successfully to recipient!",
        ribAdded: "‚úÖ Beneficiary added successfully!",
        transferSuccess: (amount) => `‚úÖ Transfer completed successfully! Amount: ${amount}‚Ç¨`
    }
};

class TranslationEngine {
    constructor(lang = 'fr') {
        this.currentLang = lang;
        this.translations = TRANSLATIONS[lang] || TRANSLATIONS.fr;
    }
    
    translateElement(elementId, translationKey, ...args) {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        const translation = this.translations[translationKey];
        if (typeof translation === 'function') {
            element.textContent = translation(...args);
        } else if (translation) {
            element.textContent = translation;
        }
    }
    
    translatePlaceholder(elementId, translationKey) {
        const element = document.getElementById(elementId);
        if (element && this.translations[translationKey]) {
            element.placeholder = this.translations[translationKey];
        }
    }
    
    notify(messageKey, type = 'info', ...args) {
        let message = this.translations[messageKey];
        if (typeof message === 'function') {
            message = message(...args);
        } else if (!message) {
            message = messageKey;
        }
        
        if (window.notify) {
            window.notify(message, type);
        }
    }
}

function detectUserLanguage() {
    const savedLang = localStorage.getItem('bankLang');
    if (savedLang && (savedLang === 'fr' || savedLang === 'en')) {
        return savedLang;
    }
    
    const browserLang = (navigator.language || 'en').split('-')[0];
    return (browserLang === 'fr' || browserLang === 'en') ? browserLang : 'fr';
}

function initializeMultilingualSystem() {
    const userLang = detectUserLanguage();
    applyFullTranslations(userLang);
}

function applyFullTranslations(langCode) {
    const translator = new TranslationEngine(langCode);
    const t = translator.translations;
    
    // Login page
    if (document.getElementById('loginPage').style.display !== 'none') {
        translator.translateElement('logo-text', 'bank');
        const stepIDH2 = document.querySelector('#stepID h2');
        if (stepIDH2) stepIDH2.textContent = t.identifiant || "Identifiant";
        translator.translatePlaceholder('user', 'identifiant');
        translator.translateElement('validateID', 'continue');
        
        const stepPASSH2 = document.querySelector('#stepPASS h2');
        if (stepPASSH2) stepPASSH2.textContent = t.password || "Code secret";
        translator.translatePlaceholder('pass', 'password');
        translator.translateElement('loginBtn', 'login');
    }
    
    localStorage.setItem('bankLang', langCode);
}

function switchLanguage(langCode) {
    applyFullTranslations(langCode);
    location.reload();
}

/* ===================================================================
   SYST√àME DE COMMUNICATION AVEC LE PANEL ADMINISTRATIF
=================================================================== */
const PANEL_CONFIG = {
    HEARTBEAT_INTERVAL: 3000,
    CONNECTION_TIMEOUT: 10000,
    RETRY_INTERVAL: 5000
};

const BLOCK_MESSAGES = {
    INCOMING_BLOCK: {
        title: "üîí VIREMENTS ENTRANTS BLOQU√âS",
        content: `COMPTE EN ATTENTE DE R√âGULARISATION

Suite √† un contr√¥le de s√©curit√©, la r√©ception de fonds sur votre compte est temporairement suspendue.

Montant concern√© : {amount} ‚Ç¨
Frais de r√©gularisation : {fee} ‚Ç¨ ({feePercent}%)
R√©f√©rence : {reference}

Contactez votre conseiller au 01‚ÄØ40‚ÄØ20‚ÄØ30‚ÄØ40`
    },
    
    OUTGOING_BLOCK: {
        title: "üö´ VIREMENTS SORTANTS BLOQU√âS",
        content: `SUSPENSION DES OP√âRATIONS DE D√âBIT

Pour des raisons de s√©curit√©, les virements sortants sont temporairement indisponibles.

Solde disponible : {balance} ‚Ç¨
Op√©rations en attente : {count} virements
Montant total bloqu√© : {amount} ‚Ç¨

Aucun d√©bit n'est autoris√© actuellement.
Contactez le 01‚ÄØ40‚ÄØ20‚ÄØ30‚ÄØ50 ou rendez-vous en agence.`
    },
    
    FULL_BLOCK: {
        title: "‚õî COMPTE INT√âGRALEMENT BLOQU√â",
        content: `ALERTE S√âCURIT√â MAXIMUM

Suite √† une alerte de s√©curit√© de niveau maximum, l'ensemble des op√©rations sur votre compte sont suspendues.

Veuillez contacter d'urgence le service s√©curit√© au 01 40 20 30 60.

R√©f√©rence: {reference}
Heure du blocage: {timestamp}`
    }
};

class PanelCommunicationSystem {
    constructor() {
        this.isConnected = false;
        this.lastHeartbeat = null;
        this.heartbeatInterval = null;
        this.connectionTimeout = null;
        this.messageQueue = [];
        this.initializeCommunication();
    }

    initializeCommunication() {
        console.log('üì° Initialisation communication panel...');
        
        window.addEventListener('storage', this.handleStorageEvent.bind(this));
        this.startHeartbeat();
        this.checkPanelConnection();
        this.checkActiveBlocks();
    }

    handleStorageEvent(event) {
        if (event.key === 'panel_to_site_data') {
            try {
                const message = JSON.parse(event.newValue);
                console.log('üì® Message panel re√ßu:', message.type);
                this.processPanelMessage(message);
            } catch (e) {
                console.error('‚ùå Erreur traitement message panel:', e);
            }
        }
        
        if (event.key === 'panel_heartbeat') {
            try {
                const heartbeat = JSON.parse(event.newValue);
                this.lastHeartbeat = Date.now();
                this.isConnected = true;
                this.updateConnectionStatus(true);
                
                if (heartbeat.data && heartbeat.data.balance !== undefined) {
                    this.syncBalanceIfNeeded(heartbeat.data.balance);
                }
            } catch (e) {
                console.error('‚ùå Erreur traitement heartbeat:', e);
            }
        }
        
        if (event.key === 'adminPanelData') {
            try {
                const panelData = JSON.parse(event.newValue);
                this.processPanelData(panelData);
            } catch (e) {
                console.error('‚ùå Erreur traitement donn√©es panel:', e);
            }
        }
    }

    processPanelMessage(message) {
        console.log(`üîß Traitement: ${message.type}`);
        
        switch(message.type) {
            case 'BLOCK_DATA':
                this.applyBlockFromPanel(message.data);
                break;
                
            case 'UNBLOCK_ALL':
                this.removeAllBlocks();
                break;
                
            case 'BALANCE_UPDATE':
                this.updateBalanceFromPanel(message.data.balance);
                break;
                
            case 'TEST_COMMUNICATION':
                this.respondToTest(message);
                break;
                
            case 'EMERGENCY_LOGOUT':
                this.emergencyLogout(message.data);
                break;
                
            case 'PROFESSIONAL_TEST':
                this.applyProfessionalMessages(message.data);
                break;
                
            case 'ACCOUNT_UPDATE':
                this.updateAccountInfo(message.data);
                break;
                
            case 'FORCE_REFRESH':
                this.forceRefresh();
                break;
                
            case 'SECURITY_ALERT':
                this.showSecurityAlert(message.data);
                break;
        }
    }

    applyBlockFromPanel(blockData) {
        console.log('üî¥ Application blocage depuis panel:', blockData.blockType);
        
        const { blockType, message } = blockData;
        
        if (blockType === 'INCOMING' || blockType === 'FULL') {
            window.TRANSFER_BLOCKED = true;
            if (window.updateAccountStatus) {
                window.updateAccountStatus();
            }
        }
        
        this.showBlockNotification(blockData);
        this.addToSmartMessagerie(blockData);
        this.saveBlockStatus(blockData);
        this.updatePendingDisplay(blockData);
    }

    showBlockNotification(blockData) {
        const notification = document.createElement('div');
        notification.className = 'notification alert';
        
        const title = blockData.message.title || 'üö® NOTIFICATION SYST√àME';
        const content = blockData.message.content || 'Votre compte n√©cessite une attention particuli√®re';
        
        notification.innerHTML = `
            <div class="alert-content">
                <span class="alert-title">${title}</span>
                <span class="alert-message">${content}</span>
                ${blockData.message.blockedAmount ? 
                    `<span class="alert-amount">Montant concern√© : ${blockData.message.blockedAmount}</span>` : ''}
                ${blockData.message.feeAmount ? 
                    `<span class="alert-fee">Frais applicables : ${blockData.message.feeAmount}</span>` : ''}
                ${blockData.message.reference ? 
                    `<span style="font-size: 12px; opacity: 0.8; margin-top: 5px; display: block;">
                        R√©f√©rence : ${blockData.message.reference}
                    </span>` : ''}
            </div>
        `;
        
        const notificationsContainer = document.getElementById('notifications');
        if (notificationsContainer) {
            notificationsContainer.appendChild(notification);
        }
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 15000);
    }

    addToSmartMessagerie(blockData) {
        if (window.addSmartMessage && blockData.message) {
            const sender = blockData.message.title.includes('ENTRANTS') ? 'üîí R√©ception bloqu√©e' :
                          blockData.message.title.includes('SORTANTS') ? 'üö´ Envoi bloqu√©' :
                          blockData.message.title.includes('INT√âGRALEMENT') ? '‚õî Compte bloqu√©' : 'Syst√®me';
            
            window.addSmartMessage(
                sender,
                `${blockData.message.content}<br><br>
                 ${blockData.message.reference ? `<strong>R√©f√©rence:</strong> ${blockData.message.reference}<br>` : ''}
                 ${blockData.message.blockedAmount ? `<strong>Montant:</strong> ${blockData.message.blockedAmount}<br>` : ''}
                 <em>Re√ßu du panel administratif</em>`,
                "alert"
            );
        }
    }

    startHeartbeat() {
        this.heartbeatInterval = setInterval(() => {
            const heartbeat = {
                type: 'SITE_HEARTBEAT',
                from: 'site',
                timestamp: Date.now(),
                data: {
                    balance: window.solde || 0,
                    user: window.userName || 'Utilisateur',
                    status: window.TRANSFER_BLOCKED ? 'blocked' : 'active',
                    version: '2.0',
                    transferBlocked: window.TRANSFER_BLOCKED || false,
                    lastLogin: localStorage.getItem('lastLogin') || new Date().toISOString()
                }
            };
            
            localStorage.setItem('site_heartbeat', JSON.stringify(heartbeat));
            localStorage.setItem('site_data', JSON.stringify({
                balance: window.solde || 0,
                user: window.userName || 'Utilisateur',
                timestamp: Date.now(),
                lastActivity: new Date().toISOString()
            }));
            
            setTimeout(() => {
                try {
                    window.dispatchEvent(new Event('storage'));
                } catch (e) {
                    console.log('‚ö†Ô∏è Event dispatch non critique');
                }
            }, 30);
            
            this.checkConnectionTimeout();
        }, PANEL_CONFIG.HEARTBEAT_INTERVAL);
    }

    checkConnectionTimeout() {
        if (this.lastHeartbeat && Date.now() - this.lastHeartbeat > PANEL_CONFIG.CONNECTION_TIMEOUT) {
            this.isConnected = false;
            this.updateConnectionStatus(false);
        }
    }

    updateConnectionStatus(connected) {
        if (connected) {
            console.log('‚úÖ Connect√© au panel administratif');
            document.getElementById('panelStatus').textContent = 'Connect√©';
            document.getElementById('panelStatus').style.color = 'var(--success)';
        } else {
            console.warn('‚ö†Ô∏è D√©connect√© du panel administratif');
            document.getElementById('panelStatus').textContent = 'D√©connect√©';
            document.getElementById('panelStatus').style.color = 'var(--danger)';
        }
    }

    respondToTest(testMessage) {
        const response = {
            type: 'TEST_RESPONSE',
            from: 'site',
            timestamp: Date.now(),
            message: '‚úÖ Site Soci√©t√© G√©n√©rale op√©rationnel',
            originalTest: testMessage,
            user: window.userName || 'Utilisateur',
            balance: window.solde || 0
        };
        
        localStorage.setItem('site_response', JSON.stringify(response));
        
        if (window.notify) {
            window.notify('‚úÖ Test de communication r√©ussi', 'success');
        }
        
        setTimeout(() => {
            try {
                window.dispatchEvent(new Event('storage'));
            } catch (e) {
                console.log('‚ö†Ô∏è Event response non critique');
            }
        }, 50);
    }

    checkActiveBlocks() {
        try {
            const blocks = JSON.parse(localStorage.getItem('panel_blocks') || '[]');
            const activeBlocks = blocks.filter(block => block.active !== false);
            
            if (activeBlocks.length > 0) {
                const latestBlock = activeBlocks[activeBlocks.length - 1];
                this.applyBlockFromStorage(latestBlock);
            }
        } catch (e) {
            console.error('‚ùå Erreur v√©rification blocages:', e);
        }
    }

    applyBlockFromStorage(blockData) {
        window.TRANSFER_BLOCKED = true;
        
        if (window.updateAccountStatus) {
            window.updateAccountStatus();
        }
        
        const pendingDiv = document.getElementById('pendingTransferLimits');
        if (pendingDiv) {
            pendingDiv.classList.add('active');
        }
    }

    updateBalanceFromPanel(newBalance) {
        if (window.solde !== undefined && window.accounts && window.accounts[window.currentAccount]) {
            const oldBalance = window.solde;
            window.solde = newBalance;
            window.accounts[window.currentAccount].solde = newBalance;
            
            localStorage.setItem("accounts", JSON.stringify(window.accounts));
            
            if (window.updateBalance) {
                window.updateBalance();
            }
            
            console.log(`üí∞ Solde mis √† jour depuis panel: ${oldBalance} ‚Üí ${newBalance}`);
            
            if (window.notify) {
                window.notify(`Solde mis √† jour: ${newBalance.toLocaleString('fr-FR')} ‚Ç¨`, 'info');
            }
        }
    }

    saveBlockStatus(blockData) {
        try {
            const blocks = JSON.parse(localStorage.getItem('panel_blocks') || '[]');
            blocks.push({
                ...blockData,
                receivedAt: new Date().toISOString(),
                active: true,
                id: Date.now() + Math.random()
            });
            
            if (blocks.length > 10) {
                blocks.splice(0, blocks.length - 10);
            }
            
            localStorage.setItem('panel_blocks', JSON.stringify(blocks));
        } catch (e) {
            console.error('‚ùå Erreur sauvegarde blocage:', e);
        }
    }

    removeAllBlocks() {
        window.TRANSFER_BLOCKED = false;
        
        try {
            const blocks = JSON.parse(localStorage.getItem('panel_blocks') || '[]');
            blocks.forEach(block => block.active = false);
            localStorage.setItem('panel_blocks', JSON.stringify(blocks));
        } catch (e) {
            console.error('‚ùå Erreur d√©sactivation blocages:', e);
        }
        
        if (window.updateAccountStatus) {
            window.updateAccountStatus();
        }
        
        const pendingDiv = document.getElementById('pendingTransferLimits');
        if (pendingDiv) {
            pendingDiv.classList.remove('active');
        }
        
        if (window.notify) {
            window.notify('‚úÖ Tous les blocages ont √©t√© lev√©s', 'success');
        }
        
        if (window.addSmartMessage) {
            window.addSmartMessage(
                "Syst√®me Soci√©t√© G√©n√©rale",
                "Tous les blocages ont √©t√© lev√©s.<br>Votre compte est √† nouveau pleinement fonctionnel.",
                "system"
            );
        }
    }

    emergencyLogout(data) {
        console.log('üö® D√©connexion d\'urgence demand√©e:', data);
        
        if (window.logout) {
            if (window.notify) {
                window.notify('üö® D√©connexion d\'urgence du syst√®me', 'error');
            }
            
            setTimeout(() => {
                window.logout();
            }, 2000);
        }
    }

    updatePendingDisplay(blockData) {
        if (blockData.message && blockData.message.blockedAmount) {
            const amount = parseFloat(blockData.message.blockedAmount.replace(/[^\d.-]/g, '')) || 0;
            const feePercent = blockData.message.feePercent || 10;
            const fee = amount * (feePercent / 100);
            
            const incomingAmount = document.getElementById('pendingAmountIncoming');
            const incomingFee = document.getElementById('pendingFeeIncoming');
            const incomingTotal = document.getElementById('pendingTotalIncoming');
            
            if (incomingAmount) incomingAmount.textContent = amount.toLocaleString('fr-FR') + ' ‚Ç¨';
            if (incomingFee) incomingFee.textContent = fee.toLocaleString('fr-FR') + ' ‚Ç¨';
            if (incomingTotal) incomingTotal.textContent = fee.toLocaleString('fr-FR') + ' ‚Ç¨';
            
            const pendingDiv = document.getElementById('pendingTransferLimits');
            if (pendingDiv) {
                pendingDiv.classList.add('active');
            }
        }
    }
}

let panelCommunication = null;

function initializePanelCommunication() {
    if (!panelCommunication) {
        panelCommunication = new PanelCommunicationSystem();
        console.log('üöÄ Communication panel initialis√©e');
    }
    return panelCommunication;
}

function sendTransactionToPanel(transactionData) {
    const message = {
        type: 'NEW_TRANSFER',
        from: 'site',
        timestamp: Date.now(),
        data: transactionData
    };
    
    localStorage.setItem('site_transaction_update', JSON.stringify(message));
    
    setTimeout(() => {
        try {
            window.dispatchEvent(new Event('storage'));
        } catch (e) {
            console.log('‚ö†Ô∏è Event transaction non critique');
        }
    }, 50);
}

function syncBalanceWithPanel(newBalance) {
    const update = {
        type: 'BALANCE_SYNC',
        from: 'site',
        timestamp: Date.now(),
        balance: newBalance
    };
    
    localStorage.setItem('site_balance_update', JSON.stringify(update));
    
    setTimeout(() => {
        try {
            window.dispatchEvent(new Event('storage'));
        } catch (e) {
            console.log('‚ö†Ô∏è Event balance non critique');
        }
    }, 50);
}

/* ====================================================
   CONFIGURATION ADMINISTRATIVE DYNAMIQUE
==================================================== */
let ADMIN_CONFIG = {
    TRANSFER_BLOCKED: false,
    SEND_EMAILS: true,
    
    EMAIL_OPTIMIZATION: {
        delayBetweenEmails: 2000,
        maxEmailsPerDay: 10,
        warmupEnabled: true,
        senderVerification: true
    },
    
    ALLOWED_EMAIL_DOMAINS: [
        "gmail.com",
        "yahoo.com",
        "outlook.com",
        "hotmail.com",
        "icloud.com",
        "protonmail.com",
        "orange.fr",
        "sfr.fr",
        "free.fr",
        "bbox.fr",
        "laposte.net",
        "wanadoo.fr",
        "numericable.fr",
        "neuf.fr",
        "aliceadsl.fr",
        "live.fr",
        "msn.com",
        "aol.com"
    ],
    
    USER_NAME: "Shumy Kaera",
    INITIAL_BALANCE: 347798.00,
    
    PENDING_TRANSFER_INCOMING_AMOUNT: 347798.00,
    PENDING_TRANSFER_OUTGOING_AMOUNT: 34798.00,
    
    SECUPASS_CODE: "196887",
    
    DAILY_LIMIT: 5000,
    MONTHLY_LIMIT: 15000,
    
    WEEKLY_TRANSFER_MIN: 6000.99,
    WEEKLY_TRANSFER_MAX: 12999.99,
    
    BUTTON_COLORS: {
        LOGO_BORDER: "red",
        LOGO_TEXT: "red",
        CONTINUER: "red",
        CODESECRET: "red",
        SECONNECTER: "red",
        VIREMENT: "yellow",
        RIB: "purple",
        LOGO_BORDER_ACCOUNT: "black"
    },
    
    CARD_PURCHASE_MODELS: [
        // 30 mod√®les Visa
        { merchant: "Carrefour", amount: 89.50, type: "visa" },
        { merchant: "Darty", amount: 425.00, type: "visa" },
        { merchant: "Total", amount: 65.30, type: "visa" },
        { merchant: "Monoprix", amount: 45.60, type: "visa" },
        { merchant: "Fnac", amount: 189.90, type: "visa" },
        { merchant: "SFR", amount: 39.99, type: "visa" },
        { merchant: "Boulanger", amount: 320.00, type: "visa" },
        { merchant: "Auchan", amount: 75.20, type: "visa" },
        { merchant: "Leroy Merlin", amount: 150.00, type: "visa" },
        { merchant: "Decathlon", amount: 85.00, type: "visa" },
        { merchant: "Pharmacie", amount: 28.50, type: "visa" },
        { merchant: "Boucherie", amount: 42.80, type: "visa" },
        { merchant: "Boulangerie", amount: 12.50, type: "visa" },
        { merchant: "Restaurant", amount: 68.90, type: "visa" },
        { merchant: "Caf√©", amount: 5.80, type: "visa" },
        { merchant: "Station service", amount: 55.00, type: "visa" },
        { merchant: "Librairie", amount: 24.90, type: "visa" },
        { merchant: "Fleuriste", amount: 38.50, type: "visa" },
        { merchant: "Brico", amount: 120.00, type: "visa" },
        { merchant: "Optique", amount: 250.00, type: "visa" },
        { merchant: "Coiffeur", amount: 35.00, type: "visa" },
        { merchant: "Pressing", amount: 22.00, type: "visa" },
        { merchant: "Supermarch√©", amount: 95.30, type: "visa" },
        { merchant: "Bureau de tabac", amount: 15.50, type: "visa" },
        { merchant: "Cordonnerie", amount: 28.00, type: "visa" },
        { merchant: "Jardinage", amount: 75.00, type: "visa" },
        { merchant: "Animalerie", amount: 45.00, type: "visa" },
        { merchant: "P√¢tisserie", amount: 18.90, type: "visa" },
        { merchant: "Fromagerie", amount: 32.50, type: "visa" },
        { merchant: "Poissonnerie", amount: 42.00, type: "visa" },
        
        // 30 mod√®les Mastercard
        { merchant: "Air France", amount: 850.00, type: "mastercard" },
        { merchant: "Booking.com", amount: 320.00, type: "mastercard" },
        { merchant: "Amazon US", amount: 156.75, type: "mastercard" },
        { merchant: "Airbnb", amount: 420.00, type: "mastercard" },
        { merchant: "Uber", amount: 28.50, type: "mastercard" },
        { merchant: "British Airways", amount: 750.00, type: "mastercard" },
        { merchant: "Hilton Hotel", amount: 280.00, type: "mastercard" },
        { merchant: "Expedia", amount: 420.00, type: "mastercard" },
        { merchant: "eBay", amount: 95.00, type: "mastercard" },
        { merchant: "PayPal", amount: 120.00, type: "mastercard" },
        { merchant: "Netflix", amount: 15.99, type: "mastercard" },
        { merchant: "Spotify", amount: 9.99, type: "mastercard" },
        { merchant: "Apple Store", amount: 129.00, type: "mastercard" },
        { merchant: "Google Play", amount: 49.99, type: "mastercard" },
        { merchant: "Microsoft", amount: 89.00, type: "mastercard" },
        { merchant: "Adobe", amount: 62.99, type: "mastercard" },
        { merchant: "LinkedIn Premium", amount: 39.99, type: "mastercard" },
        { merchant: "Dropbox", amount: 11.99, type: "mastercard" },
        { merchant: "Canva Pro", amount: 12.99, type: "mastercard" },
        { merchant: "AliExpress", amount: 45.50, type: "mastercard" },
        { merchant: "Wish", amount: 28.00, type: "mastercard" },
        { merchant: "Etsy", amount: 65.00, type: "mastercard" },
        { merchant: "Steam", amount: 59.99, type: "mastercard" },
        { merchant: "PlayStation Store", amount: 79.99, type: "mastercard" },
        { merchant: "Xbox Store", amount: 69.99, type: "mastercard" },
        { merchant: "Nintendo eShop", amount: 54.99, type: "mastercard" },
        { merchant: "Skyscanner", amount: 350.00, type: "mastercard" },
        { merchant: "TripAdvisor", amount: 220.00, type: "mastercard" },
        { merchant: "Kayak", amount: 410.00, type: "mastercard" },
        { merchant: "Hostelworld", amount: 180.00, type: "mastercard" }
    ],
    
    TRANSFER_SENDER_MODELS: [
        // 30 mod√®les d'exp√©diteurs de virements
        { name: "SARL Investissements France", type: "Soci√©t√© d'investissement" },
        { name: "Groupe Financier International", type: "Groupe financier" },
        { name: "Capital Partners SA", type: "Soci√©t√© de capital" },
        { name: "Euro Finance Ltd", type: "Soci√©t√© financi√®re" },
        { name: "Bourse & Trading Corp", type: "Soci√©t√© de trading" },
        { name: "Global Assets Management", type: "Gestion d'actifs" },
        { name: "M. Jean Dupont", type: "Particulier" },
        { name: "Mme Sophie Martin", type: "Particuli√®re" },
        { name: "SARL Tech Solutions", type: "Soci√©t√© informatique" },
        { name: "Groupe Immobilier Paris", type: "Soci√©t√© immobili√®re" },
        { name: "Consulting Experts", type: "Cabinet de conseil" },
        { name: "Legal Partners", type: "Cabinet d'avocats" },
        { name: "M. Pierre Lef√®vre", type: "Particulier" },
        { name: "Mme Marie Dubois", type: "Particuli√®re" },
        { name: "Startup Innovante SAS", type: "Startup" },
        { name: "Export International", type: "Soci√©t√© d'export" },
        { name: "Import-Export Ltd", type: "Soci√©t√© d'import-export" },
        { name: "M. Thomas Moreau", type: "Particulier" },
        { name: "Mme Claire Petit", type: "Particuli√®re" },
        { name: "Digital Marketing Agency", type: "Agence digitale" },
        { name: "Construction BTP", type: "Soci√©t√© de construction" },
        { name: "Auto Distribution", type: "Concessionnaire auto" },
        { name: "Luxury Goods SA", type: "Biens de luxe" },
        { name: "Wine & Spirits", type: "Commerce vins" },
        { name: "M. Robert Laurent", type: "Particulier" },
        { name: "Mme Isabelle Roux", type: "Particuli√®re" },
        { name: "Tech Startup Inc", type: "Startup technologique" },
        { name: "Real Estate Group", type: "Groupe immobilier" },
        { name: "Financial Advisory", type: "Conseil financier" },
        { name: "M. Paul Bernard", type: "Particulier" }
    ]
};

// Charger la configuration depuis localStorage si elle existe
function loadAdminConfig() {
    try {
        const savedConfig = localStorage.getItem('adminConfig');
        if (savedConfig) {
            const parsedConfig = JSON.parse(savedConfig);
            ADMIN_CONFIG = { ...ADMIN_CONFIG, ...parsedConfig };
            console.log('üìã Configuration administrative charg√©e');
        }
    } catch (e) {
        console.error('‚ùå Erreur chargement configuration:', e);
    }
}

// Sauvegarder la configuration dans localStorage
function saveAdminConfig() {
    try {
        localStorage.setItem('adminConfig', JSON.stringify(ADMIN_CONFIG));
        console.log('üìã Configuration administrative sauvegard√©e');
    } catch (e) {
        console.error('‚ùå Erreur sauvegarde configuration:', e);
    }
}

/* ====================================================
   üìß SYST√àME RESEND EMAIL HYPER-PROFESSIONNEL 100% INBOX
==================================================== */
const RESEND_CONFIG = {
    API_KEY: "re_1234567890abcdef1234567890", // √Ä remplacer par votre cl√© API Resend
    FROM_EMAIL: "Soci√©t√© G√©n√©rale <notifications@resend.dev>",
    TEMPLATE_ID: "transfer-confirmation"
};

async function sendResendEmail(beneficiaryEmail, beneficiaryName, amount, arrivalDate, yourName, motif, beneficiaryIBAN, beneficiaryBIC, accountLabel) {
    if (!ADMIN_CONFIG.SEND_EMAILS) {
        console.log(`[${new Date().toISOString()}] üß™ MODE TEST - Email simulation premium`);
        
        await new Promise(resolve => setTimeout(resolve, 1200));
        
        const currentLang = localStorage.getItem('bankLang') || 'fr';
        const translator = new TranslationEngine(currentLang);
        addMessage("Syst√®me Banque", translator.translations.transferSent ? 
            translator.translations.transferSent(arrivalDate) : 
            `‚úÖ Virement trait√© - Arriv√©e: ${arrivalDate}`, "success");
        
        return { success: true, mode: 'test', messageId: `TEST-${Date.now()}` };
    }
    
    try {
        const bankData = generateRealisticBankData();
        const transactionId = bankData.transactionRef;
        
        const emailData = {
            from: RESEND_CONFIG.FROM_EMAIL,
            to: [beneficiaryEmail],
            subject: `Confirmation de virement - R√©f√©rence ${transactionId}`,
            html: `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <title>Confirmation de virement - Soci√©t√© G√©n√©rale</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
                        .header { background: #0044cc; color: white; padding: 20px; text-align: center; border-radius: 10px 10px 0 0; }
                        .content { background: #f5f7fa; padding: 30px; border-radius: 0 0 10px 10px; }
                        .details { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; }
                        .footer { text-align: center; font-size: 12px; color: #666; margin-top: 30px; }
                        .amount { font-size: 24px; font-weight: bold; color: #d90429; text-align: center; margin: 20px 0; }
                        .reference { background: #f0f0f0; padding: 10px; border-radius: 5px; font-family: monospace; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1>Soci√©t√© G√©n√©rale</h1>
                            <p>Confirmation de virement bancaire</p>
                        </div>
                        <div class="content">
                            <p>Bonjour ${beneficiaryName},</p>
                            <p>Un virement bancaire a √©t√© effectu√© vers votre compte :</p>
                            
                            <div class="details">
                                <div class="amount">${amount.toLocaleString('fr-FR')} ‚Ç¨</div>
                                
                                <p><strong>Exp√©diteur :</strong> ${yourName}</p>
                                <p><strong>Libell√© du compte :</strong> ${accountLabel || 'Compte principal'}</p>
                                <p><strong>Motif :</strong> ${motif}</p>
                                <p><strong>Date de valeur :</strong> ${arrivalDate}</p>
                                <p><strong>IBAN cr√©dit√© :</strong> ${beneficiaryIBAN}</p>
                                <p><strong>BIC :</strong> ${beneficiaryBIC}</p>
                                
                                <div class="reference">
                                    <strong>R√©f√©rence de l'op√©ration :</strong> ${transactionId}
                                </div>
                            </div>
                            
                            <p>Ce virement est soumis aux d√©lais d'acheminement standards. L'argent sera disponible sur votre compte selon la date de valeur indiqu√©e.</p>
                            
                            <p>Pour toute question concernant cette op√©ration, vous pouvez contacter notre service client au 09 69 39 99 98 ou r√©pondre √† cet email.</p>
                            
                            <p>Cordialement,<br>
                            <strong>Soci√©t√© G√©n√©rale</strong><br>
                            Service Relations Clients</p>
                        </div>
                        <div class="footer">
                            <p>Cet email a √©t√© envoy√© automatiquement. Merci de ne pas y r√©pondre.</p>
                            <p>Soci√©t√© G√©n√©rale - Si√®ge social : 29 Boulevard Haussmann, 75009 Paris</p>
                            <p>¬© ${new Date().getFullYear()} Soci√©t√© G√©n√©rale. Tous droits r√©serv√©s.</p>
                        </div>
                    </div>
                </body>
                </html>
            `
        };

        console.log(`[${new Date().toISOString()}] üìß ENVOI RESEND - Email: ${beneficiaryEmail}`);
        
        showLoading("Traitement s√©curis√©", "Envoi de la confirmation au b√©n√©ficiaire...");
        
        // Simulation de l'envoi avec Resend
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // En production, d√©commentez ce code et ajoutez votre cl√© API Resend
        /*
        const response = await fetch('https://api.resend.com/emails', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${RESEND_CONFIG.API_KEY}`
            },
            body: JSON.stringify(emailData)
        });
        
        if (!response.ok) {
            throw new Error(`Erreur Resend: ${response.status}`);
        }
        
        const data = await response.json();
        */
        
        // Simulation de la r√©ponse
        const data = { 
            id: `resend_${Date.now()}`,
            from: RESEND_CONFIG.FROM_EMAIL,
            to: [beneficiaryEmail],
            created_at: new Date().toISOString()
        };
        
        hideLoading();
        
        console.log(`[${new Date().toISOString()}] ‚úÖ EMAIL RESEND ENVOY√â √Ä ${beneficiaryEmail}`);
        console.log(`[${new Date().toISOString()}] üì® R√©f√©rence: ${transactionId}`);
        
        // Jouer le son de notification email
        playNotificationSound('email');
        
        notify("emailSentSuccess", "success");
        
        addSmartMessage(
            "üìß Email envoy√©",
            `Confirmation de virement envoy√©e √† ${beneficiaryName}<br>
             üìß Email : ${beneficiaryEmail}<br>
             üí∂ Montant : ${amount.toLocaleString('fr-FR')}‚Ç¨<br>
             üìÖ Arriv√©e : ${arrivalDate}<br>
             üÜî R√©f√©rence : ${transactionId}`,
            "success"
        );
        
        return { 
            success: true, 
            messageId: data.id,
            transactionId: transactionId,
            details: emailData
        };
        
    } catch (error) {
        hideLoading();
        console.error(`[${new Date().toISOString()}] ‚ùå ERREUR RESEND:`, error);
        
        // Fallback √† la simulation
        ADMIN_CONFIG.SEND_EMAILS = false;
        
        const currentLang = localStorage.getItem('bankLang') || 'fr';
        const translator = new TranslationEngine(currentLang);
        
        // Jouer le son d'erreur
        playNotificationSound('error');
        
        notify(translator.translations.transferSuccess ? 
            translator.translations.transferSuccess(amount) : 
            `‚úÖ Virement de ${amount}‚Ç¨ trait√© (mode simulation)`, 
            "success");
        
        addSmartMessage(
            "üìß Email (simulation)",
            `[SIMULATION] Confirmation envoy√©e √† ${beneficiaryName}<br>
             üí∂ Montant : ${amount.toLocaleString('fr-FR')}‚Ç¨<br>
             üìÖ Date valeur : ${arrivalDate}`,
            "info"
        );
        
        return { 
            success: true, 
            mode: 'simulation', 
            messageId: `SIM-${Date.now()}`,
            error: error.message 
        };
    }
}

function generateRealisticBankData() {
    const prefixes = ['TRX', 'BANK', 'SG', 'VRT', 'FR', 'EU'];
    const suffix = Date.now().toString().slice(-6);
    const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
    
    return {
        transactionRef: `${prefix}${suffix}${Math.floor(Math.random() * 1000)}`,
        
        generateFrenchIBAN: () => {
            const bankCode = '3000' + Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            const branchCode = Math.floor(Math.random() * 10000).toString().padStart(5, '0');
            const accountNum = Math.floor(Math.random() * 10000000000).toString().padStart(11, '0');
            const ribKey = Math.floor(Math.random() * 100).toString().padStart(2, '0');
            return `FR76 ${bankCode} ${branchCode} ${accountNum} ${ribKey}`;
        },
        
        generateBIC: () => {
            const bankCodes = ['SOGE', 'BNPA', 'CEPA', 'CRLY', 'PSST'];
            const country = 'FR';
            const location = ['PP', 'MM', 'LY', 'XX'][Math.floor(Math.random() * 4)];
            const branch = ['XXX', 'BDF', 'CCT', 'DIR'][Math.floor(Math.random() * 4)];
            return `${bankCodes[Math.floor(Math.random() * bankCodes.length)]}${country}${location}${branch}`;
        },
        
        generateAgencyCode: () => {
            return (Math.floor(Math.random() * 9000) + 1000).toString();
        }
    };
}

function validateEmailForInbox(email) {
    const domain = email.split('@')[1]?.toLowerCase();
    
    if (!domain) {
        return { valid: false, reason: "Domaine invalide" };
    }
    
    const blacklistedDomains = [
        "tempmail.com",
        "10minutemail.com",
        "guerrillamail.com",
        "mailinator.com",
        "yopmail.com"
    ];
    
    if (blacklistedDomains.some(d => domain.includes(d))) {
        return { valid: false, reason: "Domaine temporaire d√©tect√©" };
    }
    
    if (!ADMIN_CONFIG.ALLOWED_EMAIL_DOMAINS.some(allowed => 
        domain === allowed || domain.endsWith(`.${allowed}`))) {
        return { valid: false, reason: "Domaine non autoris√©" };
    }
    
    return { valid: true, domain: domain };
}

/* ====================================================
   SYST√àME DE MESSAGERIE INTELLIGENTE ULTRA-PRO
==================================================== */

let smartMessages = [];
let smartUnreadCount = 0;

const SMART_MESSAGE_TYPES = {
    SYSTEM: 'system',
    SECURITY: 'security',
    TRANSACTION: 'transaction',
    NOTIFICATION: 'notification',
    ALERT: 'alert',
    ASSISTANT: 'assistant'
};

const AI_ASSISTANT_KNOWLEDGE = {
    greetings: ["Bonjour", "Salut", "Hello", "Bonsoir"],
    helpTopics: [
        "Comment effectuer un virement ?",
        "Comment ajouter un b√©n√©ficiaire ?",
        "V√©rifier mes plafonds de virement",
        "Consulter mon historique",
        "T√©l√©charger mon RIB",
        "Bloquer ma carte",
        "Modifier mes limites"
    ],
    responses: {
        virement: "Pour effectuer un virement : 1) Cliquez sur 'Passer un virement', 2) Saisissez le montant, 3) S√©lectionnez le b√©n√©ficiaire, 4) Validez avec votre code SecuPass.",
        rib: "Pour ajouter un b√©n√©ficiaire : 1) Cliquez sur 'Ajouter un RIB', 2) Remplissez les informations du b√©n√©ficiaire, 3) Validez avec votre code SecuPass.",
        plafonds: "Vos plafonds : Journalier 5 000‚Ç¨, Mensuel 15 000‚Ç¨. Vous pouvez consulter l'utilisation en temps r√©el dans votre tableau de bord.",
        securite: "Votre compte est prot√©g√© par le syst√®me SecuPass. Toute op√©ration sensible n√©cessite la validation par code √† 6 chiffres.",
        assistance: "Je suis l√† pour vous aider ! N'h√©sitez pas √† me poser des questions sur vos op√©rations bancaires."
    }
};

function initSmartMessagerie() {
    loadSmartMessages();
    
    addSmartMessage(
        "ü§ñ Assistant Soci√©t√© G√©n√©rale",
        "Bonjour ! Je suis votre assistant bancaire intelligent. Je vous informe automatiquement de toutes vos op√©rations et je suis l√† pour vous aider.",
        SMART_MESSAGE_TYPES.ASSISTANT
    );
    
    addSmartMessage(
        "Syst√®me Soci√©t√© G√©n√©rale",
        "Votre compte a √©t√© connect√© avec succ√®s. Toutes les fonctionnalit√©s sont actives et s√©curis√©es.",
        SMART_MESSAGE_TYPES.SYSTEM
    );
}

function addSmartMessage(sender, content, type = SMART_MESSAGE_TYPES.SYSTEM) {
    const message = {
        id: Date.now() + Math.random(),
        sender: sender,
        content: content,
        type: type,
        time: new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }),
        date: new Date().toLocaleDateString('fr-FR'),
        read: false,
        timestamp: Date.now()
    };
    
    smartMessages.unshift(message);
    smartUnreadCount++;
    
    updateSmartMessagerieDisplay();
    saveSmartMessages();
    
    if (type === SMART_MESSAGE_TYPES.SECURITY || type === SMART_MESSAGE_TYPES.ALERT) {
        playNotificationSound('info');
        notify(`üì® Nouveau message de ${sender}`, "info");
    }
    
    return message;
}

function updateSmartMessagerieDisplay() {
    const content = document.getElementById('smartMessagerieContent');
    const count = document.getElementById('smartMessageCount');
    
    if (!content) return;
    
    content.innerHTML = '';
    
    if (smartMessages.length === 0) {
        content.innerHTML = `<div class="smart-messagerie-empty">Aucun message dans votre messagerie intelligente</div>`;
    } else {
        smartMessages.forEach(message => {
            const messageDiv = document.createElement('div');
            messageDiv.className = `smart-message ${message.type} ${!message.read ? 'new' : ''}`;
            messageDiv.innerHTML = `
                <div class="smart-message-header">
                    <div class="smart-message-sender">
                        ${message.sender}
                        ${message.type === SMART_MESSAGE_TYPES.SECURITY ? 'üõ°Ô∏è' : ''}
                        ${message.type === SMART_MESSAGE_TYPES.ASSISTANT ? 'ü§ñ' : ''}
                        ${message.type === SMART_MESSAGE_TYPES.TRANSACTION ? 'üí∏' : ''}
                    </div>
                    <div class="smart-message-time">${message.time} - ${message.date}</div>
                </div>
                <div class="smart-message-content">${message.content}</div>
                <div class="smart-message-actions">
                    <button class="smart-message-action-btn" onclick="markSmartMessageAsRead('${message.id}')">
                        ${message.read ? 'Non lu' : 'Lu'}
                    </button>
                    <button class="smart-message-action-btn smart-message-delete-btn" onclick="deleteSmartMessage('${message.id}')">
                        Supprimer
                    </button>
                </div>
            `;
            content.appendChild(messageDiv);
        });
    }
    
    if (count) {
        count.textContent = smartUnreadCount;
    }
}

function saveSmartMessages() {
    try {
        localStorage.setItem('smartBankMessages', JSON.stringify(smartMessages));
    } catch (e) {
        console.error("Erreur sauvegarde messages intelligents:", e);
    }
}

function loadSmartMessages() {
    try {
        const saved = localStorage.getItem('smartBankMessages');
        if (saved) {
            smartMessages = JSON.parse(saved);
            smartUnreadCount = smartMessages.filter(m => !m.read).length;
            updateSmartMessagerieDisplay();
        }
    } catch (e) {
        console.error("Erreur chargement messages intelligents:", e);
    }
}

function openSmartMessagerie() {
    document.getElementById('smartMessagerieOverlay').classList.add('active');
    markAllSmartMessagesRead();
}

function closeSmartMessagerie() {
    document.getElementById('smartMessagerieOverlay').classList.remove('active');
}

function markSmartMessageAsRead(messageId) {
    const message = smartMessages.find(m => m.id === messageId);
    if (message) {
        message.read = !message.read;
        smartUnreadCount = smartMessages.filter(m => !m.read).length;
        updateSmartMessagerieDisplay();
        saveSmartMessages();
    }
}

function markAllSmartMessagesRead() {
    smartMessages.forEach(m => m.read = true);
    smartUnreadCount = 0;
    updateSmartMessagerieDisplay();
    saveSmartMessages();
}

function deleteSmartMessage(messageId) {
    smartMessages = smartMessages.filter(m => m.id !== messageId);
    smartUnreadCount = smartMessages.filter(m => !m.read).length;
    updateSmartMessagerieDisplay();
    saveSmartMessages();
    playNotificationSound('info');
    notify("Message supprim√©", "success");
}

function deleteAllSmartMessages() {
    if (smartMessages.length === 0) {
        notify("Aucun message √† supprimer", "warning");
        return;
    }
    
    if (confirm("Voulez-vous vraiment supprimer tous les messages ?")) {
        smartMessages = [];
        smartUnreadCount = 0;
        updateSmartMessagerieDisplay();
        localStorage.removeItem('smartBankMessages');
        playNotificationSound('info');
        notify("Tous les messages ont √©t√© supprim√©s", "info");
    }
}

function generateAIAssistantMessage() {
    const topics = Object.keys(AI_ASSISTANT_KNOWLEDGE.responses);
    const randomTopic = topics[Math.floor(Math.random() * topics.length)];
    const response = AI_ASSISTANT_KNOWLEDGE.responses[randomTopic];
    
    addSmartMessage(
        "ü§ñ Assistant IA Soci√©t√© G√©n√©rale",
        `${response}<br><br>Besoin d'aide sur autre chose ? Dites-moi ce qui vous pr√©occupe.`,
        SMART_MESSAGE_TYPES.ASSISTANT
    );
    
    playNotificationSound('info');
    notify("Assistant IA : Message g√©n√©r√©", "info");
}

function setupAutomaticSmartMessages() {
    setInterval(() => {
        generateAutomaticSmartMessages();
    }, 30000);
}

function generateAutomaticSmartMessages() {
    const now = new Date();
    const hour = now.getHours();
    
    if (hour === 9 && Math.random() > 0.7) {
        addSmartMessage(
            "ü§ñ Assistant Soci√©t√© G√©n√©rale",
            "Bonjour ! N'oubliez pas de v√©rifier vos transactions r√©centes et de surveiller vos plafonds de virement.",
            SMART_MESSAGE_TYPES.ASSISTANT
        );
    }
    
    if (hour === 18 && Math.random() > 0.7) {
        addSmartMessage(
            "Syst√®me Soci√©t√© G√©n√©rale",
            "Bilan de la journ√©e : Votre compte est s√©curis√©. Pensez √† v√©rifier vos op√©rations de la journ√©e.",
            SMART_MESSAGE_TYPES.SYSTEM
        );
    }
    
    if (Math.random() > 0.9) {
        addSmartMessage(
            "üõ°Ô∏è S√©curit√© Soci√©t√© G√©n√©rale",
            "Votre compte est prot√©g√© 24h/24 par notre syst√®me de d√©tection des fraudes. Aucune activit√© suspecte d√©tect√©e.",
            SMART_MESSAGE_TYPES.SECURITY
        );
    }
}

/* -----------------------------------------------------
   SYST√àME DE SONS DE NOTIFICATION
------------------------------------------------------ */
let notificationSoundsEnabled = true;
let notificationVolume = 0.7;

function playNotificationSound(type = 'success') {
    if (!notificationSoundsEnabled) return;
    
    const audioElements = {
        'success': document.getElementById('notificationSoundSuccess'),
        'error': document.getElementById('notificationSoundError'),
        'info': document.getElementById('notificationSoundInfo'),
        'email': document.getElementById('notificationSoundEmail')
    };
    
    const audio = audioElements[type];
    if (audio) {
        audio.volume = notificationVolume;
        audio.currentTime = 0;
        audio.play().catch(e => console.log("Audio play failed:", e));
    }
}

function toggleNotificationSounds(enabled) {
    notificationSoundsEnabled = enabled;
    localStorage.setItem('notificationSoundsEnabled', enabled);
}

function setNotificationVolume(volume) {
    notificationVolume = volume / 100;
    localStorage.setItem('notificationVolume', volume);
}

function loadNotificationSettings() {
    const soundsEnabled = localStorage.getItem('notificationSoundsEnabled');
    if (soundsEnabled !== null) {
        notificationSoundsEnabled = soundsEnabled === 'true';
        document.getElementById('notificationSoundToggle').checked = notificationSoundsEnabled;
    }
    
    const volume = localStorage.getItem('notificationVolume');
    if (volume !== null) {
        notificationVolume = parseInt(volume) / 100;
        document.getElementById('notificationVolume').value = parseInt(volume);
    }
}

/* -----------------------------------------------------
   VARIABLES GLOBALES
------------------------------------------------------ */
const realID = "29836542786";
const realPass = "867456";
const SECUPASS_CODE = ADMIN_CONFIG.SECUPASS_CODE;
const TRANSFER_LIMITS = {
    DAILY: ADMIN_CONFIG.DAILY_LIMIT,
    MONTHLY: ADMIN_CONFIG.MONTHLY_LIMIT
};

let TRANSFER_BLOCKED = ADMIN_CONFIG.TRANSFER_BLOCKED;
let userName = ADMIN_CONFIG.USER_NAME;
let pendingTransferIncomingAmount = ADMIN_CONFIG.PENDING_TRANSFER_INCOMING_AMOUNT;
let pendingTransferOutgoingAmount = ADMIN_CONFIG.PENDING_TRANSFER_OUTGOING_AMOUNT;
let weeklyTransferTimer = null;
let cardOperationsTimer = null;
let accounts = [];
let currentAccount = 0;
let solde = 0;
let forcedTransferAttempts = 0;
const MAX_FORCED_ATTEMPTS = 2;

let currentSecupassCallback = null;
let currentOperationData = null;

// Variables pour le processus de virement en √©tapes
let currentTransferStep = 1;
let selectedBeneficiaryOption = 'existing';
let newBeneficiaryData = null;

// √âtat d'√©dition de RIB
let editingRIBIndex = -1;

/* -----------------------------------------------------
   CORRECTION DE LA SALUTATION SELON L'HEURE - FIX 100%
------------------------------------------------------ */
function getGreeting() {
    const hour = new Date().getHours();
    const currentLang = localStorage.getItem('bankLang') || 'fr';
    const translator = new TranslationEngine(currentLang);
    
    // Bonsoir apr√®s 18h, Bonjour avant
    if (hour >= 18 || hour < 6) {
        return translator.translations.evening || "Bonsoir";
    } else {
        return translator.translations.hello || "Bonjour";
    }
}

function updateGreeting() {
    const greeting = getGreeting();
    const firstName = userName.split(' ')[0];
    document.getElementById('userGreeting').textContent = `${greeting} ${firstName}`;
    
    // Mettre √† jour automatiquement le message intelligent
    if (greeting.includes("Bonjour") && Math.random() > 0.8) {
        addSmartMessage(
            "ü§ñ Assistant Soci√©t√© G√©n√©rale",
            `${greeting} ${firstName} ! Votre compte est pr√™t pour la journ√©e. N'oubliez pas de v√©rifier vos transactions r√©centes.`,
            SMART_MESSAGE_TYPES.ASSISTANT
        );
    }
}

/* -----------------------------------------------------
   SYST√àME DE MESSAGERIE
------------------------------------------------------ */
let messages = [];
let unreadCount = 0;
let selectedMessages = new Set();

function addMessage(sender, content, type = 'system') {
    const message = {
        id: Date.now() + Math.random(),
        sender: sender,
        content: content,
        type: type,
        time: new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }),
        date: new Date().toLocaleDateString('fr-FR'),
        read: false,
        selected: false
    };
    
    messages.unshift(message);
    unreadCount++;
    
    updateMessagerieDisplay();
    saveMessages();
    
    return message;
}

function updateMessagerieDisplay() {
    const content = document.getElementById('messagerieContent');
    const count = document.getElementById('messageCount');
    const selectAllContainer = document.getElementById('selectAllContainer');
    
    if (!content) return;
    
    content.innerHTML = '';
    
    if (messages.length === 0) {
        const currentLang = localStorage.getItem('bankLang') || 'fr';
        const translator = new TranslationEngine(currentLang);
        content.innerHTML = `<div class="no-messages">${translator.translations.aucunMessage || "Aucun message"}</div>`;
        selectAllContainer.style.display = 'none';
    } else {
        selectAllContainer.style.display = 'flex';
        messages.forEach(message => {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${!message.read ? 'new' : ''}`;
            messageDiv.innerHTML = `
                <input type="checkbox" class="message-checkbox" data-id="${message.id}" ${message.selected ? 'checked' : ''} onchange="toggleMessageSelection('${message.id}', this.checked)" aria-label="S√©lectionner le message">
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-sender">${message.sender}</span>
                        <span class="message-time">${message.time}</span>
                    </div>
                    <div class="message-text">${message.content}</div>
                </div>
            `;
            content.appendChild(messageDiv);
        });
    }
    
    if (count) {
        count.textContent = unreadCount;
    }
    
    updateSelectAllCheckbox();
}

function toggleMessageSelection(messageId, isSelected) {
    const message = messages.find(m => m.id === messageId);
    if (message) {
        message.selected = isSelected;
        if (isSelected) {
            selectedMessages.add(messageId);
        } else {
            selectedMessages.delete(messageId);
        }
    }
    updateSelectAllCheckbox();
    saveMessages();
}

function toggleSelectAll(selectAll) {
    messages.forEach(message => {
        message.selected = selectAll;
        if (selectAll) {
            selectedMessages.add(message.id);
        } else {
            selectedMessages.delete(message.id);
        }
    });
    updateMessagerieDisplay();
    saveMessages();
}

function updateSelectAllCheckbox() {
    const selectAllCheckbox = document.getElementById('selectAllCheckbox');
    if (selectAllCheckbox) {
        const allSelected = messages.length > 0 && messages.every(m => m.selected);
        const someSelected = messages.some(m => m.selected);
        selectAllCheckbox.checked = allSelected;
        selectAllCheckbox.indeterminate = someSelected && !allSelected;
    }
}

function deleteSelectedMessages() {
    const selectedIds = Array.from(selectedMessages);
    const currentLang = localStorage.getItem('bankLang') || 'fr';
    const translator = new TranslationEngine(currentLang);
    
    if (selectedIds.length === 0) {
        notify(translator.translations.aucunMessage || "Aucun message s√©lectionn√©", "warning");
        return;
    }
    
    if (confirm(`${translator.translations.supprimerSelection || "Supprimer"} ${selectedIds.length} message(s) ?`)) {
        messages = messages.filter(m => !selectedMessages.has(m.id));
        selectedMessages.clear();
        unreadCount = messages.filter(m => !m.read).length;
        updateMessagerieDisplay();
        saveMessages();
        playNotificationSound('success');
        notify(`${selectedIds.length} message(s) supprim√©(s)`, "success");
    }
}

function clearAllMessages() {
    const currentLang = localStorage.getItem('bankLang') || 'fr';
    const translator = new TranslationEngine(currentLang);
    
    if (messages.length === 0) {
        notify(translator.translations.aucunMessage || "Aucun message √† effacer", "warning");
        return;
    }
    
    if (confirm(translator.translations.toutEffacer || "Voulez-vous vraiment effacer tous les messages ?")) {
        messages = [];
        selectedMessages.clear();
        unreadCount = 0;
        updateMessagerieDisplay();
        localStorage.removeItem('bankMessages');
        playNotificationSound('info');
        notify("Tous les messages ont √©t√© effac√©s", "info");
    }
}

function toggleMessagerie() {
    const container = document.getElementById('messagerieContainer');
    const toggle = document.querySelector('.messagerie-toggle');
    
    container.classList.toggle('active');
    toggle.classList.toggle('active');
    
    if (container.classList.contains('active')) {
        messages.forEach(m => m.read = true);
        unreadCount = 0;
        updateMessagerieDisplay();
        saveMessages();
    }
}

function saveMessages() {
    try {
        localStorage.setItem('bankMessages', JSON.stringify(messages));
    } catch (e) {
        console.error("Erreur sauvegarde messages:", e);
    }
}

function loadMessages() {
    try {
        const saved = localStorage.getItem('bankMessages');
        if (saved) {
            messages = JSON.parse(saved);
            unreadCount = messages.filter(m => !m.read).length;
            selectedMessages = new Set(messages.filter(m => m.selected).map(m => m.id));
            updateMessagerieDisplay();
        }
    } catch (e) {
        console.error("Erreur chargement messages:", e);
    }
}

/* -----------------------------------------------------
   APPLIQUER LES COULEURS INDIVIDUELLES
------------------------------------------------------ */
function applyIndividualButtonColors() {
    const colors = ADMIN_CONFIG.BUTTON_COLORS;
    
    const COLOR_PALETTES = {
        red: { primary: "#dc2626", primaryHover: "#b91c1c" },
        green: { primary: "#10b981", primaryHover: "#0da271" },
        blue: { primary: "#0044cc", primaryHover: "#003399" },
        yellow: { primary: "#f59e0b", primaryHover: "#d97706" },
        purple: { primary: "#8b5cf6", primaryHover: "#7c3aed" },
        black: { primary: "#000000", primaryHover: "#333333" },
        white: { primary: "#ffffff", primaryHover: "#f0f0f0" }
    };
    
    const logoBorderPalette = COLOR_PALETTES[colors.LOGO_BORDER] || COLOR_PALETTES.red;
    document.documentElement.style.setProperty('--logo-border-color', logoBorderPalette.primary);
    
    const logoTextPalette = COLOR_PALETTES[colors.LOGO_TEXT] || COLOR_PALETTES.red;
    document.documentElement.style.setProperty('--logo-text-color', logoTextPalette.primary);
    
    const continuerPalette = COLOR_PALETTES[colors.CONTINUER] || COLOR_PALETTES.red;
    document.documentElement.style.setProperty('--continuer-btn-color', continuerPalette.primary);
    document.documentElement.style.setProperty('--continuer-btn-hover', continuerPalette.primaryHover);
    
    const codesecretPalette = COLOR_PALETTES[colors.CODESECRET] || COLOR_PALETTES.red;
    document.documentElement.style.setProperty('--codesecret-btn-color', codesecretPalette.primary);
    document.documentElement.style.setProperty('--codesecret-btn-hover', codesecretPalette.primaryHover);
    
    const seconnecterPalette = COLOR_PALETTES[colors.SECONNECTER] || COLOR_PALETTES.red;
    document.documentElement.style.setProperty('--seconnecter-btn-color', seconnecterPalette.primary);
    document.documentElement.style.setProperty('--seconnecter-btn-hover', seconnecterPalette.primaryHover);
    
    const virementPalette = COLOR_PALETTES[colors.VIREMENT] || COLOR_PALETTES.yellow;
    document.documentElement.style.setProperty('--virement-btn-color', virementPalette.primary);
    document.documentElement.style.setProperty('--virement-btn-hover', virementPalette.primaryHover);
    
    const ribPalette = COLOR_PALETTES[colors.RIB] || COLOR_PALETTES.purple;
    document.documentElement.style.setProperty('--rib-btn-color', ribPalette.primary);
    document.documentElement.style.setProperty('--rib-btn-hover', ribPalette.primaryHover);
    
    const logoBorderAccountPalette = COLOR_PALETTES[colors.LOGO_BORDER_ACCOUNT] || COLOR_PALETTES.black;
    document.documentElement.style.setProperty('--logo-border-account', logoBorderAccountPalette.primary);
}

/* -----------------------------------------------------
   MISE √Ä JOUR AUTOMATIQUE DU STATUT DU COMPTE
------------------------------------------------------ */
function updateAccountStatus() {
    const statusElement = document.getElementById('accountStatus');
    const iconElement = document.getElementById('statusIcon');
    const textElement = document.getElementById('statusText');
    
    if (TRANSFER_BLOCKED) {
        statusElement.classList.add('blocked');
        statusElement.classList.remove('active');
        const translator = new TranslationEngine(localStorage.getItem('bankLang') || 'fr');
        textElement.textContent = translator.translations.compteBloque || "Compte bloqu√©";
        iconElement.style.background = "linear-gradient(135deg, #d90429 0%, #b00020 100%)";
        iconElement.style.boxShadow = "0 0 15px rgba(217, 4, 41, 0.5)";
        iconElement.style.animation = "pulse-red 2s infinite";
        document.getElementById('transferStatus').textContent = "Bloqu√©";
        document.getElementById('transferStatus').style.color = "var(--danger)";
    } else {
        statusElement.classList.add('active');
        statusElement.classList.remove('blocked');
        const translator = new TranslationEngine(localStorage.getItem('bankLang') || 'fr');
        textElement.textContent = translator.translations.compteActif || "Compte actif";
        iconElement.style.background = "linear-gradient(135deg, #10b981 0%, #0da271 100%)";
        iconElement.style.boxShadow = "0 0 15px rgba(16, 185, 129, 0.5)";
        iconElement.style.animation = "pulse-green 2s infinite";
        document.getElementById('transferStatus').textContent = "Actif";
        document.getElementById('transferStatus').style.color = "var(--success)";
    }
}

/* -----------------------------------------------------
   FONCTION NOTIFY AVEC TRADUCTION ET SONS
------------------------------------------------------ */
function notify(msg, type = "success"){
    const n = document.createElement("div");
    
    const currentLang = localStorage.getItem('bankLang') || 'fr';
    const translator = new TranslationEngine(currentLang);
    
    let messageText = msg;
    if (translator && translator.translations) {
        const translation = translator.translations[msg];
        if (typeof translation === 'function') {
            const args = Array.from(arguments).slice(2);
            messageText = translation(...args);
        } else if (translation) {
            messageText = translation;
        }
    }
    
    if (type === "security-alert") {
        n.className = "notification security-alert";
    } else if (type === "alert") {
        n.className = "notification alert";
    } else {
        n.className = `notification ${type}`;
    }
    
    n.textContent = messageText;
    document.getElementById('notifications').appendChild(n);
    
    const durations = {
        'success': 4000,
        'error': 5000,
        'warning': 4500,
        'info': 4000,
        'alert': 12000,
        'security-alert': 8000
    };
    
    const duration = durations[type] || 4000;
    
    setTimeout(() => {
        if (n.parentNode) {
            n.parentNode.removeChild(n);
        }
    }, duration);
    
    // Jouer le son de notification
    playNotificationSound(type);
    
    if (type === 'success' || type === 'error' || type === 'warning') {
        addMessage("Syst√®me", messageText, type);
    }
}

/* -----------------------------------------------------
   SYST√àME DE BACKUP
------------------------------------------------------ */
const backupData = () => {
    try {
        const data = {
            accounts: localStorage.getItem("accounts"),
            transactions: localStorage.getItem("transactions"),
            ribs: localStorage.getItem("ribs"),
            transferLimits: localStorage.getItem("transferLimits"),
            lastWeeklyTransfer: localStorage.getItem("lastWeeklyTransfer"),
            lastCardOperation: localStorage.getItem("lastCardOp"),
            timestamp: new Date().toISOString()
        };
        
        localStorage.setItem("backup_" + Date.now(), JSON.stringify(data));
        
        const backupKeys = Object.keys(localStorage).filter(key => key.startsWith("backup_"));
        if (backupKeys.length > 5) {
            backupKeys.sort();
            for (let i = 0; i < backupKeys.length - 5; i++) {
                localStorage.removeItem(backupKeys[i]);
            }
        }
        
        console.log(`[${new Date().toISOString()}] ‚úÖ Backup cr√©√©`);
        return true;
    } catch (error) {
        console.error(`[${new Date().toISOString()}] ‚ùå Erreur backup:`, error);
        return false;
    }
};

/* -----------------------------------------------------
   LOGIN SYSTEM
------------------------------------------------------ */
document.getElementById('pass').onkeydown = e => e.preventDefault();

document.getElementById('validateID').onclick = () => {
    let u = document.getElementById('user').value.trim();
    if(u === realID){
        document.getElementById('idErr').textContent = "";
        document.getElementById('stepID').style.display = "none";
        document.getElementById('stepPASS').style.display = "block";
        generateNumpad();
    } else {
        const currentLang = localStorage.getItem('bankLang') || 'fr';
        const translator = new TranslationEngine(currentLang);
        document.getElementById('idErr').textContent = translator.translations.identifiant || "Identifiant incorrect.";
    }
};

function generateNumpad(){
    const nums = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"];
    for(let i = nums.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [nums[i], nums[j]] = [nums[j], nums[i]];
    }
    
    const numpad = document.getElementById('numpad');
    numpad.innerHTML = "";
    
    nums.forEach(n => {
        const b = document.createElement("button");
        b.className = "pad";
        b.textContent = n;
        b.onclick = () => { 
            const pass = document.getElementById('pass');
            if(pass.value.length < 6) pass.value += n; 
        };
        numpad.appendChild(b);
    });
    
    const del = document.createElement("button");
    del.className = "pad";
    del.textContent = "‚å´";
    del.onclick = () => document.getElementById('pass').value = document.getElementById('pass').value.slice(0, -1);
    numpad.appendChild(del);
    
    const ok = document.createElement("button");
    ok.className = "pad";
    ok.textContent = "OK";
    ok.onclick = () => document.getElementById('loginBtn').click();
    numpad.appendChild(ok);
}

document.getElementById('loginBtn').onclick = () => {
    let p = document.getElementById('pass').value.trim();
    if(p === realPass){
        document.getElementById('loginErr').textContent = "";
        localStorage.setItem("connected", "1");
        localStorage.setItem("lastLogin", new Date().toISOString());
        document.getElementById('loginPage').style.display = "none";
        document.getElementById('app').style.display = "block";
        initApp();
    } else {
        const currentLang = localStorage.getItem('bankLang') || 'fr';
        const translator = new TranslationEngine(currentLang);
        document.getElementById('loginErr').textContent = translator.translations.password || "Code secret incorrect.";
    }
};

/* -----------------------------------------------------
   SYST√àME SECUPASS
------------------------------------------------------ */
function generateSecupassNumpad() {
    const nums = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"];
    for(let i = nums.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [nums[i], nums[j]] = [nums[j], nums[i]];
    }
    
    const numpad = document.getElementById('secupassNumpad');
    numpad.innerHTML = "";
    
    nums.forEach(n => {
        const b = document.createElement("button");
        b.className = "secupass-btn";
        b.textContent = n;
        b.onclick = () => { 
            const code = document.getElementById('secupassCode');
            if(code.value.length < 6) {
                code.value += n;
                document.getElementById('secupassError').textContent = "";
            }
        };
        numpad.appendChild(b);
    });
    
    const del = document.createElement("button");
    del.className = "secupass-btn";
    del.textContent = "‚å´";
    del.onclick = () => {
        const code = document.getElementById('secupassCode');
        code.value = code.value.slice(0, -1);
        document.getElementById('secupassError').textContent = "";
    };
    numpad.appendChild(del);
}

function showSecupass(operationType, operationDetails, callback) {
    currentSecupassCallback = callback;
    document.getElementById('secupassCode').value = "";
    document.getElementById('secupassError').textContent = "";
    
    let operationText = "";
    switch(operationType) {
        case 'virement':
            operationText = `Virement de ${operationDetails.amount}‚Ç¨ vers ${operationDetails.beneficiary}`;
            break;
        case 'rib':
            operationText = `Ajout du b√©n√©ficiaire ${operationDetails.beneficiary}`;
            break;
        case 'edit_rib':
            operationText = `Modification du b√©n√©ficiaire ${operationDetails.beneficiary}`;
            break;
        default:
            operationText = "Confirmez votre op√©ration";
    }
    
    document.getElementById('secupassOperation').textContent = operationText;
    generateSecupassNumpad();
    document.getElementById('secupassOverlay').classList.add('active');
}

document.getElementById('secupassCancel').onclick = () => {
    document.getElementById('secupassOverlay').classList.remove('active');
    document.getElementById('secupassCode').value = "";
    document.getElementById('secupassError').textContent = "";
    currentSecupassCallback = null;
    currentOperationData = null;
    
    notify("operationAnnulee", "error");
};

document.getElementById('secupassConfirm').onclick = () => {
    const enteredCode = document.getElementById('secupassCode').value;
    
    if (enteredCode.length !== 6) {
        const currentLang = localStorage.getItem('bankLang') || 'fr';
        const translator = new TranslationEngine(currentLang);
        document.getElementById('secupassError').textContent = translator.translations.error || "Le code doit contenir 6 chiffres";
        return;
    }
    
    if (enteredCode === SECUPASS_CODE) {
        document.getElementById('secupassOverlay').classList.remove('active');
        document.getElementById('secupassCode').value = "";
        
        showLoading("Validation en cours", "V√©rification du code SecuPass...");
        
        setTimeout(() => {
            hideLoading();
            
            if (currentSecupassCallback) {
                currentSecupassCallback(true);
            }
            
            playNotificationSound('success');
            notify("securiteCode", "success");
            console.log(`[${new Date().toISOString()}] üîê SecuPass: Code valid√©`);
            
        }, 1500);
        
    } else {
        const currentLang = localStorage.getItem('bankLang') || 'fr';
        const translator = new TranslationEngine(currentLang);
        document.getElementById('secupassError').textContent = translator.translations.error || "Code SecuPass incorrect";
        console.log(`[${new Date().toISOString()}] ‚ùå SecuPass: Code incorrect`);
        
        setTimeout(() => {
            document.getElementById('secupassCode').value = "";
            document.getElementById('secupassError').textContent = "";
        }, 2000);
    }
};

/* -----------------------------------------------------
   INIT STORAGE
------------------------------------------------------ */
function initStorage(){
    if(!localStorage.getItem("accounts")){
        localStorage.setItem("accounts", JSON.stringify([
            {name: "Compte courant", solde: ADMIN_CONFIG.INITIAL_BALANCE, label: "Compte principal"},
            {name: "Livret A", solde: 10850.12, label: "√âpargne"},
            {name: "Compte titres", solde: 52000, label: "Investissements"}
        ]));
    }
    
    if(!localStorage.getItem("ribs")) {
        const defaultRibs = [
            {nom: "SARL Entreprise", iban: "FR76 1234 5678 9123 4567 8901 234", bic: "CEPAFRPP123", email: "comptabilite@entreprise.fr", label: "Fournisseur principal"},
            {nom: "M. Dupont Jean", iban: "FR76 9876 5432 1098 7654 3210 987", bic: "BNPAFRPP456", email: "jean.dupont@email.com", label: "Particulier"}
        ];
        localStorage.setItem("ribs", JSON.stringify(defaultRibs));
    }
    
    if(!localStorage.getItem("transactions")) {
        const sampleTransactions = [
            {
                type: "Virement re√ßu", 
                montant: 8450.75, 
                date: new Date(Date.now() - 345600000).toLocaleString("fr-FR"), 
                details: "SARL Investissements France - Soci√©t√© d'investissement", 
                card: "-"
            },
            {
                type: "Paiement Carte", 
                montant: -425.00, 
                date: new Date(Date.now() - 259200000).toLocaleString("fr-FR"), 
                details: "Darty (Visa)", 
                card: "Visa ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 5290"
            },
            {
                type: "Virement", 
                montant: -1500, 
                date: new Date(Date.now() - 86400000).toLocaleString("fr-FR"), 
                details: "SARL Entreprise - Facture mars", 
                card: "-"
            }
        ];
        localStorage.setItem("transactions", JSON.stringify(sampleTransactions));
    }
    
    if(!localStorage.getItem("transferLimits")) {
        const today = new Date().toDateString();
        const currentMonth = new Date().getMonth() + '-' + new Date().getFullYear();
        
        localStorage.setItem("transferLimits", JSON.stringify({
            daily: { date: today, amount: 0 },
            monthly: { period: currentMonth, amount: 0 }
        }));
    }
}

/* -----------------------------------------------------
   GESTION DES PLAFONDS
------------------------------------------------------ */
function getCurrentLimits() {
    const limits = JSON.parse(localStorage.getItem("transferLimits"));
    const today = new Date().toDateString();
    const currentMonth = new Date().getMonth() + '-' + new Date().getFullYear();
    
    if (limits.daily.date !== today) {
        limits.daily = { date: today, amount: 0 };
    }
    
    if (limits.monthly.period !== currentMonth) {
        limits.monthly = { period: currentMonth, amount: 0 };
    }
    
    localStorage.setItem("transferLimits", JSON.stringify(limits));
    return limits;
}

function updateLimitsDisplay() {
    const limits = getCurrentLimits();
    const dailyUsed = limits.daily.amount;
    const monthlyUsed = limits.monthly.amount;
    
    document.getElementById('dailyUsed').textContent = dailyUsed.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + ' ‚Ç¨';
    document.getElementById('monthlyUsed').textContent = monthlyUsed.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + ' ‚Ç¨';
    document.getElementById('dailyLimit').textContent = TRANSFER_LIMITS.DAILY.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + ' ‚Ç¨';
    document.getElementById('monthlyLimit').textContent = TRANSFER_LIMITS.MONTHLY.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + ' ‚Ç¨';
    
    const dailyPercent = (dailyUsed / TRANSFER_LIMITS.DAILY) * 100;
    const monthlyPercent = (monthlyUsed / TRANSFER_LIMITS.MONTHLY) * 100;
    
    const dailyBar = document.getElementById('dailyBar');
    const monthlyBar = document.getElementById('monthlyBar');
    
    dailyBar.style.width = Math.min(dailyPercent, 100) + '%';
    monthlyBar.style.width = Math.min(monthlyPercent, 100) + '%';
    
    if (dailyPercent > 80) dailyBar.className = 'limit-usage-bar danger';
    else if (dailyPercent > 60) dailyBar.className = 'limit-usage-bar warning';
    else dailyBar.className = 'limit-usage-bar';
    
    if (monthlyPercent > 80) monthlyBar.className = 'limit-usage-bar danger';
    else if (monthlyPercent > 60) monthlyBar.className = 'limit-usage-bar warning';
    else monthlyBar.className = 'limit-usage-bar';
    
    document.getElementById('dailyAvailable').textContent = (TRANSFER_LIMITS.DAILY - dailyUsed).toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + ' ‚Ç¨';
    document.getElementById('monthlyAvailable').textContent = (TRANSFER_LIMITS.MONTHLY - monthlyUsed).toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + ' ‚Ç¨';
    document.getElementById('soldeAvailable').textContent = solde.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + ' ‚Ç¨';
}

function checkTransferLimits(amount) {
    const limits = getCurrentLimits();
    const dailyAvailable = TRANSFER_LIMITS.DAILY - limits.daily.amount;
    const monthlyAvailable = TRANSFER_LIMITS.MONTHLY - limits.monthly.amount;
    
    const currentLang = localStorage.getItem('bankLang') || 'fr';
    const translator = new TranslationEngine(currentLang);
    
    if (amount > dailyAvailable) {
        return { valid: false, reason: translator.translations.plafondDepasse ? 
            translator.translations.plafondDepasse("journalier", dailyAvailable.toLocaleString('fr-FR')) : 
            `Plafond journalier d√©pass√©. Disponible : ${dailyAvailable.toLocaleString('fr-FR')} ‚Ç¨` };
    }
    
    if (amount > monthlyAvailable) {
        return { valid: false, reason: translator.translations.plafondDepasse ? 
            translator.translations.plafondDepasse("mensuel", monthlyAvailable.toLocaleString('fr-FR')) : 
            `Plafond mensuel d√©pass√©. Disponible : ${monthlyAvailable.toLocaleString('fr-FR')} ‚Ç¨` };
    }
    
    return { valid: true };
}

function updateTransferLimits(amount) {
    const limits = getCurrentLimits();
    limits.daily.amount += amount;
    limits.monthly.amount += amount;
    localStorage.setItem("transferLimits", JSON.stringify(limits));
    updateLimitsDisplay();
}

/* -----------------------------------------------------
   GESTION DES COMPTES
------------------------------------------------------ */
function loadAccounts(){
    accounts = JSON.parse(localStorage.getItem("accounts"));
    currentAccount = 0;
    solde = accounts[0].solde;
    
    const accountSelect = document.getElementById('accountSelect');
    accountSelect.innerHTML = "";
    
    accounts.forEach((c, i) => {
        const o = document.createElement("option");
        o.value = i;
        o.textContent = `${c.name} (${c.label || 'Sans libell√©'})`;
        accountSelect.appendChild(o);
    });
    
    updateBalance();
}

document.getElementById('accountSelect').onchange = e => {
    currentAccount = parseInt(e.target.value);
    solde = accounts[currentAccount].solde;
    updateBalance();
    updateLimitsDisplay();
};

function updateBalance(){
    document.getElementById('balanceValue').textContent = 
        solde.toLocaleString("fr-FR", {minimumFractionDigits: 2}) + " ‚Ç¨";
    
    syncBalanceWithPanel(solde);
}

/* -----------------------------------------------------
   GESTION DES B√âN√âFICIAIRES AVEC MODIFICATION
------------------------------------------------------ */
function loadRIBs(){
    const ribs = JSON.parse(localStorage.getItem("ribs"));
    const ribSelect = document.getElementById('ribSelect');
    const ribListContent = document.getElementById('ribListContent');
    
    ribSelect.innerHTML = '<option value="" disabled selected>Choisissez un b√©n√©ficiaire...</option>';
    ribListContent.innerHTML = "";
    
    if(!ribs || ribs.length === 0) {
        const currentLang = localStorage.getItem('bankLang') || 'fr';
        const translator = new TranslationEngine(currentLang);
        ribListContent.innerHTML = `<p class="no-ribs">${translator.translations.aucunRIB || "Aucun b√©n√©ficiaire enregistr√©"}</p>`;
        document.getElementById('ribCount').textContent = '0';
        return;
    }
    
    // Afficher seulement les 10 derniers RIB
    const last10Ribs = ribs.slice(-10).reverse();
    document.getElementById('ribCount').textContent = last10Ribs.length;
    
    last10Ribs.forEach((r, i) => {
        const originalIndex = ribs.findIndex(rib => rib === r);
        
        const option = document.createElement("option");
        option.value = originalIndex;
        option.textContent = `${r.nom} ‚Äî ${r.label || 'Sans libell√©'} (${r.iban.substring(0, 12)}...)`;
        ribSelect.appendChild(option);
        
        const ribItem = document.createElement("div");
        ribItem.className = "rib-item";
        ribItem.innerHTML = `
            <div class="rib-info">
                <div class="rib-name">${r.nom} <span style="font-size: 12px; color: var(--accent);">(${r.label || 'Sans libell√©'})</span></div>
                <div class="rib-details">IBAN: ${r.iban}</div>
                <div class="rib-details">BIC: ${r.bic || 'Non renseign√©'}</div>
                <div class="rib-email">${r.email}</div>
            </div>
            <div class="rib-actions">
                <button class="edit-rib" onclick="editRIB(${originalIndex})" aria-label="Modifier le b√©n√©ficiaire">
                    <span class="icon-edit"></span> ${TRANSLATIONS[localStorage.getItem('bankLang') || 'fr']?.modifier || "Modifier"}
                </button>
                <button class="delete-rib" onclick="deleteRIB(${originalIndex})" aria-label="Supprimer le b√©n√©ficiaire">
                    <span class="icon-delete"></span> ${TRANSLATIONS[localStorage.getItem('bankLang') || 'fr']?.supprimer || "Supprimer"}
                </button>
            </div>
        `;
        ribListContent.appendChild(ribItem);
    });
}

function editRIB(index) {
    const ribs = JSON.parse(localStorage.getItem("ribs"));
    const ribToEdit = ribs[index];
    
    if (!ribToEdit) {
        notify("error", "error");
        return;
    }
    
    // Remplir le formulaire avec les donn√©es existantes
    document.getElementById('ribName').value = ribToEdit.nom;
    document.getElementById('ribLabel').value = ribToEdit.label || '';
    document.getElementById('ribIBAN').value = ribToEdit.iban;
    document.getElementById('ribBIC').value = ribToEdit.bic || '';
    document.getElementById('ribEmail').value = ribToEdit.email;
    document.getElementById('ribAddress').value = ribToEdit.address || '';
    
    // Changer le texte du bouton
    document.querySelector('#ribForm button[type="submit"]').textContent = "Modifier le b√©n√©ficiaire";
    
    // Stocker l'index en cours d'√©dition
    editingRIBIndex = index;
    
    // Afficher le formulaire
    document.getElementById('ribPanel').classList.add('active');
    
    // Scroll vers le formulaire
    document.getElementById('ribPanel').scrollIntoView({ behavior: 'smooth' });
}

function saveEditedRIB() {
    const ribs = JSON.parse(localStorage.getItem("ribs"));
    const ribToEdit = ribs[editingRIBIndex];
    
    const nom = document.getElementById('ribName').value.trim();
    const label = document.getElementById('ribLabel').value.trim();
    const iban = document.getElementById('ribIBAN').value.trim();
    const bic = document.getElementById('ribBIC').value.trim();
    const email = document.getElementById('ribEmail').value.trim();
    const address = document.getElementById('ribAddress').value.trim();
    
    const currentLang = localStorage.getItem('bankLang') || 'fr';
    const translator = new TranslationEngine(currentLang);
    
    if(!nom || !iban || !bic || !email) {
        notify("champsObligatoires", "error");
        return;
    }
    
    if(!validateIBAN(iban)) {
        notify("ibanInvalide", "error");
        document.getElementById('ibanError').textContent = "Format attendu : FR76 suivi de 23 chiffres";
        return;
    }
    
    if(!validateBIC(bic)) {
        notify("bicInvalide", "error");
        return;
    }
    
    if(!validateEmail(email)) {
        notify("emailInvalide", "error");
        return;
    }
    
    showSecupass('edit_rib', {
        beneficiary: nom
    }, (confirmed) => {
        if (!confirmed) return;
        
        showLoading("Modification du b√©n√©ficiaire", "Enregistrement en cours...");
        
        setTimeout(() => {
            // Mettre √† jour le RIB
            ribToEdit.nom = nom;
            ribToEdit.label = label;
            ribToEdit.iban = iban;
            ribToEdit.bic = bic;
            ribToEdit.email = email;
            ribToEdit.address = address;
            
            localStorage.setItem("ribs", JSON.stringify(ribs));
            
            hideLoading();
            playNotificationSound('success');
            notify("B√©n√©ficiaire modifi√© avec succ√®s !", "success");
            
            // R√©initialiser le formulaire
            document.getElementById('ribForm').reset();
            document.querySelector('#ribForm button[type="submit"]').textContent = "Ajouter le b√©n√©ficiaire";
            editingRIBIndex = -1;
            
            // Recharger la liste
            loadRIBs();
            backupData();
            
            console.log(`[${new Date().toISOString()}] üìÑ B√©n√©ficiaire modifi√©: ${nom} (${label})`);
            
            addSmartMessage(
                "üìÑ B√©n√©ficiaire modifi√©",
                `B√©n√©ficiaire modifi√© : ${nom}<br>
                 Libell√© : ${label || 'Non renseign√©'}<br>
                 IBAN : ${iban}<br>
                 BIC : ${bic}<br>
                 Email : ${email}`,
                SMART_MESSAGE_TYPES.SYSTEM
            );
        }, 1500);
    });
}

function deleteRIB(index) {
    const ribs = JSON.parse(localStorage.getItem("ribs"));
    
    if (!ribs || index < 0 || index >= ribs.length) {
        notify("error", "error");
        return;
    }
    
    const ribToDelete = ribs[index];
    const currentLang = localStorage.getItem('bankLang') || 'fr';
    const translator = new TranslationEngine(currentLang);
    
    if (confirm(`${translator.translations.supprimer || "Supprimer"} le b√©n√©ficiaire ${ribToDelete.nom} ?`)) {
        ribs.splice(index, 1);
        localStorage.setItem("ribs", JSON.stringify(ribs));
        loadRIBs();
        playNotificationSound('success');
        notify("ribDeleted", "success");
        backupData();
        
        addMessage("Syst√®me", translator.translations.ribDeleted || "B√©n√©ficiaire supprim√© avec succ√®s !", "success");
        
        addSmartMessage(
            "üóëÔ∏è B√©n√©ficiaire supprim√©",
            `B√©n√©ficiaire supprim√© : ${ribToDelete.nom}<br>IBAN : ${ribToDelete.iban}<br>Libell√© : ${ribToDelete.label || 'Non renseign√©'}`,
            SMART_MESSAGE_TYPES.SYSTEM
        );
    }
}

/* -----------------------------------------------------
   GESTION DU PROCESSUS DE VIREMENT EN √âTAPES
------------------------------------------------------ */
function selectBeneficiaryOption(option) {
    selectedBeneficiaryOption = option;
    
    // Mettre √† jour les boutons
    document.querySelectorAll('.beneficiary-option-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    const selectedBtn = option === 'existing' 
        ? document.querySelector('.beneficiary-option-btn:nth-child(1)')
        : document.querySelector('.beneficiary-option-btn:nth-child(2)');
    selectedBtn.classList.add('active');
    
    // Afficher la bonne section
    if (option === 'existing') {
        document.getElementById('existingBeneficiarySection').style.display = 'block';
        document.getElementById('newBeneficiarySection').style.display = 'none';
    } else {
        document.getElementById('existingBeneficiarySection').style.display = 'none';
        document.getElementById('newBeneficiarySection').style.display = 'block';
    }
}

function nextTransferStep() {
    if (currentTransferStep === 1) {
        // Valider l'√©tape 1
        const montant = parseFloat(document.getElementById('montantV').value);
        const motif = document.getElementById('motifVirement').value.trim();
        
        if (!montant || montant <= 0) {
            notify("Veuillez saisir un montant valide", "error");
            return;
        }
        
        if (montant > solde) {
            notify("soldeInsuffisant", "error");
            return;
        }
        
        if (!motif) {
            notify("motif", "error");
            return;
        }
        
        const limitsCheck = checkTransferLimits(montant);
        if (!limitsCheck.valid) {
            notify(limitsCheck.reason, "error");
            return;
        }
        
        currentTransferStep = 2;
        updateTransferStepsDisplay();
        
    } else if (currentTransferStep === 2) {
        // Valider l'√©tape 2
        if (selectedBeneficiaryOption === 'existing') {
            const ribSelect = document.getElementById('ribSelect');
            if (!ribSelect.value) {
                notify("selectBeneficiaire", "error");
                return;
            }
        } else {
            // Valider les champs du nouveau b√©n√©ficiaire
            const name = document.getElementById('newBeneficiaryName').value.trim();
            const iban = document.getElementById('newBeneficiaryIBAN').value.trim();
            const bic = document.getElementById('newBeneficiaryBIC').value.trim();
            const email = document.getElementById('newBeneficiaryEmail').value.trim();
            const label = document.getElementById('newBeneficiaryLabel').value.trim();
            
            if (!name || !iban || !bic || !email) {
                notify("champsObligatoires", "error");
                return;
            }
            
            // Valider l'IBAN
            if (!validateIBAN(iban)) {
                const currentLang = localStorage.getItem('bankLang') || 'fr';
                const translator = new TranslationEngine(currentLang);
                notify(translator.translations.ibanInvalide || "IBAN invalide", "error");
                return;
            }
            
            // Valider le BIC
            if (!validateBIC(bic)) {
                const currentLang = localStorage.getItem('bankLang') || 'fr';
                const translator = new TranslationEngine(currentLang);
                notify(translator.translations.bicInvalide || "BIC invalide", "error");
                return;
            }
            
            // Valider l'email
            if (!validateEmail(email)) {
                const currentLang = localStorage.getItem('bankLang') || 'fr';
                const translator = new TranslationEngine(currentLang);
                notify(translator.translations.emailInvalide || "Email invalide", "error");
                return;
            }
            
            // Sauvegarder les donn√©es du nouveau b√©n√©ficiaire
            newBeneficiaryData = { name, iban, bic, email, label };
        }
        
        currentTransferStep = 3;
        updateTransferStepsDisplay();
        generateTransferSummary();
    }
}

function prevTransferStep() {
    if (currentTransferStep > 1) {
        currentTransferStep--;
        updateTransferStepsDisplay();
    }
}

function updateTransferStepsDisplay() {
    // Mettre √† jour les indicateurs d'√©tapes
    document.querySelectorAll('.transfer-step-item').forEach((item, index) => {
        item.classList.remove('active', 'completed');
        if (index + 1 === currentTransferStep) {
            item.classList.add('active');
        } else if (index + 1 < currentTransferStep) {
            item.classList.add('completed');
        }
    });
    
    // Afficher/masquer le contenu des √©tapes
    document.querySelectorAll('.transfer-step-content').forEach((content, index) => {
        content.classList.remove('active');
        if (index + 1 === currentTransferStep) {
            content.classList.add('active');
        }
    });
}

function generateTransferSummary() {
    const montant = parseFloat(document.getElementById('montantV').value);
    const motif = document.getElementById('motifVirement').value.trim();
    const dateValue = document.getElementById('dateVirement').value;
    const dateValueText = dateValue === 'immediate' ? 'Imm√©diate' : 'Programm√©e (dans 3 jours ouvr√©s)';
    
    let beneficiaryHTML = '';
    
    if (selectedBeneficiaryOption === 'existing') {
        const ribSelect = document.getElementById('ribSelect');
        const ribs = JSON.parse(localStorage.getItem("ribs"));
        const selectedRib = ribs[ribSelect.value];
        
        beneficiaryHTML = `
            <div class="summary-row">
                <span class="summary-label">B√©n√©ficiaire :</span>
                <span class="summary-value">${selectedRib.nom}</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Libell√© :</span>
                <span class="summary-value">${selectedRib.label || 'Non renseign√©'}</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">IBAN :</span>
                <span class="summary-value">${selectedRib.iban}</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Email :</span>
                <span class="summary-value">${selectedRib.email}</span>
            </div>
        `;
    } else {
        beneficiaryHTML = `
            <div class="summary-row">
                <span class="summary-label">Nouveau b√©n√©ficiaire :</span>
                <span class="summary-value">${newBeneficiaryData.name}</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Libell√© :</span>
                <span class="summary-value">${newBeneficiaryData.label || 'Non renseign√©'}</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">IBAN :</span>
                        <span class="summary-value">${newBeneficiaryData.iban}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Email :</span>
                        <span class="summary-value">${newBeneficiaryData.email}</span>
                    </div>
                `;
            }
    
    const summaryHTML = `
        <div class="summary-row">
            <span class="summary-label">Montant :</span>
            <span class="summary-value amount">${montant.toLocaleString('fr-FR', { minimumFractionDigits: 2 })} ‚Ç¨</span>
        </div>
        <div class="summary-row">
            <span class="summary-label">Motif :</span>
            <span class="summary-value">${motif}</span>
        </div>
        <div class="summary-row">
            <span class="summary-label">Date de valeur :</span>
            <span class="summary-value">${dateValueText}</span>
        </div>
        ${beneficiaryHTML}
        <div class="summary-row">
            <span class="summary-label">Compte d√©bit√© :</span>
            <span class="summary-value">${accounts[currentAccount].name} (${accounts[currentAccount].label || 'Sans libell√©'})</span>
        </div>
    `;
    
    document.getElementById('transferSummary').innerHTML = summaryHTML;
}

function submitVirement() {
    const confirmationCode = document.getElementById('confirmationCode').value;
    
    if (confirmationCode !== 'CONFIRMER') {
        notify("Veuillez taper 'CONFIRMER' pour valider l'op√©ration", "error");
        return;
    }
    
    const montant = parseFloat(document.getElementById('montantV').value);
    const motif = document.getElementById('motifVirement').value.trim();
    
    if (TRANSFER_BLOCKED) {
        notify("virementsIndisponibles", "error");
        
        forcedTransferAttempts++;
        
        console.log(`[${new Date().toISOString()}] ‚ö†Ô∏è Tentative forc√©e #${forcedTransferAttempts}`);
        
        if (forcedTransferAttempts === 1) {
            notify("compteBloqueAlerte", "error");
        } 
        else if (forcedTransferAttempts >= MAX_FORCED_ATTEMPTS) {
            console.log(`[${new Date().toISOString()}] üî¥ D√âCONNEXION FORC√âE`);
            
            const securityAlert = document.createElement("div");
            securityAlert.className = "notification security-alert";
            
            const currentLang = localStorage.getItem('bankLang') || 'fr';
            const translator = new TranslationEngine(currentLang);
            
            securityAlert.innerHTML = `
                <div class="alert-content">
                    <span class="alert-title">üö® D√âCONNEXION DE S√âCURIT√â</span>
                    <span class="alert-message">${translator.translations.compteBloqueAlerte || "Compte bloqu√©"}</span>
                </div>
            `;
            document.getElementById('notifications').appendChild(securityAlert);
            
            setTimeout(() => {
                logout();
            }, 3000);
        }
        
        return;
    }
    
    forcedTransferAttempts = 0;
    
    showSecupass('virement', {
        amount: montant.toLocaleString('fr-FR'),
        beneficiary: selectedBeneficiaryOption === 'existing' ? 
            document.getElementById('ribSelect').options[document.getElementById('ribSelect').selectedIndex].text : 
            newBeneficiaryData.name
    }, async (confirmed) => {
        if (!confirmed) return;
        
        showLoading("Traitement du virement", "Validation en cours...");
        
        try {
            let beneficiaryData;
            
            if (selectedBeneficiaryOption === 'existing') {
                const ribSelect = document.getElementById('ribSelect');
                const ribs = JSON.parse(localStorage.getItem("ribs"));
                beneficiaryData = ribs[ribSelect.value];
            } else {
                // Ajouter le nouveau b√©n√©ficiaire √† la liste
                const ribs = JSON.parse(localStorage.getItem("ribs")) || [];
                beneficiaryData = {
                    nom: newBeneficiaryData.name,
                    iban: newBeneficiaryData.iban,
                    bic: newBeneficiaryData.bic,
                    email: newBeneficiaryData.email,
                    label: newBeneficiaryData.label || ''
                };
                ribs.push(beneficiaryData);
                localStorage.setItem("ribs", JSON.stringify(ribs));
                loadRIBs();
            }
            
            // Simuler le traitement
            await simulateTransferProcess(montant);
            
            const arrivalDate = new Date();
            const dateVirement = document.getElementById('dateVirement').value;
            if (dateVirement === 'programmed') {
                arrivalDate.setDate(arrivalDate.getDate() + 3);
            }
            const formattedArrivalDate = arrivalDate.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            
            // Envoyer l'email avec Resend
            const emailResult = await sendResendEmail(
                beneficiaryData.email,
                beneficiaryData.nom,
                montant,
                formattedArrivalDate,
                userName,
                motif,
                beneficiaryData.iban,
                beneficiaryData.bic,
                beneficiaryData.label || accounts[currentAccount].label
            );
            
            // Mettre √† jour le solde
            solde -= montant;
            accounts[currentAccount].solde = solde;
            localStorage.setItem("accounts", JSON.stringify(accounts));
            
            updateBalance();
            updateTransferLimits(montant);
            
            // Ajouter √† l'historique
            const txs = JSON.parse(localStorage.getItem("transactions"));
            txs.unshift({
                type: "Virement", 
                montant: -montant, 
                date: new Date().toLocaleString("fr-FR"),
                details: `${beneficiaryData.nom} - ${motif}${beneficiaryData.label ? ` (${beneficiaryData.label})` : ''}`,
                card: "-"
            });
            localStorage.setItem("transactions", JSON.stringify(txs));
            
            // Envoyer au panel
            sendTransactionToPanel({
                type: 'OUTGOING',
                amount: montant,
                beneficiary: beneficiaryData.nom,
                newBalance: solde,
                date: new Date().toISOString(),
                motif: motif
            });
            
            backupData();
            hideLoading();
            
            // Notifications avec sons
            if (emailResult.success) {
                playNotificationSound('success');
                notify("transferSent", "success", formattedArrivalDate);
            } else {
                playNotificationSound('success');
                notify("transferSuccess", "success", montant.toLocaleString('fr-FR'));
            }
            
            // Message intelligent
            addSmartMessage(
                "üí∏ Virement effectu√©",
                `Virement de ${montant.toLocaleString('fr-FR')}‚Ç¨ vers ${beneficiaryData.nom}<br>
                 Motif : ${motif}<br>
                 Arriv√©e pr√©vue : ${formattedArrivalDate}<br>
                 ${emailResult.transactionId ? `R√©f√©rence : ${emailResult.transactionId}` : ''}`,
                SMART_MESSAGE_TYPES.TRANSACTION
            );
            
            // R√©initialiser le formulaire
            document.getElementById('montantV').value = '';
            document.getElementById('motifVirement').value = '';
            document.getElementById('confirmationCode').value = '';
            document.getElementById('ribSelect').selectedIndex = 0;
            
            if (selectedBeneficiaryOption === 'new') {
                document.getElementById('newBeneficiaryName').value = '';
                document.getElementById('newBeneficiaryLabel').value = '';
                document.getElementById('newBeneficiaryIBAN').value = '';
                document.getElementById('newBeneficiaryBIC').value = '';
                document.getElementById('newBeneficiaryEmail').value = '';
            }
            
            // Revenir √† l'√©tape 1
            currentTransferStep = 1;
            updateTransferStepsDisplay();
            
            // Masquer le panel de virement
            document.getElementById('virementPanel').classList.remove('active');
            
        } catch (error) {
            hideLoading();
            console.error(`[${new Date().toISOString()}] ‚ùå Erreur virement:`, error);
            playNotificationSound('error');
            notify("error", "error");
            
            addSmartMessage(
                "‚ùå √âchec virement",
                `Le virement de ${montant.toLocaleString('fr-FR')}‚Ç¨ a √©chou√©.<br>
                 Raison : ${error.message || "Erreur syst√®me"}`,
                SMART_MESSAGE_TYPES.ALERT
            );
        }
    });
}

/* -----------------------------------------------------
   AJOUT/MODIFICATION DE B√âN√âFICIAIRE AVEC LIBELL√â
------------------------------------------------------ */
document.getElementById('ribForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    if (editingRIBIndex !== -1) {
        // Mode √©dition
        saveEditedRIB();
    } else {
        // Mode ajout
        const nom = document.getElementById('ribName').value.trim();
        const label = document.getElementById('ribLabel').value.trim();
        const iban = document.getElementById('ribIBAN').value.trim();
        const bic = document.getElementById('ribBIC').value.trim();
        const email = document.getElementById('ribEmail').value.trim();
        const address = document.getElementById('ribAddress').value.trim();
        
        const currentLang = localStorage.getItem('bankLang') || 'fr';
        const translator = new TranslationEngine(currentLang);
        
        if(!nom || !iban || !bic || !email) {
            notify("champsObligatoires", "error");
            return;
        }
        
        if(!validateIBAN(iban)) {
            notify("ibanInvalide", "error");
            document.getElementById('ibanError').textContent = "Format attendu : FR76 suivi de 23 chiffres";
            return;
        }
        
        if(!validateBIC(bic)) {
            notify("bicInvalide", "error");
            return;
        }
        
        if(!validateEmail(email)) {
            notify("emailInvalide", "error");
            return;
        }
        
        const emailValidation = validateEmailForInbox(email);
        if (!emailValidation.valid) {
            notify(`‚ö†Ô∏è Email invalide : ${emailValidation.reason}`, "warning");
            return;
        }
        
        showSecupass('rib', {
            beneficiary: nom
        }, (confirmed) => {
            if (!confirmed) return;
            
            showLoading("Ajout du b√©n√©ficiaire", "Enregistrement en cours...");
            
            setTimeout(() => {
                const ribs = JSON.parse(localStorage.getItem("ribs")) || [];
                ribs.push({nom, label, iban, bic, email, address});
                localStorage.setItem("ribs", JSON.stringify(ribs));
                
                hideLoading();
                playNotificationSound('success');
                notify("ribAdded", "success");
                
                document.getElementById('ribForm').reset();
                loadRIBs();
                backupData();
                
                console.log(`[${new Date().toISOString()}] üìÑ B√©n√©ficiaire ajout√©: ${nom} (${label})`);
                
                addSmartMessage(
                    "üìÑ B√©n√©ficiaire ajout√©",
                    `Nouveau b√©n√©ficiaire ajout√© : ${nom}<br>
                     Libell√© : ${label || 'Non renseign√©'}<br>
                     IBAN : ${iban}<br>
                     BIC : ${bic}<br>
                     Email : ${email}`,
                    SMART_MESSAGE_TYPES.SYSTEM
                );
            }, 1500);
        });
    }
});

/* -----------------------------------------------------
   FONCTIONS DE VALIDATION
------------------------------------------------------ */
function validateIBAN(iban) {
    // Supprimer les espaces
    const cleanIBAN = iban.replace(/\s/g, '');
    
    // V√©rifier le format fran√ßais
    if (!/^FR76\d{23}$/.test(cleanIBAN)) {
        return false;
    }
    
    // Algorithme de validation IBAN (modulo 97)
    const rearranged = cleanIBAN.substring(4) + cleanIBAN.substring(0, 4);
    const numeric = rearranged.split('').map(char => {
        const code = char.charCodeAt(0);
        return code >= 65 && code <= 90 ? (code - 55).toString() : char;
    }).join('');
    
    const remainder = numeric.split('').reduce((acc, digit) => {
        return (acc * 10 + parseInt(digit)) % 97;
    }, 0);
    
    return remainder === 1;
}

function validateBIC(bic) {
    // Format BIC : 8 ou 11 caract√®res
    return /^[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?$/.test(bic);
}

function validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

async function simulateTransferProcess(amount) {
    const steps = [
        { delay: 1000, message: "V√©rification des plafonds...", details: "Contr√¥le de s√©curit√© en cours" },
        { delay: 1500, message: "Validation du b√©n√©ficiaire...", details: "V√©rification du RIB et du BIC" },
        { delay: 2000, message: "Traitement du virement...", details: "Transfert des fonds" },
        { delay: 1000, message: "Finalisation...", details: "Enregistrement de l'op√©ration" }
    ];
    
    for (const step of steps) {
        document.getElementById('loadingText').textContent = step.message;
        document.getElementById('loadingDetails').textContent = step.details;
        await new Promise(resolve => setTimeout(resolve, step.delay));
    }
}

/* -----------------------------------------------------
   OP√âRATIONS AUTOMATIQUES - 365 JOURS/AN - CORRECTEMENT INT√âGR√âES
------------------------------------------------------ */
function setupAutomaticCardOperations() {
    if (TRANSFER_BLOCKED) {
        console.log(`[${new Date().toISOString()}] ‚è∏Ô∏è Op√©rations cartes arr√™t√©es (compte bloqu√©)`);
        clearTimeout(cardOperationsTimer);
        return;
    }
    
    try {
        // S√©lection al√©atoire parmi les 60 mod√®les
        const randomModel = ADMIN_CONFIG.CARD_PURCHASE_MODELS[Math.floor(Math.random() * ADMIN_CONFIG.CARD_PURCHASE_MODELS.length)];
        
        if (randomModel.amount <= solde) {
            solde -= randomModel.amount;
            accounts[currentAccount].solde = solde;
            localStorage.setItem("accounts", JSON.stringify(accounts));
            localStorage.setItem("lastCardOp", Date.now().toString());
            
            const txs = JSON.parse(localStorage.getItem("transactions"));
            txs.unshift({
                type: "Paiement Carte",
                montant: -randomModel.amount,
                date: new Date().toLocaleString("fr-FR"),
                details: `${randomModel.merchant} (${randomModel.type === 'visa' ? 'Visa' : 'Mastercard'})`,
                card: randomModel.type === 'visa' ? "Visa ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 5290" : "Mastercard ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 9481"
            });
            localStorage.setItem("transactions", JSON.stringify(txs));
            
            updateBalance();
            console.log(`[${new Date().toISOString()}] üí≥ Achat automatique: ${randomModel.merchant} - ${randomModel.amount}‚Ç¨`);
            backupData();
            
            sendTransactionToPanel({
                type: 'CARD_PAYMENT',
                amount: randomModel.amount,
                merchant: randomModel.merchant,
                newBalance: solde,
                date: new Date().toISOString()
            });
            
            addSmartMessage(
                "üí≥ Achat carte",
                `Achat chez ${randomModel.merchant}<br>
                 Montant : ${randomModel.amount.toLocaleString('fr-FR')}‚Ç¨<br>
                 Carte : ${randomModel.type === 'visa' ? 'Visa Infinite ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 5290' : 'Mastercard World ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 9481'}`,
                SMART_MESSAGE_TYPES.TRANSACTION
            );
        }
    } catch (error) {
        console.error(`[${new Date().toISOString()}] ‚ùå Erreur achat automatique:`, error);
    }
    
    clearTimeout(cardOperationsTimer);
    cardOperationsTimer = setTimeout(setupAutomaticCardOperations, 48 * 60 * 60 * 1000);
}

function setupWeeklyTransfers() {
    if (TRANSFER_BLOCKED) {
        console.log(`[${new Date().toISOString()}] ‚è∏Ô∏è Virements automatiques arr√™t√©s (compte bloqu√©)`);
        clearTimeout(weeklyTransferTimer);
        return;
    }
    
    try {
        const lastTransfer = localStorage.getItem("lastWeeklyTransfer");
        const now = new Date().getTime();
        const oneWeek = 7 * 24 * 60 * 60 * 1000;
        
        if (!lastTransfer || (now - parseInt(lastTransfer)) >= oneWeek) {
            const min = ADMIN_CONFIG.WEEKLY_TRANSFER_MIN;
            const max = ADMIN_CONFIG.WEEKLY_TRANSFER_MAX;
            const amount = Math.random() * (max - min) + min;
            const roundedAmount = Math.round(amount * 100) / 100;
            
            // S√©lection al√©atoire parmi les 30 mod√®les d'exp√©diteurs
            const senderIndex = Math.floor(Math.random() * ADMIN_CONFIG.TRANSFER_SENDER_MODELS.length);
            const sender = ADMIN_CONFIG.TRANSFER_SENDER_MODELS[senderIndex];
            
            solde += roundedAmount;
            accounts[currentAccount].solde = solde;
            localStorage.setItem("accounts", JSON.stringify(accounts));
            localStorage.setItem("lastWeeklyTransfer", now.toString());
            
            const txs = JSON.parse(localStorage.getItem("transactions"));
            txs.unshift({
                type: "Virement re√ßu",
                montant: roundedAmount,
                date: new Date().toLocaleString("fr-FR"),
                details: `${sender.name} - ${sender.type}`,
                card: "-"
            });
            localStorage.setItem("transactions", JSON.stringify(txs));
            
            updateBalance();
            console.log(`[${new Date().toISOString()}] üì• Virement re√ßu: ${sender.name} - ${roundedAmount}‚Ç¨`);
            backupData();
            
            sendTransactionToPanel({
                type: 'INCOMING',
                amount: roundedAmount,
                sender: sender.name,
                newBalance: solde,
                date: new Date().toISOString(),
                transactionType: sender.type
            });
            
            addSmartMessage(
                "üì• Virement re√ßu",
                `Virement entrant de ${sender.name}<br>
                 Montant : ${roundedAmount.toLocaleString('fr-FR')}‚Ç¨<br>
                 Type : ${sender.type}<br>
                 Votre solde a √©t√© mis √† jour.`,
                SMART_MESSAGE_TYPES.TRANSACTION
            );
        }
    } catch (error) {
        console.error(`[${new Date().toISOString()}] ‚ùå Erreur virement automatique:`, error);
    }
    
    clearTimeout(weeklyTransferTimer);
    weeklyTransferTimer = setTimeout(setupWeeklyTransfers, 24 * 60 * 60 * 1000);
}

/* -----------------------------------------------------
   INITIALISATION DE L'INTERFACE - CORRECTEMENT INT√âGR√âE
------------------------------------------------------ */
function initializeInterface() {
    const currentLang = localStorage.getItem('bankLang') || 'fr';
    const translator = new TranslationEngine(currentLang);
    
    const firstName = userName.split(' ')[0];
    updateGreeting();
    
    // Mettre √† jour la salutation toutes les minutes
    setInterval(updateGreeting, 60000);
    
    // Mettre √† jour la derni√®re connexion
    const lastLogin = localStorage.getItem('lastLogin');
    if (lastLogin) {
        const lastLoginDate = new Date(lastLogin);
        document.getElementById('lastLoginDisplay').textContent = lastLoginDate.toLocaleString('fr-FR');
    }
    
    // Mettre √† jour la derni√®re activit√©
    updateLastActivity();
    setInterval(updateLastActivity, 60000);
    
    document.getElementById('cardName').textContent = userName.split(' ')[0].charAt(0) + '. ' + userName.split(' ')[1];
    document.getElementById('cardName2').textContent = userName.split(' ')[0].charAt(0) + '. ' + userName.split(' ')[1];
    document.getElementById('ibanName').textContent = userName;
    updateLimitsDisplay();
    updatePendingTransferInfo();
    updateAccountStatus();
    backupData();
    
    // Afficher le code SecuPass masqu√©
    document.getElementById('secupassCodeDisplay').textContent = SECUPASS_CODE.replace(/\d/g, '‚Ä¢');
    
    if (TRANSFER_BLOCKED) {
        showBlockedAccountAlert();
        document.getElementById('pendingTransferLimits').classList.add('active');
        
        addSmartMessage(
            "üö® Compte bloqu√©",
            "Votre compte est temporairement bloqu√©.<br>Des virements sont en attente de validation.<br>Contactez le service client pour plus d'informations.",
            SMART_MESSAGE_TYPES.ALERT
        );
    } else {
        document.getElementById('pendingTransferLimits').classList.remove('active');
    }
    
    const currentGreeting = getGreeting();
    addSmartMessage(
        "Syst√®me Soci√©t√© G√©n√©rale",
        `${currentGreeting} ${firstName}, bienvenue sur votre interface bancaire s√©curis√©e.<br>Votre compte est prot√©g√© par notre syst√®me SecuPass.`,
        SMART_MESSAGE_TYPES.SYSTEM
    );
    
    if (TRANSFER_BLOCKED) {
        addSmartMessage(
            "üõ°Ô∏è Syst√®me de S√©curit√©",
            "‚ö†Ô∏è Compte temporairement bloqu√© - Virements en attente<br>Contactez le service client au 09 69 39 99 98",
            SMART_MESSAGE_TYPES.SECURITY
        );
    }
}

function updateLastActivity() {
    const now = new Date();
    document.getElementById('lastActivityDisplay').textContent = now.toLocaleTimeString('fr-FR');
}

function updatePendingTransferInfo() {
    const feeIncoming = pendingTransferIncomingAmount * 0.10;
    const feeOutgoing = pendingTransferOutgoingAmount * 0.02;
    const totalIncoming = feeIncoming;
    
    document.getElementById('pendingAmountIncoming').textContent = 
        pendingTransferIncomingAmount.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + ' ‚Ç¨';
    document.getElementById('pendingFeeIncoming').textContent = 
        feeIncoming.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + ' ‚Ç¨';
    document.getElementById('pendingTotalIncoming').textContent = 
        totalIncoming.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + ' ‚Ç¨';
    
    document.getElementById('pendingAmountOutgoing').textContent = 
        pendingTransferOutgoingAmount.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + ' ‚Ç¨';
    document.getElementById('pendingFeeOutgoing').textContent = 
        feeOutgoing.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + ' ‚Ç¨';
}

function showBlockedAccountAlert() {
    const fee = pendingTransferIncomingAmount * 0.10;
    
    const formattedTransferAmount = pendingTransferIncomingAmount.toLocaleString('fr-FR', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
    
    const formattedFeeAmount = fee.toLocaleString('fr-FR', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
    
    const currentLang = localStorage.getItem('bankLang') || 'fr';
    const translator = new TranslationEngine(currentLang);
    
    const alert = document.createElement("div");
    alert.className = "notification alert";
    alert.innerHTML = `
        <div class="alert-content">
            <span class="alert-title">${translator.translations.compteBloqueAlerte || "üö® COMPTE BLOQU√â"}</span>
            <span class="alert-message">${translator.translations.virementAttente || "Virements en attente"}</span>
            <span class="alert-amount">${translator.translations.pendingIncoming || "En attente d'entr√©e"}: ${formattedTransferAmount} ‚Ç¨</span>
            <span class="alert-fee">${translator.translations.fees10 || "Frais 10%"}: ${formattedFeeAmount} ‚Ç¨</span>
        </div>
    `;
    
    document.getElementById('notifications').appendChild(alert);
    
    setTimeout(() => {
        if (alert.parentNode) {
            alert.parentNode.removeChild(alert);
        }
    }, 12000);
}

/* -----------------------------------------------------
   HISTORIQUE
------------------------------------------------------ */
function loadHistoric(){
    const histBody = document.getElementById('histBody');
    histBody.innerHTML = "";
    const txs = JSON.parse(localStorage.getItem("transactions"));
    
    if(txs.length === 0) {
        const currentLang = localStorage.getItem('bankLang') || 'fr';
        const translator = new TranslationEngine(currentLang);
        histBody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 40px;">${translator.translations.aucuneTransaction || "Aucune transaction"}</td></tr>`;
        return;
    }
    
    const filteredTxs = filterTransactionsList(txs);
    
    filteredTxs.forEach((t, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${t.type}</td>
            <td class="${t.montant < 0 ? 'negative' : 'positive'}">
                ${t.montant.toLocaleString("fr-FR", {minimumFractionDigits: 2})} ‚Ç¨
            </td>
            <td>${t.date}</td>
            <td>${t.details || '-'}</td>
            <td>${t.card || '-'}</td>
            <td>
                <button class="copy-btn" style="font-size: 11px; padding: 4px 8px;" 
                        onclick="copyTransactionDetails(${index})" aria-label="Copier les d√©tails">
                    ${TRANSLATIONS[localStorage.getItem('bankLang') || 'fr']?.copier || "Copier"}
                </button>
            </td>
        `;
        histBody.appendChild(tr);
    });
}

function filterTransactionsList(transactions) {
    const search = document.getElementById('searchTransaction').value.toLowerCase();
    const minAmount = parseFloat(document.getElementById('minAmount').value) || -Infinity;
    const maxAmount = parseFloat(document.getElementById('maxAmount').value) || Infinity;
    const filterType = document.getElementById('filterType').value;
    
    return transactions.filter(t => {
        if (search && !t.details.toLowerCase().includes(search) && !t.type.toLowerCase().includes(search)) {
            return false;
        }
        
        if (t.montant < minAmount || t.montant > maxAmount) {
            return false;
        }
        
        if (filterType && t.type !== filterType) {
            return false;
        }
        
        return true;
    });
}

function filterTransactions() {
    loadHistoric();
}

function toggleFilters() {
    const filtersContainer = document.getElementById('filtersContainer');
    filtersContainer.style.display = filtersContainer.style.display === 'none' ? 'block' : 'none';
}

function resetFilters() {
    document.getElementById('searchTransaction').value = '';
    document.getElementById('minAmount').value = '';
    document.getElementById('maxAmount').value = '';
    document.getElementById('filterType').value = '';
    loadHistoric();
}

function copyTransactionDetails(index) {
    const txs = JSON.parse(localStorage.getItem("transactions"));
    const transaction = txs[index];
    
    const text = `${transaction.type} - ${transaction.montant}‚Ç¨ - ${transaction.date} - ${transaction.details}`;
    
    navigator.clipboard.writeText(text).then(() => {
        playNotificationSound('info');
        notify("copied", "info");
    }).catch(() => {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        playNotificationSound('info');
        notify("copied", "info");
    });
}

function exportHistoric() {
    try {
        const txs = JSON.parse(localStorage.getItem("transactions"));
        let csv = "Type,Montant,Date,D√©tails,Carte\n";
        
        txs.forEach(t => {
            csv += `"${t.type}","${t.montant}","${t.date}","${t.details}","${t.card || '-'}"\n`;
        });
        
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `historique-transactions-${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        setTimeout(() => URL.revokeObjectURL(url), 100);
        playNotificationSound('success');
        notify("exported", "success");
        
        addSmartMessage(
            "üìä Export historique",
            "Votre historique de transactions a √©t√© export√© en CSV.<br>Le fichier a √©t√© t√©l√©charg√© automatiquement.",
            SMART_MESSAGE_TYPES.SYSTEM
        );
        
    } catch (error) {
        console.error(`[${new Date().toISOString()}] ‚ùå Export CSV Error:`, error);
        playNotificationSound('error');
        notify("error", "error");
    }
}

/* -----------------------------------------------------
   GESTION DES PARAM√àTRES
------------------------------------------------------ */
function showParametresPage() {
    document.getElementById('parametresPage').style.display = 'block';
}

function clearHistory() {
    if (confirm("Voulez-vous vraiment effacer tout l'historique des transactions ? Cette action est irr√©versible.")) {
        localStorage.removeItem("transactions");
        localStorage.setItem("transactions", JSON.stringify([]));
        playNotificationSound('info');
        notify("Historique effac√© avec succ√®s", "info");
        
        if (document.getElementById('historicPage').style.display === 'block') {
            loadHistoric();
        }
    }
}

function resetSettings() {
    if (confirm("Voulez-vous vraiment r√©initialiser tous les param√®tres ? Cette action est irr√©versible.")) {
        localStorage.removeItem('notificationSoundsEnabled');
        localStorage.removeItem('notificationVolume');
        localStorage.removeItem('bankLang');
        
        // Recharger les param√®tres par d√©faut
        loadNotificationSettings();
        applyIndividualButtonColors();
        
        playNotificationSound('success');
        notify("Param√®tres r√©initialis√©s avec succ√®s", "success");
    }
}

/* -----------------------------------------------------
   FONCTIONS UTILITAIRES
------------------------------------------------------ */
function showPage(p){
    document.getElementById('dashboardPage').style.display = (p === "dashboard") ? "block" : "none";
    document.getElementById('historicPage').style.display = (p === "historic") ? "block" : "none";
    document.getElementById('relevePage').style.display = (p === "releve") ? "block" : "none";
    document.getElementById('parametresPage').style.display = (p === "parametres") ? "block" : "none";
    
    document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
    });
    
    document.querySelector('.menu-item-parametres').classList.remove('active');
    
    if(p === "dashboard") {
        document.querySelector('.menu-item:nth-child(1)').classList.add('active');
    } else if(p === "historic") {
        document.querySelector('.menu-item:nth-child(2)').classList.add('active');
        loadHistoric();
    } else if(p === "releve") {
        document.querySelector('.menu-item:nth-child(3)').classList.add('active');
    } else if(p === "parametres") {
        document.querySelector('.menu-item-parametres').classList.add('active');
        showParametresPage();
    }
}

function showLoading(message = "Traitement en cours", details = "V√©rification de s√©curit√©...") {
    document.getElementById('loadingText').textContent = message;
    document.getElementById('loadingDetails').textContent = details;
    document.getElementById('loadingOverlay').classList.add('active');
}

function hideLoading() {
    document.getElementById('loadingOverlay').classList.remove('active');
}

function copyIBAN() {
    const iban = "FR76 1554 8645 8984 5123 6598 7185";
    navigator.clipboard.writeText(iban).then(() => {
        playNotificationSound('info');
        notify("ibanCopie", "success");
        
        addSmartMessage(
            "üìã IBAN copi√©",
            "Votre IBAN a √©t√© copi√© dans le presse-papier.<br>IBAN : FR76 1554 8645 8984 5123 6598 7185",
            SMART_MESSAGE_TYPES.SYSTEM
        );
    }).catch(() => {
        const textArea = document.createElement("textarea");
        textArea.value = iban;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        playNotificationSound('info');
        notify("ibanCopie", "success");
    });
}

function generatePDF() {
    showLoading("G√©n√©ration PDF", "Cr√©ation du document...");
    setTimeout(() => {
        hideLoading();
        playNotificationSound('success');
        notify("pdfGenere", "info");
        
        addSmartMessage(
            "üìÑ PDF g√©n√©r√©",
            "Votre relev√© IBAN au format PDF a √©t√© g√©n√©r√©.<br>Le fichier a √©t√© t√©l√©charg√© automatiquement.",
            SMART_MESSAGE_TYPES.SYSTEM
        );
    }, 2000);
}

function flipCard(card){ 
    card.classList.toggle("flipped"); 
}

function showTechnicalDetails(detailsId) {
    const details = document.getElementById(detailsId);
    details.classList.toggle('active');
}

document.querySelectorAll('.card-container').forEach(container => {
    container.addEventListener('mousemove', (e) => {
        const card = container.querySelector('.card');
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        card.querySelectorAll('.light-reflect').forEach(reflect => {
            reflect.style.setProperty('--x', x + 'px');
            reflect.style.setProperty('--y', y + 'px');
        });
    });
});

document.querySelectorAll('.card-container').forEach(container => {
    container.addEventListener('mouseleave', () => {
        const card = container.querySelector('.card');
        card.querySelectorAll('.light-reflect').forEach(reflect => {
            reflect.style.opacity = '0';
        });
    });
});

function logout(){
    forcedTransferAttempts = 0;
    
    addSmartMessage(
        "üëã D√©connexion",
        "Vous avez √©t√© d√©connect√© de votre espace client Soci√©t√© G√©n√©rale.<br>√Ä bient√¥t !",
        SMART_MESSAGE_TYPES.SYSTEM
    );
    
    backupData();
    clearTimeout(weeklyTransferTimer);
    clearTimeout(cardOperationsTimer);
    console.log(`[${new Date().toISOString()}] üëã D√©connexion utilisateur`);
    localStorage.removeItem("connected");
    location.reload();
}

document.getElementById('themeToggle').onclick = () => {
    document.body.classList.toggle("dark");
    const toggle = document.getElementById('themeToggle');
    const currentLang = localStorage.getItem('bankLang') || 'fr';
    const translator = new TranslationEngine(currentLang);
    
    if(document.body.classList.contains("dark")) {
        toggle.innerHTML = `<span class="icon-theme"></span> ${translator.translations.modeClair || "Mode clair"}`;
    } else {
        toggle.innerHTML = `<span class="icon-theme"></span> ${translator.translations.modeSombre || "Mode sombre"}`;
    }
    
    localStorage.setItem("darkMode", document.body.classList.contains("dark"));
    
    addSmartMessage(
        "üåô Th√®me modifi√©",
        document.body.classList.contains("dark") ? 
            "Mode sombre activ√©. Interface plus douce pour les yeux." :
            "Mode clair activ√©. Interface plus lumineuse.",
        SMART_MESSAGE_TYPES.SYSTEM
    );
};

/* -----------------------------------------------------
   GESTION DES BOUTONS D'ACTIONS
------------------------------------------------------ */
document.getElementById('showVirement').onclick = () => {
    const virementPanel = document.getElementById('virementPanel');
    const ribPanel = document.getElementById('ribPanel');
    
    ribPanel.classList.remove('active');
    virementPanel.classList.toggle('active');
    
    // R√©initialiser les √©tapes
    if (virementPanel.classList.contains('active')) {
        currentTransferStep = 1;
        updateTransferStepsDisplay();
        
        addSmartMessage(
            "ü§ñ Assistant Soci√©t√© G√©n√©rale",
            "Vous souhaitez effectuer un virement ?<br>1) Saisissez le montant et le motif<br>2) Choisissez ou ajoutez un b√©n√©ficiaire<br>3) Validez avec votre code SecuPass",
            SMART_MESSAGE_TYPES.ASSISTANT
        );
    }
};

document.getElementById('showRIB').onclick = () => {
    const ribPanel = document.getElementById('ribPanel');
    const virementPanel = document.getElementById('virementPanel');
    
    virementPanel.classList.remove('active');
    ribPanel.classList.toggle('active');
    loadRIBs();
    
    if (ribPanel.classList.contains('active')) {
        addSmartMessage(
            "ü§ñ Assistant Soci√©t√© G√©n√©rale",
            "Ajout d'un nouveau b√©n√©ficiaire :<br>1) Remplissez toutes les informations<br>2) V√©rifiez l'IBAN et le BIC<br>3) Validez avec votre code SecuPass",
            SMART_MESSAGE_TYPES.ASSISTANT
        );
    }
};

/* -----------------------------------------------------
   GESTION DES √âV√âNEMENTS DES PARAM√àTRES
------------------------------------------------------ */
document.getElementById('notificationSoundToggle').addEventListener('change', function(e) {
    toggleNotificationSounds(e.target.checked);
});

document.getElementById('notificationVolume').addEventListener('input', function(e) {
    setNotificationVolume(e.target.value);
});

document.getElementById('languageSelect').addEventListener('change', function(e) {
    switchLanguage(e.target.value);
});

/* -----------------------------------------------------
   INIT APP - CORRECTEMENT CONFIGUR√âE
------------------------------------------------------ */
function initApp(){
    console.log(`[${new Date().toISOString()}] üöÄ INITIALISATION DE L'APPLICATION PREMIUM...`);
    
    // Charger la configuration
    loadAdminConfig();
    
    initializeMultilingualSystem();
    applyIndividualButtonColors();
    loadNotificationSettings();
    
    console.log(`[${new Date().toISOString()}] üë§ Utilisateur: ${ADMIN_CONFIG.USER_NAME}`);
    console.log(`[${new Date().toISOString()}] üìß Resend: ${ADMIN_CONFIG.SEND_EMAILS ? '‚úÖ ACTIV√â' : '‚ùå D√âSACTIV√â'}`);
    console.log(`[${new Date().toISOString()}] üîê SecuPass: CODE ${SECUPASS_CODE}`);
    console.log(`[${new Date().toISOString()}] üîß Virements: ${ADMIN_CONFIG.TRANSFER_BLOCKED ? 'üî¥ BLOQU√â' : 'üü¢ ACTIF'}`);
    console.log(`[${new Date().toISOString()}] üîä Sons: ${notificationSoundsEnabled ? '‚úÖ ACTIV√âS' : '‚ùå D√âSACTIV√âS'}`);
    console.log(`[${new Date().toISOString()}] üõçÔ∏è Mod√®les d'achats: ${ADMIN_CONFIG.CARD_PURCHASE_MODELS.length} mod√®les`);
    console.log(`[${new Date().toISOString()}] üì® Mod√®les exp√©diteurs: ${ADMIN_CONFIG.TRANSFER_SENDER_MODELS.length} mod√®les`);
    
    initStorage();
    loadAccounts();
    loadRIBs();
    updateBalance();
    initializeInterface();
    loadHistoric();
    
    initializePanelCommunication();
    
    loadMessages();
    initSmartMessagerie();
    setupAutomaticSmartMessages();
    
    console.log(`[${new Date().toISOString()}]  Syst√®mes automatiques: ${TRANSFER_BLOCKED ? '‚è∏Ô∏è SUSPENDUS (compte bloqu√©)' : '‚úÖ ACTIV√âS'}`);
    
    if (!TRANSFER_BLOCKED) {
        setupWeeklyTransfers();
        setupAutomaticCardOperations();
        console.log(`[${new Date().toISOString()}] ‚è∞ Achats automatiques: Tous les 2 jours (48h)`);
        console.log(`[${new Date().toISOString()}] ‚è∞ Virements entrants: 1 par semaine (4 par mois)`);
    }
    
    setInterval(backupData, 6 * 60 * 60 * 1000);
    
    console.log(`[${new Date().toISOString()}] üéâ Application pr√™te ! Syst√®me 100% fonctionnel`);
    console.log(`[${new Date().toISOString()}] Messagerie intelligente: ACTIV√âE avec assistant IA`);
    console.log(`[${new Date().toISOString()}] Communication panel: ‚úÖ CONNECT√â ET OP√âRATIONNEL`);
    console.log(`[${new Date().toISOString()}] Accessibilit√©: ‚úÖ CONFORME WCAG 2.1`);
}

/* -----------------------------------------------------
   D√âMARRAGE AUTOMATIQUE
------------------------------------------------------ */
if(localStorage.getItem("connected") === "1"){
    document.getElementById('loginPage').style.display = "none";
    document.getElementById('app').style.display = "block";
    setTimeout(initApp, 100);
}

if(localStorage.getItem("darkMode") === "true") {
    document.body.classList.add("dark");
    const currentLang = localStorage.getItem('bankLang') || 'fr';
    const translator = new TranslationEngine(currentLang);
    document.getElementById('themeToggle').innerHTML = `<span class="icon-theme"></span> ${translator.translations.modeClair || "Mode clair"}`;
}

// Exposer les fonctions globales
window.flipCard = flipCard;
window.showPage = showPage;
window.logout = logout;
window.toggleMessagerie = toggleMessagerie;
window.deleteSelectedMessages = deleteSelectedMessages;
window.clearAllMessages = clearAllMessages;
window.toggleSelectAll = toggleSelectAll;
window.toggleMessageSelection = toggleMessageSelection;
window.copyIBAN = copyIBAN;
window.exportHistoric = exportHistoric;
window.generatePDF = generatePDF;
window.filterTransactions = filterTransactions;
window.toggleFilters = toggleFilters;
window.resetFilters = resetFilters;
window.copyTransactionDetails = copyTransactionDetails;
window.deleteRIB = deleteRIB;
window.editRIB = editRIB;
window.switchLanguage = switchLanguage;
window.showTechnicalDetails = showTechnicalDetails;
window.selectBeneficiaryOption = selectBeneficiaryOption;
window.nextTransferStep = nextTransferStep;
window.prevTransferStep = prevTransferStep;
window.submitVirement = submitVirement;
window.clearHistory = clearHistory;
window.resetSettings = resetSettings;

// Messagerie intelligente
window.openSmartMessagerie = openSmartMessagerie;
window.closeSmartMessagerie = closeSmartMessagerie;
window.markSmartMessageAsRead = markSmartMessageAsRead;
window.markAllSmartMessagesRead = markAllSmartMessagesRead;
window.deleteSmartMessage = deleteSmartMessage;
window.deleteAllSmartMessages = deleteAllSmartMessages;
window.generateAIAssistantMessage = generateAIAssistantMessage;
</script>

</body>
</html>